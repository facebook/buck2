"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[27470],{28453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>l});var i=s(96540);const n={},a=i.createContext(n);function o(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),i.createElement(a.Provider,{value:t},e.children)}},62219:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"api/build/AnalysisActions","title":"AnalysisActions","description":"AnalysisActions.anon\\\\_target","source":"@site/../docs/api/build/AnalysisActions.md","sourceDirName":"api/build","slug":"/api/build/AnalysisActions","permalink":"/docs/api/build/AnalysisActions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"apiSidebar","previous":{"title":"ActionSubError","permalink":"/docs/api/build/ActionSubError"},"next":{"title":"AnalysisContext","permalink":"/docs/api/build/AnalysisContext"}}');var n=s(74848),a=s(28453),o=s(56289);const l={},r="AnalysisActions",d={},c=[{value:"AnalysisActions.anon_target",id:"analysisactionsanon_target",level:2},{value:"AnalysisActions.anon_targets",id:"analysisactionsanon_targets",level:2},{value:"AnalysisActions.artifact_tag",id:"analysisactionsartifact_tag",level:2},{value:"AnalysisActions.assert_has_content_based_path",id:"analysisactionsassert_has_content_based_path",level:2},{value:"AnalysisActions.assert_short_path",id:"analysisactionsassert_short_path",level:2},{value:"AnalysisActions.cas_artifact",id:"analysisactionscas_artifact",level:2},{value:"AnalysisActions.copied_dir",id:"analysisactionscopied_dir",level:2},{value:"AnalysisActions.copy_dir",id:"analysisactionscopy_dir",level:2},{value:"AnalysisActions.copy_file",id:"analysisactionscopy_file",level:2},{value:"AnalysisActions.declare_output",id:"analysisactionsdeclare_output",level:2},{value:"AnalysisActions.digest_config",id:"analysisactionsdigest_config",level:2},{value:"AnalysisActions.download_file",id:"analysisactionsdownload_file",level:2},{value:"AnalysisActions.dynamic_output",id:"analysisactionsdynamic_output",level:2},{value:"AnalysisActions.dynamic_output_new",id:"analysisactionsdynamic_output_new",level:2},{value:"AnalysisActions.run",id:"analysisactionsrun",level:2},{value:"Input and output artifacts",id:"input-and-output-artifacts",level:3},{value:"AnalysisActions.symlink_file",id:"analysisactionssymlink_file",level:2},{value:"AnalysisActions.symlinked_dir",id:"analysisactionssymlinked_dir",level:2},{value:"AnalysisActions.tset",id:"analysisactionstset",level:2},{value:"AnalysisActions.write",id:"analysisactionswrite",level:2},{value:"AnalysisActions.write_json",id:"analysisactionswrite_json",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"analysisactions",children:"AnalysisActions"})}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsanon_target",children:"AnalysisActions.anon_target"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.anon_target(\nrule: def(**kwargs: typing.Any) -> None,\nattrs: dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", typing.Any],\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/AnonTarget",children:"AnonTarget"})]})}),"\n",(0,n.jsx)(t.p,{children:"An anonymous target is defined by the hash of its attributes, rather than its name. During analysis, rules can define and access the providers of anonymous targets before producing their own providers. Two distinct rules might ask for the same anonymous target, sharing the work it performs."}),"\n",(0,n.jsxs)(t.p,{children:["For more details see ",(0,n.jsx)(t.a,{href:"https://buck2.build/docs/rule_authors/anon_targets/",children:"https://buck2.build/docs/rule_authors/anon_targets/"})]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsanon_targets",children:"AnalysisActions.anon_targets"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.anon_targets(\nrules: list[(def(**kwargs: typing.Any) -> None, dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", typing.Any])] | tuple[(def(**kwargs: typing.Any) -> None, dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", typing.Any]), ...],\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/AnonTargets",children:"AnonTargets"})]})}),"\n",(0,n.jsx)(t.p,{children:"Generate a series of anonymous targets."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsartifact_tag",children:"AnalysisActions.artifact_tag"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.artifact_tag(\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/ArtifactTag",children:"ArtifactTag"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Allocate a new input tag. Used with the ",(0,n.jsx)(t.code,{children:"dep_files"})," argument to ",(0,n.jsx)(t.code,{children:"run"}),"."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsassert_has_content_based_path",children:"AnalysisActions.assert_has_content_based_path"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.assert_has_content_based_path(\nartifact: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),",\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsassert_short_path",children:"AnalysisActions.assert_short_path"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.assert_short_path(\nartifact: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),",\nshort_path: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsx)(t.p,{children:"Generate a promise artifact that has short path accessible on it. The short path's correctness will be asserted during analysis time."}),"\n",(0,n.jsxs)(t.p,{children:["TODO - we would prefer the API to be ",(0,n.jsx)(t.code,{children:'ctx.actions.anon_target(xxx).artifact("foo", short_path=yyy)'}),", but\nwe cannot support this until we can get access to the ",(0,n.jsx)(t.code,{children:"AnalysisContext"})," without passing it into this method."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionscas_artifact",children:"AnalysisActions.cas_artifact"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.cas_artifact(\noutput: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\ndigest: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nuse_case: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\n/,\n*,\nexpires_after_timestamp: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/int",children:"int"}),",\nis_executable: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nis_tree: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nis_directory: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsx)(t.p,{children:"Downloads a CAS artifact to an output"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"digest"}),": must look like ",(0,n.jsx)(t.code,{children:"SHA1:SIZE"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"use_case"}),": your RE use case"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"expires_after_timestamp"}),": must be a UNIX timestamp. Your digest's TTL must exceed this\ntimestamp. Your build will break once the digest expires, so make sure the expiry is long\nenough (preferably, in years)."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"is_executable"}),": indicates the resulting file should be marked with executable\npermissions"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"is_tree"}),": digest must point to a blob of type\n",(0,n.jsx)(t.a,{href:"https://fburl.com/code/95rqgju0",children:"RE.Tree"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"is_directory"}),": digest must point to a blob of type\n",(0,n.jsx)(t.a,{href:"https://fburl.com/code/4eg40nnp",children:"RE.Directory"})]}),"\n"]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionscopied_dir",children:"AnalysisActions.copied_dir"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.copied_dir(\noutput: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nsrcs: dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),"],\n/,\n*,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nexecutable_bit_override: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Returns an ",(0,n.jsx)(t.code,{children:"artifact"})," which is a directory containing copied files. The srcs must be a dictionary of path (as string, relative to the result directory) to the bound ",(0,n.jsx)(t.code,{children:"artifact"}),", which will be laid out in the directory."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionscopy_dir",children:"AnalysisActions.copy_dir"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.copy_dir(\ndest: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nsrc: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),",\n/,\n*,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nexecutable_bit_override: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsx)(t.p,{children:"Make a copy of a directory."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionscopy_file",children:"AnalysisActions.copy_file"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.copy_file(\ndest: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nsrc: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),",\n/,\n*,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nexecutable_bit_override: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Copies the source ",(0,n.jsx)(t.code,{children:"artifact"})," to the destination (which can be a string representing a filename or an output ",(0,n.jsx)(t.code,{children:"artifact"}),") and returns the output ",(0,n.jsx)(t.code,{children:"artifact"}),". The copy works for files or directories."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsdeclare_output",children:"AnalysisActions.declare_output"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.declare_output(\nprefix: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nfilename: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," = ...,\n/,\n*,\ndir: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nuses_experimental_content_based_path_hashing: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nhas_content_based_path: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Returns an unbound ",(0,n.jsx)(t.code,{children:"artifact"}),", representing where a file will go, which must be bound before analysis terminates. The usual way of binding an artifact is with ",(0,n.jsx)(t.code,{children:"ctx.actions.run"}),". As an example:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",children:'my_output = ctx.actions.declare_output("output.o")\nctx.actions.run(["gcc", "-c", my_source, "-o", my_output.as_output()], category = "compile")\n'})}),"\n",(0,n.jsxs)(t.p,{children:["This snippet declares an output with the filename ",(0,n.jsx)(t.code,{children:"output.o"})," (it will be located in the output directory\nfor this target). Note the use of ",(0,n.jsx)(t.code,{children:"as_output"})," to tag this artifact as being an output in\nthe action. After binding the artifact you can subsequently use ",(0,n.jsx)(t.code,{children:"my_output"})," as either an\ninput for subsequent actions, or as the result in a provider."]}),"\n",(0,n.jsxs)(t.p,{children:["Artifacts from a single target may not have the same name, so if you then want a second\nartifact also named ",(0,n.jsx)(t.code,{children:"output.o"})," you need to supply a prefix, e.g.\n",(0,n.jsx)(t.code,{children:'ctx.actions.declare_output("directory", "output.o")'}),". The artifact will still report having\nname ",(0,n.jsx)(t.code,{children:"output.o"}),", but will be located at ",(0,n.jsx)(t.code,{children:"directory/output.o"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"dir"})," argument should be set to ",(0,n.jsx)(t.code,{children:"True"})," if the binding will be a directory."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsdigest_config",children:"AnalysisActions.digest_config"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.digest_config(\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/DigestConfig",children:"DigestConfig"})]})}),"\n",(0,n.jsx)(t.p,{children:"Obtain this daemon's digest configuration. This allows rules to discover what digests the daemon may be able to e.g. defer download because they conform to its RE backend's expected digest format."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsdownload_file",children:"AnalysisActions.download_file"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.download_file(\noutput: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nurl: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\n/,\n*,\nvpnless_url: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nsha1: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nsha256: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nsize_bytes: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/int",children:"int"})," = None,\nis_executable: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Downloads a URL to an output (filename as string or output artifact). The file at the URL must have the given sha1 or the command will fail. The optional parameter is_executable indicates whether the resulting file should be marked with executable permissions. (Meta-internal) The optional parameter vpnless_url indicates a url from which this resource can be downloaded off VPN; this has the same restrictions as ",(0,n.jsx)(t.code,{children:"url"})," above."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsdynamic_output",children:"AnalysisActions.dynamic_output"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.dynamic_output(\n*,\ndynamic: list[",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),"] | tuple[",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),", ...],\ninputs: list[",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),"] | tuple[",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),", ...] = ...,\noutputs: list[",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"}),"] | tuple[",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"}),", ...],\nf: typing.Callable[[typing.Any, dict[",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),", ",(0,n.jsx)(o.default,{to:"/docs/api/build/ArtifactValue",children:"ArtifactValue"}),"], dict[",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),", ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),"]], None],\n) -> None"]})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"dynamic_output"})," allows a rule to use information that was not available when the rule was first run at analysis time. Examples include things like Distributed ThinLTO (where the index file is created by another action) or OCaml builds (where the dependencies are created by ",(0,n.jsx)(t.code,{children:"ocamldeps"}),")."]}),"\n",(0,n.jsx)(t.p,{children:"The arguments are:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"dynamic"})," - a list of artifacts whose values will be available in the function. These will\nbe built before the function is run."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"inputs"})," - parameter is ignored."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"outputs"})," - a list of unbound artifacts (created with ",(0,n.jsx)(t.code,{children:"declare_artifact"}),") which will be\nbound by the function."]}),"\n",(0,n.jsxs)(t.li,{children:["The function argument is given 3 arguments:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ctx"})," (context) - which is the same as that passed to the initial rule analysis."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"artifacts"})," - using one of the artifacts from ",(0,n.jsx)(t.code,{children:"dynamic"})," (example usage:\n",(0,n.jsx)(t.code,{children:"artifacts[artifact_from_dynamic])"})," gives an artifact value containing the methods\n",(0,n.jsx)(t.code,{children:"read_string"}),", ",(0,n.jsx)(t.code,{children:"read_lines"}),", and ",(0,n.jsx)(t.code,{children:"read_json"})," to obtain the values from the disk in\nvarious formats.  Anything too complex should be piped through a Python script for\ntransformation to JSON."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"outputs"})," - using one of the artifacts from the ",(0,n.jsx)(t.code,{children:"dynamic_output"}),"'s ",(0,n.jsx)(t.code,{children:"outputs"})," (example\nusage: ",(0,n.jsx)(t.code,{children:"outputs[artifact_from_dynamic_output_outputs]"}),") gives an unbounded artifact. The\nfunction argument must use its ",(0,n.jsx)(t.code,{children:"outputs"})," argument to bind output artifacts, rather than\nreusing artifacts from the outputs passed into ",(0,n.jsx)(t.code,{children:"dynamic_output"})," directly."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["The function must call ",(0,n.jsx)(t.code,{children:"ctx.actions"})," (probably ",(0,n.jsx)(t.code,{children:"ctx.actions.run"}),") to bind all outputs. It\ncan examine the values of the dynamic variables and depends on the inputs.","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["The function will usually be a ",(0,n.jsx)(t.code,{children:"def"}),", as ",(0,n.jsx)(t.code,{children:"lambda"})," in Starlark does not allow statements,\nmaking it quite underpowered. For full details see\n",(0,n.jsx)(t.a,{href:"https://buck2.build/docs/rule_authors/dynamic_dependencies/",children:"https://buck2.build/docs/rule_authors/dynamic_dependencies/"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Besides dynamic dependencies, there is a second use case for ",(0,n.jsx)(t.code,{children:"dynamic_output"}),": say that you\nhave some output artifact, and that the analysis to produce the action that outputs that\nartifact is expensive, ie takes a lot of CPU time; you would like to skip that work in\nbuilds that do not actually use that artifact."]}),"\n",(0,n.jsxs)(t.p,{children:["This can be accomplished by putting the analysis for that artifact behind a ",(0,n.jsx)(t.code,{children:"dynamic_output"}),"\nwith an empty ",(0,n.jsx)(t.code,{children:"dynamic"})," list. The ",(0,n.jsx)(t.code,{children:"dynamic_output"}),"'s function will not be run unless one of\nthe actions it outputs is actually requested as part of the build."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsdynamic_output_new",children:"AnalysisActions.dynamic_output_new"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.dynamic_output_new(\ndynamic_actions: ",(0,n.jsx)(o.default,{to:"/docs/api/build/DynamicActions",children:"DynamicAction"}),",\n/,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/DynamicValue",children:"DynamicValue"})]})}),"\n",(0,n.jsxs)(t.p,{children:["New version of ",(0,n.jsx)(t.code,{children:"dynamic_output"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["This is work in progress, and will eventually replace the old ",(0,n.jsx)(t.code,{children:"dynamic_output"}),"."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionsrun",children:"AnalysisActions.run"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.run(\narguments: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellPath",children:"CellPath"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellRoot",children:"CellRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/Label",children:"Label"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ProjectRoot",children:"ProjectRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ResolvedStringWithMacros",children:"ResolvedStringWithMacros"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TaggedCommandLine",children:"TaggedCommandLine"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TargetLabel",children:"TargetLabel"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TransitiveSetArgsProjection",children:"TransitiveSetArgsProjection"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/WriteJsonCliArgs",children:"WriteJsonCliArgs"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/cmd_args",children:"cmd_args"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," | list | RunInfo,\n/,\n*,\ncategory: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nidentifier: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nenv: dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellPath",children:"CellPath"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellRoot",children:"CellRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/Label",children:"Label"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ProjectRoot",children:"ProjectRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ResolvedStringWithMacros",children:"ResolvedStringWithMacros"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TaggedCommandLine",children:"TaggedCommandLine"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TargetLabel",children:"TargetLabel"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TransitiveSetArgsProjection",children:"TransitiveSetArgsProjection"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/WriteJsonCliArgs",children:"WriteJsonCliArgs"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/cmd_args",children:"cmd_args"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," | RunInfo] = ...,\nlocal_only: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nprefer_local: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nprefer_remote: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nlow_pass_filter: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = True,\nalways_print_stderr: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nweight: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/int",children:"int"})," = ...,\nweight_percentage: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/int",children:"int"})," = ...,\ndep_files: dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", ",(0,n.jsx)(o.default,{to:"/docs/api/build/ArtifactTag",children:"ArtifactTag"}),"] = ...,\nmetadata_env_var: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," = ...,\nmetadata_path: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," = ...,\nincremental_metadata_ignore_tags: list[",(0,n.jsx)(o.default,{to:"/docs/api/build/ArtifactTag",children:"ArtifactTag"}),"] | tuple[",(0,n.jsx)(o.default,{to:"/docs/api/build/ArtifactTag",children:"ArtifactTag"}),", ...] = [],\nno_outputs_cleanup: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nincremental_remote_outputs: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nallow_cache_upload: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nallow_dep_file_cache_upload: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nforce_full_hybrid_if_capable: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nexe: RunInfo | WorkerRunInfo = ...,\nunique_input_inodes: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nerror_handler: None | typing.Callable = None,\nremote_execution_dependencies: list[dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),"]] = [],\nremote_execution_dynamic_image = None,\nmeta_internal_extra_params: None | dict = None,\noutputs_for_error_handler: list[",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"}),"] | tuple[",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"}),", ...] = [],\nexpect_eligible_for_dedupe: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\n) -> None"]})}),"\n",(0,n.jsx)(t.p,{children:"Run a command to produce one or more artifacts."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"arguments"}),": must be of type ",(0,n.jsx)(t.code,{children:"cmd_args"}),", or a type convertible to such (such as a list of\nstrings and artifacts). See below for detailed description of artifact arguments."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"env"}),": environment variables to set when the command is executed."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"category"}),": category and identifier - when used together, identify the action in Buck2's\nevent stream, and must be unique for a given target"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"weight"}),": used to note how heavy the command is and will typically be set to a higher\nvalue to indicate that less such commands should be run in parallel (if running locally)"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"no_outputs_cleanup"}),": if this flag is set then Buck2 won't clean the outputs of a previous\nbuild that might be present on a disk; in which case, command from arguments should be\nresponsible for the cleanup (that is useful, for example, when an action is supporting\nincremental mode and its outputs are based on result from a previous build)"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"metadata_env_var"})," and ",(0,n.jsx)(t.code,{children:"meadata_path"})," should be used together: both set or both unset","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"metadata_path"}),": defines a path relative to the result directory for a file with\naction metadata, which will be created right before the command will be run."]}),"\n",(0,n.jsxs)(t.li,{children:["Metadata contains the path relative to the Buck2 project root and hash digest for\nevery action input (this excludes symlinks as they could be resolved by a user script\nif needed). The resolved path relative to the Buck2 project for the metadata file will\nbe passed to command from arguments, via the environment variable, with its name set\nby ",(0,n.jsx)(t.code,{children:"metadata_env_var"})]}),"\n",(0,n.jsxs)(t.li,{children:["Both ",(0,n.jsx)(t.code,{children:"metadata_env_var"})," and ",(0,n.jsx)(t.code,{children:"metadata_path"})," are useful when making actions behave in\nan incremental manner (for details, see ",(0,n.jsx)(t.a,{href:"https://buck2.build/docs/rule_authors/incremental_actions/",children:"Incremental\nActions"}),")"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["The ",(0,n.jsx)(t.code,{children:"prefer_local"}),", ",(0,n.jsx)(t.code,{children:"prefer_remote"})," and ",(0,n.jsx)(t.code,{children:"local_only"})," options allow selecting where the\naction should run if the executor selected for this target is a hybrid executor.","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:'All those options disable concurrent execution: the action will run on the preferred\nplatform first (concurrent execution only happens with a "full" hybrid executor).'}),"\n",(0,n.jsxs)(t.li,{children:['Execution may be retried on the "non-preferred" platform if it fails due to a\ntransient error, except for ',(0,n.jsx)(t.code,{children:"local_only"}),", which does not allow this."]}),"\n",(0,n.jsxs)(t.li,{children:["If the executor selected is a remote-only executor and you use ",(0,n.jsx)(t.code,{children:"local_only"}),", that's an\nerror. The other options will not raise errors."]}),"\n",(0,n.jsx)(t.li,{children:"Setting more than one of those options is an error."}),"\n",(0,n.jsxs)(t.li,{children:["Those flags behave the same way as the equivalent ",(0,n.jsx)(t.code,{children:"--prefer-remote"}),", ",(0,n.jsx)(t.code,{children:"--prefer-local"}),"\nand ",(0,n.jsx)(t.code,{children:"--local-only"})," CLI flags. The CLI flags take precedence."]}),"\n",(0,n.jsxs)(t.li,{children:["The ",(0,n.jsx)(t.code,{children:"force_full_hybrid_if_capable"})," option overrides the ",(0,n.jsx)(t.code,{children:"use_limited_hybrid"})," hybrid.\nThe options listed above take precedence if set."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"remote_execution_dependencies"}),": list of dependencies which is passed to Remote Execution.\nEach dependency is dictionary with the following keys:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"smc_tier"}),": name of the SMC tier to call by RE Scheduler."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"id"}),": name of the dependency."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"remote_execution_dynamic_image"}),": a custom Tupperware image which is passed to Remote Execution.\nIt takes a dictionary with the following keys:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"identifier"}),": name of the SMC tier to call by RE Scheduler.","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"name"}),": name of the image."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"uuid"}),": uuid of the image."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"drop_host_mount_globs"}),": list of strings containing file\nglobs. Any mounts globs specified will not be bind mounted\nfrom the host."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"meta_internal_extra_params"}),": a dictionary to pass extra parameters to RE, can add more keys in the future:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"remote_execution_policy"}),": refer to TExecutionPolicy."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"outputs_for_error_handler"}),": Output files to be provided to the action error handler and read by\n",(0,n.jsx)(t.a,{href:"https://buck2.build/docs/api/build/ActionErrorCtx/#actionerrorctxoutput_artifacts",children:"error handler"})," in the event of a failure..","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The output must also be declared as an output of the action"}),"\n",(0,n.jsx)(t.li,{children:"The output artifact must be created if the action fails"}),"\n",(0,n.jsx)(t.li,{children:"Nothing will be provided if left empty (Which is the default)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"When actions execute, they'll do so from the root of the repository. As they execute,\nactions have exclusive access to their output directory."}),"\n",(0,n.jsxs)(t.p,{children:['Actions also get exclusive access to a "scratch" path that is exposed via the environment\nvariable ',(0,n.jsx)(t.code,{children:"BUCK_SCRATCH_PATH"}),". This path is expressed as a path relative to the working\ndirectory (i.e. relative to the project). This path is guaranteed to exist when the action\nexecutes."]}),"\n",(0,n.jsxs)(t.p,{children:["When actions run locally, the scratch path is also used as the ",(0,n.jsx)(t.code,{children:"TMPDIR"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"input-and-output-artifacts",children:"Input and output artifacts"}),"\n",(0,n.jsx)(t.p,{children:"Run action consumes arbitrary number of input artifacts\nand produces at least one output artifact."}),"\n",(0,n.jsx)(t.p,{children:"Both input and output artifacts can be passed in:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["positional ",(0,n.jsx)(t.code,{children:"arguments"})," parameters"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"env"})," dict"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Input artifacts must be already bound prior to this call,\nmeaning these artifacts must be either:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"source artifacts"}),"\n",(0,n.jsx)(t.li,{children:"coming from dependencies"}),"\n",(0,n.jsxs)(t.li,{children:["declared locally and bound to another action (passed to ",(0,n.jsx)(t.code,{children:".as_output()"}),")\n",(0,n.jsx)(t.em,{children:"before"})," this ",(0,n.jsx)(t.code,{children:"run()"})," call"]}),"\n",(0,n.jsxs)(t.li,{children:["or created already bound with some simple action like ",(0,n.jsx)(t.code,{children:"write()"})]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:'Output artifacts must be declared locally (within the same analysis),\nand must not be already bound. Output artifacts become "bound" after this call.'}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionssymlink_file",children:"AnalysisActions.symlink_file"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.symlink_file(\ndest: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nsrc: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),",\n/,\n*,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Creates a symlink to the source ",(0,n.jsx)(t.code,{children:"artifact"})," at the destination (which can be a string representing a filename or an output ",(0,n.jsx)(t.code,{children:"artifact"}),") and returns the output ",(0,n.jsx)(t.code,{children:"artifact"}),". The symlink works for files or directories."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionssymlinked_dir",children:"AnalysisActions.symlinked_dir"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.symlinked_dir(\noutput: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\nsrcs: dict[",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),", ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),"],\n/,\n*,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Returns an ",(0,n.jsx)(t.code,{children:"artifact"})," that is a directory containing symlinks. The srcs must be a dictionary of path (as string, relative to the result directory) to bound ",(0,n.jsx)(t.code,{children:"artifact"}),", which will be laid out in the directory."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionstset",children:"AnalysisActions.tset"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.tset(\ndefinition: ",(0,n.jsx)(o.default,{to:"/docs/api/build/TransitiveSetDefinition",children:"TransitiveSetDefinition"}),",\n/,\n*,\nvalue = ...,\nchildren: typing.Iterable = ...,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/TransitiveSet",children:"TransitiveSet"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Creates a new transitive set. For details, see ",(0,n.jsx)(t.a,{href:"https://buck2.build/docs/rule_authors/transitive_sets/",children:"https://buck2.build/docs/rule_authors/transitive_sets/"}),"."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionswrite",children:"AnalysisActions.write"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.write(\noutput: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\ncontent: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellPath",children:"CellPath"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellRoot",children:"CellRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/Label",children:"Label"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ProjectRoot",children:"ProjectRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ResolvedStringWithMacros",children:"ResolvedStringWithMacros"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TaggedCommandLine",children:"TaggedCommandLine"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TargetLabel",children:"TargetLabel"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TransitiveSetArgsProjection",children:"TransitiveSetArgsProjection"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/WriteJsonCliArgs",children:"WriteJsonCliArgs"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/cmd_args",children:"cmd_args"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," | list | RunInfo,\n/,\n*,\nis_executable: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nallow_args: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nwith_inputs: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nabsolute: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nuse_dep_files_placeholder_for_content_based_paths: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | (",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),", list[",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),"])"]})}),"\n",(0,n.jsxs)(t.p,{children:["Returns an ",(0,n.jsx)(t.code,{children:"artifact"})," whose contents are ",(0,n.jsx)(t.code,{children:"content"})]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"is_executable"})," (optional): indicates whether the resulting file should be marked with\nexecutable permissions"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"allow_args"})," (optional): must be set to ",(0,n.jsx)(t.code,{children:"True"})," if you want to write parameter arguments to\nthe file (in particular, macros that write to file)","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["If it is true, the result will be a pair of the ",(0,n.jsx)(t.code,{children:"artifact"})," containing content and a\nlist of artifact values that were written by macros, which should be used in hidden\nfields or similar"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"with_inputs"})," (optional): if set, add artifacts in ",(0,n.jsx)(t.code,{children:"content"})," as associated artifacts of the return ",(0,n.jsx)(t.code,{children:"artifact"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"absolute"})," (optional): if set, this action will produce absolute paths in its output when\nrendering artifact paths. You generally shouldn't use this if you plan to use this action\nas the input for anything else, as this would effectively result in losing all shared\ncaching."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["The content is often a string, but can be any ",(0,n.jsx)(t.code,{children:"ArgLike"})," value. This is occasionally useful\nfor generating scripts to run as a part of another action. ",(0,n.jsx)(t.code,{children:"cmd_args"})," in the content are\nnewline separated unless another delimiter is explicitly specified."]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"analysisactionswrite_json",children:"AnalysisActions.write_json"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def AnalysisActions.write_json(\noutput: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"}),",\ncontent: ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellPath",children:"CellPath"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/CellRoot",children:"CellRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/Label",children:"Label"})," | None | ",(0,n.jsx)(o.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ProjectRoot",children:"ProjectRoot"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/ResolvedStringWithMacros",children:"ResolvedStringWithMacros"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TaggedCommandLine",children:"TaggedCommandLine"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TaggedValue",children:"TaggedValue"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TargetLabel",children:"TargetLabel"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TransitiveSetArgsProjection",children:"TransitiveSetArgsProjection"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/TransitiveSetJsonProjection",children:"TransitiveSetJsonProjection"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/WriteJsonCliArgs",children:"WriteJsonCliArgs"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/bxl/SelectConcat",children:"bxl.SelectConcat"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/bxl/SelectDict",children:"bxl.SelectDict"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/cmd_args",children:"cmd_args"})," | enum | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/int",children:"int"})," | record | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/str",children:"str"})," | list | tuple | dict | struct(..) | Provider | RunInfo,\n/,\n*,\nwith_inputs: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\npretty: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nabsolute: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nuses_experimental_content_based_path_hashing: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nhas_content_based_path: None | ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = None,\nuse_dep_files_placeholder_for_content_based_paths: ",(0,n.jsx)(o.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\n) -> ",(0,n.jsx)(o.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,n.jsx)(o.default,{to:"/docs/api/build/WriteJsonCliArgs",children:"WriteJsonCliArgs"})]})}),"\n",(0,n.jsxs)(t.p,{children:["Returns an ",(0,n.jsx)(t.code,{children:"artifact"})," whose contents are ",(0,n.jsx)(t.code,{children:"content"})," written as a JSON value."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"output"}),": can be a string, or an existing artifact created with ",(0,n.jsx)(t.code,{children:"declare_output"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"content"}),":  must be composed of the basic json types (boolean, number, string, list/tuple,\ndictionary) plus artifacts and command lines","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"An artifact will be written as a string containing the path"}),"\n",(0,n.jsxs)(t.li,{children:["A command line will be written as a list of strings, unless ",(0,n.jsx)(t.code,{children:"joined=True"})," is set, in\nwhich case it will be a string"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["If you pass ",(0,n.jsx)(t.code,{children:"with_inputs = True"}),", you'll get back a ",(0,n.jsx)(t.code,{children:"cmd_args"})," that expands to the JSON\nfile but carries all the underlying inputs as dependencies (so you don't have to use, for\nexample, ",(0,n.jsx)(t.code,{children:"hidden"})," for them to be added to an action that already receives the JSON file)"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"pretty"})," (optional): write formatted JSON (defaults to ",(0,n.jsx)(t.code,{children:"False"}),")"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"absolute"})," (optional): if set, this action will produce absolute paths in its output when\nrendering artifact paths. You generally shouldn't use this if you plan to use this action\nas the input for anything else, as this would effectively result in losing all shared\ncaching. (defaults to ",(0,n.jsx)(t.code,{children:"False"}),")"]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}}}]);