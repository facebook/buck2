"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[37512],{24477:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"prelude/rules/go/go_test","title":"go_test","description":"A go_test() rule builds a native binary from the specified Go source and resource files\u2014and a generated main file. It\'s similar to the go test command.","source":"@site/../docs/prelude/rules/go/go_test.md","sourceDirName":"prelude/rules/go","slug":"/prelude/rules/go/go_test","permalink":"/docs/prelude/rules/go/go_test","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ruleSidebar","previous":{"title":"go_stdlib","permalink":"/docs/prelude/rules/go/go_stdlib"},"next":{"title":"groovy","permalink":"/docs/prelude/rules/groovy/"}}');var i=n(74848),r=n(28453);n(56289);const o={},l="go_test",d={},c=[{value:"Details",id:"details",level:3},{value:"Function Signature",id:"function-signature",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Examples",id:"examples",level:3}];function a(e){const s={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"go_test",children:"go_test"})}),"\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.code,{children:"go_test()"})," rule builds a native binary from the specified Go source and resource files\u2014and a generated main file. It's similar to the ",(0,i.jsx)(s.code,{children:"go test"})," command."]}),"\n",(0,i.jsx)(s.h3,{id:"details",children:"Details"}),"\n",(0,i.jsxs)(s.p,{children:["If your test requires static files you should specify these in\nthe ",(0,i.jsx)(s.strong,{children:"resources"})," argument. If you do not specify these\nfiles, they won't be available when your test runs."]}),"\n",(0,i.jsx)(s.h3,{id:"function-signature",children:"Function Signature"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:'def go_test(\n    *,\n    name: str,\n    default_target_platform: None | str = None,\n    target_compatible_with: list[str] = [],\n    compatible_with: list[str] = [],\n    exec_compatible_with: list[str] = [],\n    visibility: list[str] = [],\n    within_view: list[str] = ["PUBLIC"],\n    metadata: OpaqueMetadata = {},\n    tests: list[str] = [],\n    modifiers: OpaqueMetadata = [],\n    _apple_platforms: dict[str, str] = {},\n    _build_info: dict[str, typing.Any] = {},\n    _build_tags: list[str] = [],\n    _coverage_mode: None | str = select({"prelude//go/constraints:coverage_mode_atomic": "atomic", "prelude//go/constraints:coverage_mode_count": "count", "prelude//go/constraints:coverage_mode_set": "set", "DEFAULT": None}),\n    _cxx_toolchain: str = "gh_facebook_buck2_shims_meta//:cxx",\n    _exec_os_type: str = "prelude//os_lookup/targets:os_lookup",\n    _go_stdlib: str = "prelude//go/tools:stdlib",\n    _go_toolchain: str = "gh_facebook_buck2_shims_meta//:go",\n    _inject_test_env: str = "prelude//test/tools:inject_test_env",\n    _remote_test_execution_toolchain: str = "gh_facebook_buck2_shims_meta//:remote_test_execution",\n    _test_toolchain: str = "gh_facebook_buck2_shims_meta//:test",\n    _testmaingen: str = "prelude//go_bootstrap/tools:go_testmaingen",\n    assembler_flags: list[str] = [],\n    build_mode: None | str = None,\n    build_tags: list[str] = [],\n    cgo_enabled: None | bool = None,\n    compiler_flags: list[str] = [],\n    contacts: list[str] = [],\n    coverage_mode: None | str = None,\n    cxx_compiler_flags: list[str] = [],\n    cxx_preprocessor_flags: list[str] = [],\n    default_host_platform: None | str = None,\n    deps: list[str] = [],\n    embedcfg: None | str = None,\n    env: dict[str, str] = {},\n    external_linker_flags: list[str] = [],\n    header_namespace: None | str = None,\n    headers: list[str] | dict[str, str] = [],\n    labels: list[str] = [],\n    licenses: list[str] = [],\n    link_mode: None | str = None,\n    link_style: None | str = None,\n    linker_flags: list[str] = [],\n    package_name: None | str = None,\n    package_root: None | str = None,\n    platform: None | str = None,\n    remote_execution: None | str | dict[str, None | bool | int | str | list[dict[str, str]] | dict[str, str | list[str]]] = None,\n    resources: list[str] = [],\n    run_test_separately: bool = False,\n    runner: None | str = None,\n    specs: None | str = None,\n    srcs: list[str] = [],\n    target_under_test: None | str = None,\n    test_rule_timeout_ms: None | int = None,\n) -> None\n'})}),"\n",(0,i.jsx)(s.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"name"}),": (required)"]}),"\n",(0,i.jsx)(s.p,{children:"name of the target"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"default_target_platform"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"specifies the default target platform, used when no platforms are specified on the command line"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"target_compatible_with"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"compatible_with"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"exec_compatible_with"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"visibility"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"a list of visibility patterns restricting what targets can depend on this one"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"within_view"}),": (defaults to: ",(0,i.jsx)(s.code,{children:'["PUBLIC"]'}),")"]}),"\n",(0,i.jsx)(s.p,{children:"a list of visibility patterns restricting what this target can depend on"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"metadata"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"{}"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"a key-value map of metadata associated with this target"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"tests"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"a list of targets that provide tests for this one"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"modifiers"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"an array of modifiers associated with this target"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"_build_info"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"{}"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"Build info that is passed along here will be late-stamped into a fb_build_info section on the output binary"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"assembler_flags"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["The set of additional assembler flags to pass to ",(0,i.jsx)(s.code,{children:"go tool asm"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"build_mode"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["Determines the build mode (equivalent of ",(0,i.jsx)(s.code,{children:"-buildmode"}),"). Can be one of the following values: ",(0,i.jsx)(s.code,{children:"exe"}),", ",(0,i.jsx)(s.code,{children:"pie"}),".`"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"build_tags"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"Build tags to apply to this target and its dependencies."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"cgo_enabled"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"Analog of CGO_ENABLED env-var, applies to this target and its dependencies. If None it will depend on the availability of CXX toolchain."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"compiler_flags"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["The set of additional compiler flags to pass to ",(0,i.jsx)(s.code,{children:"go tool compile"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"contacts"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"A list of organizational contacts for this rule. These could be individuals who you would contact in the event of a failure or other issue with the rule."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"contacts = [ 'Joe Sixpack', 'Erika Mustermann' ]\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"cxx_compiler_flags"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"GCC/Clang flags to use when compiling any of the above C/C++ sources (which require compilation)."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"cxx_preprocessor_flags"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"GCC/Clang flags to use when preprocessing any of the above C/C++ sources (which require preprocessing)."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"deps"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"The set of dependencies of this rule. Currently, this only supports go_library rules."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"env"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"{}"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"A map of environment variables and values to set when running the test."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"external_linker_flags"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["Extra external linker flags passed to go link via ",(0,i.jsx)(s.code,{children:"-extld"})," argument."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"header_namespace"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.jsx)(s.code,{children:"/"}),"), but cannot start with one. See ",(0,i.jsx)(s.code,{children:"headers"})," for more information."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"headers"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header name can contain forward slashes (",(0,i.jsx)(s.code,{children:"/"}),"). The headers can be included with ",(0,i.jsx)(s.code,{children:'#include "$HEADER_NAMESPACE/$HEADER_NAME"'})," or ",(0,i.jsx)(s.code,{children:"#include <$HEADER_NAMESPACE/$HEADER_NAME>"})," , where ",(0,i.jsx)(s.code,{children:"$HEADER_NAMESPACE"})," is the value of the target's ",(0,i.jsx)(s.code,{children:"header_namespace"}),"  attribute, and ",(0,i.jsx)(s.code,{children:"$HEADER_NAME"})," is the header name if specified, and the filename of the header file otherwise. See ",(0,i.jsx)(s.code,{children:"header_namespace"})," for more information."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"labels"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["A list of labels to be applied to these tests. These labels are arbitrary text strings and have no meaning within buck itself. They can, however, have meaning for you as a test author (e.g., ",(0,i.jsx)(s.code,{children:"smoke"})," or ",(0,i.jsx)(s.code,{children:"fast"}),"). A label can be used to filter or include a specific test rule when executing ",(0,i.jsx)(s.code,{children:"buck test"})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"licenses"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["Set of license files for this library. To get the list of license files for a given build rule and all of its dependencies, you can use ",(0,i.jsx)(s.a,{href:"https://buck2.build/docs/users/commands/query/",children:"buck query"})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"link_mode"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["Determines the link mode (equivalent of ",(0,i.jsx)(s.code,{children:"-mode"}),"). Can be one of the following values: ",(0,i.jsx)(s.code,{children:"internal"}),", ",(0,i.jsx)(s.code,{children:"external"}),". If no value is provided, the mode is set automatically depending on the other args."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"link_style"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["Determines whether to build and link this rule's dependencies statically or dynamically. Can be one of the following values: ",(0,i.jsx)(s.code,{children:"static"}),", ",(0,i.jsx)(s.code,{children:"static_pic"})," or ",(0,i.jsx)(s.code,{children:"shared"}),". This argument is relevant only if the cgo extension is enabled. Otherwise, Buck ignores this argument."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"linker_flags"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(s.p,{children:"Extra linker flags passed to go link"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"package_name"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(s.p,{children:'Sets the full name of the test package being compiled. This defaults to the path from the buck root with "_test" appended. (e.g. given a ./.buckconfig, a rule in ./a/b/BUCK defaults to package "a/b_test")'}),"\n",(0,i.jsxs)(s.p,{children:["Note: if you want to test packages internally (i.e. same package name), use the ",(0,i.jsx)(s.code,{children:"target_under_test"}),"\nparameter instead of setting ",(0,i.jsx)(s.code,{children:"package_name"})," to include the tested source files."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"package_root"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(s.p,{children:'Sets Go package direactory (relative to BUCK file). By default (or if None passes) package_root is being detected automatically. Empty string of Go package is on the same level as BUCK file otherwise the subdirectory name. Example for srcs = ["foo/bar.go"], package_root = "foo"'}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"srcs"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["The set of source files to be compiled by this rule. .go files will be compiled with the Go compiler, .s files will be compiled with the assembler, and everything else is assumed to be files that may be ",(0,i.jsx)(s.code,{children:"#include"}),"d by the assembler."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"target_under_test"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["Specify the target_under_test that this internal test is testing. This will copy the ",(0,i.jsx)(s.code,{children:"srcs"}),", ",(0,i.jsx)(s.code,{children:"package_name"})," and ",(0,i.jsx)(s.code,{children:"deps"})," from the target specified so you don't have to duplicate them."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"test_rule_timeout_ms"}),": (defaults to: ",(0,i.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(s.p,{children:["If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.jsx)(s.code,{children:"rule_timeout"})," if any has been specified in ",(0,i.jsx)(s.code,{children:".buckconfig"})," ."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsxs)(s.p,{children:["For more examples, check out our ",(0,i.jsx)(s.a,{href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/go/testdata",children:"integration tests"}),"."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"\ngo_library(\n  name='greeting',\n  srcs=[\n    'greeting.go',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\ngo_test(\n  name='greeting-test',\n  srcs=[\n    'greeting_ext_test.go',\n  ],\n  deps=[\n    ':greeting'\n  ],\n)\n\ngo_test(\n  name='greeting-internal-test',\n  package_name='greeting',\n  srcs=[\n    'greeting.go',\n    'greeting_test.go',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\n# Or\n\ngo_test(\n  name='greeting-better-internal-test',\n  srcs=['greeting_test.go'],\n  target_under_test=':greeting',\n)\n\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var t=n(96540);const i={},r=t.createContext(i);function o(e){const s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);