prelude = native

prelude.genrule(
    name = "check",
    out = "out.txt",
    cmd = "$(exe :bin) > $OUT",
) if not read_config("python", "package_style") == "standalone" else None

prelude.python_binary(
    name = "bin",
    main_module = "foo.bar",
    deps = [
        ":lib",
    ],
)

prelude.python_library(
    name = "lib",
    base_module = "foo",
    srcs = [
        "bar.py",
    ],
    deps = [
        ":dep",
        "fbsource//third-party/pypi/setuptools:setuptools",
    ],
)

prelude.python_library(
    name = "dep",
    base_module = "nested.pkg",
    srcs = [
        "mod.py",
    ],
)
