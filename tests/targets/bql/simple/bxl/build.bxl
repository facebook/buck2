def _impl(ctx):
    outputs = {}
    for target, value in ctx.build(ctx.cli_args.target).items():
        outputs.update({target.raw_target(): ctx.output.ensure_multiple(value.artifacts())})

    ctx.output.print_json(outputs)

build_test = bxl(
    implementation = _impl,
    cli_args = {
        "target": cli_args.target_label(),
    },
)

def _cquery_build(ctx):
    targets = ctx.cquery().kind("genrule", "...")

    outputs = []
    for value in ctx.build(targets).values():
        outputs.extend(ctx.output.ensure_multiple(value.artifacts()))

    ctx.output.print(sep = "\n", *outputs)

cquery_build_test = bxl(
    implementation = _cquery_build,
    cli_args = {},
)
