"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[10359],{28453:(e,i,n)=>{n.d(i,{R:()=>t,x:()=>l});var o=n(96540);const s={},r=o.createContext(s);function t(e){const i=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(r.Provider,{value:i},e.children)}},88416:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"concepts/isolation_dir","title":"Isolation Directory","description":"What is an Isolation Directory?","source":"@site/../docs/concepts/isolation_dir.md","sourceDirName":"concepts","slug":"/concepts/isolation_dir","permalink":"/docs/concepts/isolation_dir","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"isolation_dir","title":"Isolation Directory"},"sidebar":"main","previous":{"title":"Labels","permalink":"/docs/concepts/labels"},"next":{"title":".buckconfig","permalink":"/docs/concepts/buckconfig"}}');var s=n(74848),r=n(28453);const t={id:"isolation_dir",title:"Isolation Directory"},l="Isolation Directory",a={},c=[{value:"What is an Isolation Directory?",id:"what-is-an-isolation-directory",level:2},{value:"How Isolation Directories Work",id:"how-isolation-directories-work",level:2},{value:"Physical Structure",id:"physical-structure",level:3},{value:"Important Characteristics",id:"important-characteristics",level:3},{value:"When to Use Different Isolation Directories",id:"when-to-use-different-isolation-directories",level:2},{value:"1. Developer Environment Tooling",id:"1-developer-environment-tooling",level:3},{value:"2. Recursive Invocations",id:"2-recursive-invocations",level:3},{value:"3. Parallel Workflows",id:"3-parallel-workflows",level:3},{value:"How to Set the Isolation Directory",id:"how-to-set-the-isolation-directory",level:2},{value:"1. Command Line Argument",id:"1-command-line-argument",level:3},{value:"2. Environment Variable",id:"2-environment-variable",level:3},{value:"Command Scope and Isolation Directories",id:"command-scope-and-isolation-directories",level:2},{value:"Example Use Cases",id:"example-use-cases",level:2},{value:"Typical Development Workflow",id:"typical-development-workflow",level:3},{value:"Running Background Analysis Services",id:"running-background-analysis-services",level:3},{value:"Comparing Different Build Configurations",id:"comparing-different-build-configurations",level:3}];function d(e){const i={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"isolation-directory",children:"Isolation Directory"})}),"\n",(0,s.jsx)(i.h2,{id:"what-is-an-isolation-directory",children:"What is an Isolation Directory?"}),"\n",(0,s.jsx)(i.p,{children:"An isolation directory is a core mechanism in Buck2 that enables multiple\nindependent daemon instances to run concurrently. Each Buck2 daemon operates\nwithin its own isolation directory, creating a completely separated environment\nfor build processes."}),"\n",(0,s.jsx)(i.p,{children:"The isolation directory serves as a fundamental boundary that:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Separates cached artifacts between different daemon instances"}),"\n",(0,s.jsx)(i.li,{children:"Provides independent build environments with no shared state"}),"\n",(0,s.jsx)(i.li,{children:"Allows multiple Buck2 commands to run in parallel"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"how-isolation-directories-work",children:"How Isolation Directories Work"}),"\n",(0,s.jsx)(i.h3,{id:"physical-structure",children:"Physical Structure"}),"\n",(0,s.jsxs)(i.p,{children:["The isolation directory exists as a subdirectory within the ",(0,s.jsx)(i.code,{children:"buck-out"})," folder:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"project_root/\n\u2514\u2500\u2500 buck-out/\n    \u251c\u2500\u2500 v2/            # Default isolation directory\n    \u2502   \u251c\u2500\u2500 artifacts/\n    \u2502   \u251c\u2500\u2500 cache/\n    \u2502   \u2514\u2500\u2500 ...\n    \u251c\u2500\u2500 custom_name/   # Custom isolation directory\n    \u2502   \u251c\u2500\u2500 artifacts/\n    \u2502   \u251c\u2500\u2500 cache/\n    \u2502   \u2514\u2500\u2500 ...\n    \u2514\u2500\u2500 ...\n"})}),"\n",(0,s.jsxs)(i.p,{children:["By default, Buck2 uses an isolation directory named ",(0,s.jsx)(i.code,{children:"v2"}),", creating all build\noutputs and metadata within ",(0,s.jsx)(i.code,{children:"$PROJECT_ROOT/buck-out/v2"}),"."]}),"\n",(0,s.jsx)(i.h3,{id:"important-characteristics",children:"Important Characteristics"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Independent Caching"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Each isolation directory maintains its own separate cache"}),"\n",(0,s.jsx)(i.li,{children:"No cached artifacts or memory cache is shared between different isolation\ndirectories"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Command Execution Isolation"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"A single Buck2 daemon can generally execute only one command at a time"}),"\n",(0,s.jsx)(i.li,{children:"Different daemons with different isolation directories can execute commands\nconcurrently"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Resource Implications"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Using multiple isolation directories requires additional system resources"}),"\n",(0,s.jsx)(i.li,{children:"Each directory may duplicate build artifacts, consuming more disk space,\nmemory, and potentially network bandwidth"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.admonition,{type:"warning",children:[(0,s.jsxs)(i.mdxAdmonitionTitle,{children:[(0,s.jsx)(i.strong,{children:"Resource Usage Warning"}),": Using multiple isolation directories can"]}),(0,s.jsx)(i.p,{children:"significantly increase resource consumption due to duplicated caches and\nartifacts. Each isolation directory requires its own memory, disk space, and\npotentially network usage. :::"}),(0,s.jsx)(i.h2,{id:"when-to-use-different-isolation-directories",children:"When to Use Different Isolation Directories"}),(0,s.jsx)(i.p,{children:"Isolation directories are particularly useful in the following scenarios:"}),(0,s.jsx)(i.h3,{id:"1-developer-environment-tooling",children:"1. Developer Environment Tooling"}),(0,s.jsx)(i.p,{children:"Background services like Language Server Protocols (LSPs) can run in their own\nisolation directory without interfering with manually triggered builds."}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"# Running LSP in its own isolation directory\n$ buck2 --isolation-dir lsp lsp\n"})}),(0,s.jsx)(i.h3,{id:"2-recursive-invocations",children:"2. Recursive Invocations"}),(0,s.jsx)(i.p,{children:"When Buck2 needs to be called from within another Buck2 process, using different\nisolation directories prevents deadlocks and conflicts."}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"# Initial build\n$ buck2 build //some:target\n\n# Within this build, Buck2 might make another call using a different isolation dir\n$ buck2 --isolation-dir recursive_dir //dependency:target\n"})}),(0,s.jsx)(i.h3,{id:"3-parallel-workflows",children:"3. Parallel Workflows"}),(0,s.jsx)(i.p,{children:"When you need to run multiple independent build tasks simultaneously:"}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"# Building the application in one terminal\n$ buck2 build //app:binary\n\n# Running tests in another terminal simultaneously\n$ buck2 --isolation-dir test_dir test //app:tests\n"})}),(0,s.jsx)(i.h2,{id:"how-to-set-the-isolation-directory",children:"How to Set the Isolation Directory"}),(0,s.jsx)(i.p,{children:"There are two ways to specify which isolation directory to use:"}),(0,s.jsx)(i.h3,{id:"1-command-line-argument",children:"1. Command Line Argument"}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"$ buck2 --isolation-dir DIRECTORY_NAME COMMAND [ARGS]\n"})}),(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Important"}),": The ",(0,s.jsx)(i.code,{children:"--isolation-dir"})," argument must always appear immediately\nafter ",(0,s.jsx)(i.code,{children:"buck2"}),". For example, ",(0,s.jsx)(i.code,{children:"buck2 build --isolation-dir v2 target"})," is not\nvalid."]}),(0,s.jsx)(i.h3,{id:"2-environment-variable",children:"2. Environment Variable"}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"$ BUCK_ISOLATION_DIR=DIRECTORY_NAME buck2 COMMAND [ARGS]\n"})}),(0,s.jsxs)(i.p,{children:["If not specified, the default isolation directory name is ",(0,s.jsx)(i.code,{children:"v2"}),"."]}),(0,s.jsx)(i.h2,{id:"command-scope-and-isolation-directories",children:"Command Scope and Isolation Directories"}),(0,s.jsx)(i.p,{children:"Most Buck2 commands only operate within their specified isolation directory. For\nexample:"}),(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"buck2 build"})," only builds using the specified isolation directory"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"buck2 clean"})," only cleans the specified isolation directory"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"buck2 kill"})," only kills the daemon associated with the specified isolation\ndirectory"]}),"\n"]}),(0,s.jsxs)(i.p,{children:["There are exceptions, such as ",(0,s.jsx)(i.code,{children:"buck2 killall"}),", which affects all Buck2 processes\nregardless of their isolation directories."]}),(0,s.jsx)(i.h2,{id:"example-use-cases",children:"Example Use Cases"}),(0,s.jsx)(i.h3,{id:"typical-development-workflow",children:"Typical Development Workflow"}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"# Using the default isolation directory\n$ buck2 build //app:binary\n$ buck2 run //app:binary\n"})}),(0,s.jsx)(i.h3,{id:"running-background-analysis-services",children:"Running Background Analysis Services"}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"# Start a language server in a dedicated isolation directory\n$ buck2 --isolation-dir ide lsp &\n\n# Continue with regular builds in the default isolation directory\n$ buck2 build //app:binary\n"})}),(0,s.jsx)(i.h3,{id:"comparing-different-build-configurations",children:"Comparing Different Build Configurations"}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sh",children:"# Build with one set of configurations\n$ buck2 --isolation-dir config1 build //app:binary\n\n# Build with different configurations in a separate isolation directory\n$ buck2 --isolation-dir config2 build //app:binary\n"})})]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);