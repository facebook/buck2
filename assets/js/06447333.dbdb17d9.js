"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[78345],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(96540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}},83385:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"prelude/rules/cxx/prebuilt_cxx_library","title":"prebuilt_cxx_library","description":"A prebuiltcxxlibrary() rule represents a set of native libraries and C/C++ header files and provides various flags to control how they are linked and exported.","source":"@site/../docs/prelude/rules/cxx/prebuilt_cxx_library.md","sourceDirName":"prelude/rules/cxx","slug":"/prelude/rules/cxx/prebuilt_cxx_library","permalink":"/docs/prelude/rules/cxx/prebuilt_cxx_library","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ruleSidebar","previous":{"title":"llvm_link_bitcode","permalink":"/docs/prelude/rules/cxx/llvm_link_bitcode"},"next":{"title":"prebuilt_cxx_library_group","permalink":"/docs/prelude/rules/cxx/prebuilt_cxx_library_group"}}');var i=s(74848),r=s(28453);s(56289);const l={},o="prebuilt_cxx_library",d={},a=[{value:"Function Signature",id:"function-signature",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Examples",id:"examples",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"prebuilt_cxx_library",children:"prebuilt_cxx_library"})}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.code,{children:"prebuilt_cxx_library()"})," rule represents a set of native libraries and C/C++ header files and provides various flags to control how they are linked and exported."]}),"\n",(0,i.jsx)(n.h3,{id:"function-signature",children:"Function Signature"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def prebuilt_cxx_library(\n    *,\n    name: str,\n    default_target_platform: None | str = None,\n    target_compatible_with: list[str] = [],\n    compatible_with: list[str] = [],\n    exec_compatible_with: list[str] = [],\n    visibility: list[str] = [],\n    within_view: list[str] = ["PUBLIC"],\n    metadata: OpaqueMetadata = {},\n    tests: list[str] = [],\n    modifiers: OpaqueMetadata = [],\n    _apple_platforms: dict[str, str] = {},\n    _create_third_party_build_root: str = "prelude//third-party/tools:create_build",\n    _cxx_toolchain: str = "gh_facebook_buck2_shims_meta//:cxx",\n    _target_os_type: str = "prelude//os_lookup/targets:os_lookup",\n    allow_cache_upload: None | bool = None,\n    can_be_asset: bool = False,\n    contacts: list[str] = [],\n    default_host_platform: None | str = None,\n    deffile: None | str = None,\n    deps: list[str] = [],\n    exported_deps: list[str] = [],\n    exported_header_style: str = "system",\n    exported_headers: list[str] | dict[str, str] = [],\n    exported_lang_preprocessor_flags: dict[str, list[str]] = {},\n    exported_linker_flags: list[str] = [],\n    exported_post_linker_flags: list[str] = [],\n    exported_preprocessor_flags: list[str] = [],\n    extract_soname: bool = False,\n    force_static: bool = False,\n    frameworks: list[str] = [],\n    header_dirs: None | list[str] = None,\n    header_namespace: None | str = None,\n    header_only: bool = False,\n    import_lib: None | str = None,\n    include_in_android_merge_map_output: bool = True,\n    labels: list[str] = [],\n    libraries: list[str] = [],\n    licenses: list[str] = [],\n    link_whole: bool = False,\n    link_without_soname: bool = False,\n    linker_flags: list[str] = [],\n    local_linker_flags: list[str] = [],\n    local_linker_script_flags: list[str] = [],\n    platform_header_dirs: None | list[(str, list[str])] = None,\n    platform_import_lib: None | list[(str, str)] = None,\n    post_linker_flags: list[str] = [],\n    preferred_linkage: str = "any",\n    prestripped: bool = False,\n    provided: bool = False,\n    public_include_directories: list[str] = [],\n    public_system_include_directories: list[str] = [],\n    raw_headers: list[str] = [],\n    shared_lib: None | str = None,\n    soname: None | str = None,\n    static_lib: None | str = None,\n    static_pic_lib: None | str = None,\n    stub: bool = False,\n    supported_platforms_regex: None | str = None,\n    supports_lto: bool = False,\n    supports_merged_linking: None | bool = None,\n    supports_python_dlopen: bool = True,\n    supports_shared_library_interface: bool = True,\n    third_party_build: None | str = None,\n    version: None | str = None,\n    versioned_exported_lang_preprocessor_flags: list[(dict[str, str], dict[str, list[str]])] = [],\n    versioned_exported_preprocessor_flags: list[(dict[str, str], list[str])] = [],\n    versioned_header_dirs: None | list[(dict[str, str], list[str])] = None,\n    versioned_import_lib: None | list[(dict[str, str], str)] = None,\n    versioned_shared_lib: None | list[(dict[str, str], str)] = None,\n    versioned_soname: None | list[(dict[str, str], str)] = None,\n    versioned_static_lib: None | list[(dict[str, str], str)] = None,\n    versioned_static_pic_lib: None | list[(dict[str, str], str)] = None,\n) -> None\n'})}),"\n",(0,i.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"name"}),": (required)"]}),"\n",(0,i.jsx)(n.p,{children:"name of the target"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"default_target_platform"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"specifies the default target platform, used when no platforms are specified on the command line"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"target_compatible_with"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"compatible_with"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exec_compatible_with"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"visibility"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of visibility patterns restricting what targets can depend on this one"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"within_view"}),": (defaults to: ",(0,i.jsx)(n.code,{children:'["PUBLIC"]'}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of visibility patterns restricting what this target can depend on"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"metadata"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"{}"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a key-value map of metadata associated with this target"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tests"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of targets that provide tests for this one"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"modifiers"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"an array of modifiers associated with this target"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"allow_cache_upload"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"Whether to allow uploading the output of this rule to be uploaded to cache when the action is executed locally if the configuration allows (i.e. there is a cache configured and the client has permission to write to it)."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"contacts"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"A list of organizational contacts for this rule. These could be individuals who you would contact in the event of a failure or other issue with the rule."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"contacts = [ 'Joe Sixpack', 'Erika Mustermann' ]\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"deffile"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Specifies the *.def file used on windows to modify a dll's exports in place of explicit ",(0,i.jsx)(n.code,{children:"__declspec(dllexport)"})," declarations. The default is to not use a defile."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exported_deps"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Dependencies that will also appear to belong to any rules that depend on this one. This has two effects: * Exported dependencies will also be included in the link line of dependents of this rules, but normal dependencies will not. * When ",(0,i.jsx)(n.code,{children:"reexport_all_header_dependencies = False"}),", only exported headers of the rules specified here are re-exported."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exported_headers"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["The set of header files that are made available for inclusion to the source files in the target and all targets that transitively depend on it. These should be specified as either a list of header files or a dictionary of header names to header files. The headers can be included with ",(0,i.jsx)(n.code,{children:'#include "$HEADER_NAMESPACE/$HEADER_NAME"'})," or ",(0,i.jsx)(n.code,{children:"#include <$HEADER_NAMESPACE/$HEADER_NAME>"}),", where ",(0,i.jsx)(n.code,{children:"$HEADER_NAMESPACE"})," is the value of the target's ",(0,i.jsx)(n.code,{children:"header_namespace"})," attribute, and ",(0,i.jsx)(n.code,{children:"$HEADER_NAME"})," is the header name if specified, and the filename of the header file otherwise. Note that the header name can contain forward slashes (",(0,i.jsx)(n.code,{children:"/"}),"). See ",(0,i.jsx)(n.code,{children:"header_namespace"})," for more information."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exported_linker_flags"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"Flags to add to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"header_namespace"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.jsx)(n.code,{children:"/"}),"), but cannot start with one. See ",(0,i.jsx)(n.code,{children:"headers"})," for more information."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"header_only"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"False"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Indicates if this library only consists of headers or not. If this is set to ",(0,i.jsx)(n.code,{children:"True"}),", Buck will not link this library into any library that depends on it."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"labels"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Set of arbitrary strings which allow you to annotate a ",(0,i.jsx)(n.a,{href:"https://buck2.build/docs/concepts/build_rule/",children:"build rule"})," with tags that can be searched for over an entire dependency tree using ",(0,i.jsx)(n.code,{children:"buck query()"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"licenses"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Set of license files for this library. To get the list of license files for a given build rule and all of its dependencies, you can use ",(0,i.jsx)(n.a,{href:"https://buck2.build/docs/users/commands/query/",children:"buck query"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"local_linker_flags"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Flags to add to the linker command line whenever the output from this rule is used in a link operation ",(0,i.jsx)(n.em,{children:"driven by this rule"})," (e.g. when this rule links a shared library, but ",(0,i.jsx)(n.em,{children:"not"})," when the output is linked into a shared library by another rule's link group links)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"local_linker_script_flags"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Linker script lags to add to the linker command line whenever the output from this rule is used in a link operation ",(0,i.jsx)(n.em,{children:"driven by this rule"}),". Used by rules that need to treat linker script flags different from normal linker flags."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"preferred_linkage"}),": (defaults to: ",(0,i.jsx)(n.code,{children:'"any"'}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Determines what linkage is used when the library is depended on by another target. To control how the dependencies of this library are linked, use ",(0,i.jsx)(n.code,{children:"link_style"})," instead."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"prestripped"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"False"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["When set, skips running ",(0,i.jsx)(n.code,{children:"strip"})," commands when building this library."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"shared_lib"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"The path to the library to use when performing shared linking."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"static_lib"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"The path to the library to use when performing static linking."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"static_pic_lib"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"The path to the library to use when performing static PIC linking."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"supported_platforms_regex"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"If present, an un-anchored regex (in java.util.regex.Pattern syntax) that matches all platforms that this library supports. It will not be built for other platforms."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"supports_merged_linking"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Whether this rule supports building with the merged linking strategy when building for non-native binaries (e.g. when using ",(0,i.jsx)(n.code,{children:".buckconfig"})," s ",(0,i.jsx)(n.code,{children:"merged"})," setting)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"version"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"A string denoting a meaningful version of this rule that is optionally passed to the linker as extra metadata."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.p,{children:"A prebuilt library containing only headers that other libraries may need."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"\nprebuilt_cxx_library(\n  name = 'stdutil',\n  header_only = True,\n  header_dirs = [\n    'include',\n  ],\n)\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"A prebuilt library with static and shared libs."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"\nprebuilt_cxx_library(\n  name = 'mylib',\n  soname = 'libmylib.so',\n  static_lib = 'libmylib.a',\n  static_pic_lib = 'libmylib_pic.a',\n  shared_lib = 'libmylib.so',\n  exported_headers = [\n    'mylib.h',\n  ],\n)\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);