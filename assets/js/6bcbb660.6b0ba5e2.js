"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[62662],{28453:(e,s,t)=>{t.d(s,{R:()=>a,x:()=>n});var i=t(96540);const l={},r=i.createContext(l);function a(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function n(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),i.createElement(r.Provider,{value:s},e.children)}},46172:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>p,frontMatter:()=>n,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"api/bxl/Filesystem","title":"Filesystem","description":"Provides some basic tracked filesystem access for bxl functions so that they can meaningfully detect simple properties of artifacts, and source directories.","source":"@site/../docs/api/bxl/Filesystem.md","sourceDirName":"api/bxl","slug":"/api/bxl/Filesystem","permalink":"/docs/api/bxl/Filesystem","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"apiSidebar","previous":{"title":"FileNode","permalink":"/docs/api/bxl/FileNode"},"next":{"title":"Lazy","permalink":"/docs/api/bxl/Lazy"}}');var l=t(74848),r=t(28453),a=t(56289);const n={},d="Filesystem",o={},c=[{value:"Filesystem.abs_path_unsafe",id:"filesystemabs_path_unsafe",level:2},{value:"Filesystem.exists",id:"filesystemexists",level:2},{value:"Filesystem.is_dir",id:"filesystemis_dir",level:2},{value:"Filesystem.is_file",id:"filesystemis_file",level:2},{value:"Filesystem.list",id:"filesystemlist",level:2},{value:"Filesystem.project_rel_path",id:"filesystemproject_rel_path",level:2},{value:"Filesystem.source",id:"filesystemsource",level:2}];function h(e){const s={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"filesystem",children:"Filesystem"})}),"\n",(0,l.jsx)(s.p,{children:"Provides some basic tracked filesystem access for bxl functions so that they can meaningfully detect simple properties of artifacts, and source directories."}),"\n",(0,l.jsx)(s.h2,{id:"filesystemabs_path_unsafe",children:"Filesystem.abs_path_unsafe"}),"\n",(0,l.jsx)("pre",{class:"language-python",children:(0,l.jsxs)("code",{children:["def Filesystem.abs_path_unsafe(\nexpr: ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/FileNode",children:"bxl.FileNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),",\n) -> ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"})]})}),"\n",(0,l.jsx)(s.p,{children:"Returns the absolute path, given the file expression. Use at your own risk, as the current working directory may have been changed when this function is called. In addition, passing the absolute path into actions that are run remotely will most likely result in failures since the absolute path most likely differs locally vs remotely."}),"\n",(0,l.jsx)(s.p,{children:"Sample usage:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'def _impl_abs_path_unsafe(ctx):\n    ctx.output.print(ctx.fs.abs_path_unsafe("bin"))\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"filesystemexists",children:"Filesystem.exists"}),"\n",(0,l.jsx)("pre",{class:"language-python",children:(0,l.jsxs)("code",{children:["def Filesystem.exists(\nexpr: ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/FileNode",children:"bxl.FileNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),",\n) -> ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/bool",children:"bool"})]})}),"\n",(0,l.jsxs)(s.p,{children:["Check if a path exists on disk, taking advantage of Buck's cached filesystem. Takes in a literal, a source artifact (via ",(0,l.jsx)(s.code,{children:"artifact"}),"), or a ",(0,l.jsx)(s.code,{children:"file_node"}),"."]}),"\n",(0,l.jsx)(s.p,{children:"Sample usage:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'def _impl_exists(ctx):\n    ctx.output.print(ctx.fs.exists("bin"))\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"filesystemis_dir",children:"Filesystem.is_dir"}),"\n",(0,l.jsx)("pre",{class:"language-python",children:(0,l.jsxs)("code",{children:["def Filesystem.is_dir(\nexpr: ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/FileNode",children:"bxl.FileNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),",\n) -> ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/bool",children:"bool"})]})}),"\n",(0,l.jsxs)(s.p,{children:["Returns whether the provided path is a dir. Returns false is the dir does not exist. The input is a either a literal, a source artifact (via ",(0,l.jsx)(s.code,{children:"artifact"}),"), or a ",(0,l.jsx)(s.code,{children:"file_node"}),"."]}),"\n",(0,l.jsx)(s.p,{children:"Sample usage:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'def _impl_is_dir(ctx):\n    ctx.output.print(ctx.fs.is_dir("bin"))\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"filesystemis_file",children:"Filesystem.is_file"}),"\n",(0,l.jsx)("pre",{class:"language-python",children:(0,l.jsxs)("code",{children:["def Filesystem.is_file(\nexpr: ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/FileNode",children:"bxl.FileNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),",\n) -> ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/bool",children:"bool"})]})}),"\n",(0,l.jsxs)(s.p,{children:["Returns whether the provided path is a file. Returns false is the file does not exist. The input is a either a literal, a source artifact (via ",(0,l.jsx)(s.code,{children:"artifact"}),"), or a ",(0,l.jsx)(s.code,{children:"file_node"}),"."]}),"\n",(0,l.jsx)(s.p,{children:"Sample usage:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'def _impl_is_file(ctx):\n    ctx.output.print(ctx.fs.is_dir("bin"))\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"filesystemlist",children:"Filesystem.list"}),"\n",(0,l.jsx)("pre",{class:"language-python",children:(0,l.jsxs)("code",{children:["def Filesystem.list(\nexpr: ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/FileNode",children:"bxl.FileNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),",\n*,\ndirs_only: ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\n) -> bxl.ReadDirSet"]})}),"\n",(0,l.jsxs)(s.p,{children:["Returns all the contents of the given input that points to a directory. Errors if the given path is a file. Takes an optional boolean ",(0,l.jsx)(s.code,{children:"dirs_only"})," to only return directories, defaults to false."]}),"\n",(0,l.jsxs)(s.p,{children:["The input is a either a literal, a source artifact (via ",(0,l.jsx)(s.code,{children:"artifact"}),"), or a ",(0,l.jsx)(s.code,{children:"file_node"}),"."]}),"\n",(0,l.jsx)(s.p,{children:"Sample usage:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'def _impl_list(ctx):\n    list_results = ctx.fs.list("bin")\n    for result in list_results:\n        ctx.output.print(result)\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"filesystemproject_rel_path",children:"Filesystem.project_rel_path"}),"\n",(0,l.jsx)("pre",{class:"language-python",children:(0,l.jsxs)("code",{children:["def Filesystem.project_rel_path(\nexpr: ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/FileNode",children:"bxl.FileNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),",\n) -> ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"})]})}),"\n",(0,l.jsx)(s.p,{children:"Returns the relative path to the project root, given the file expression."}),"\n",(0,l.jsx)(s.p,{children:"Sample usage:"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-python",children:'def project_rel_path(ctx):\n    ctx.output.print(ctx.fs.project_rel_path("bin"))\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"filesystemsource",children:"Filesystem.source"}),"\n",(0,l.jsx)("pre",{class:"language-python",children:(0,l.jsxs)("code",{children:["def Filesystem.source(\nexpr: ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/FileNode",children:"bxl.FileNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),",\ntarget_hint: None | ",(0,l.jsx)(a.default,{to:"/docs/api/build/TargetLabel",children:"TargetLabel"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/UnconfiguredTargetNode",children:"bxl.UnconfiguredTargetNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/UnconfiguredTargetSet",children:"target_set"})," | list[",(0,l.jsx)(a.default,{to:"/docs/api/build/TargetLabel",children:"TargetLabel"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/bxl/UnconfiguredTargetNode",children:"bxl.UnconfiguredTargetNode"})," | ",(0,l.jsx)(a.default,{to:"/docs/api/starlark/str",children:"str"}),"] = None,\n) -> ",(0,l.jsx)(a.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,l.jsx)(s.p,{children:"Returns the source artifact for a path and an optional target hint (unconfigured target label or node) which points to the owning package. If no target hint is given, the nearest package will be used to guess the desired artifact. The path should be either an absolute path, or a project relative path."})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);