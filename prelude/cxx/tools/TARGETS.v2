load("@fbcode_macros//build_defs/lib:python_common.bzl", "get_ldflags", "get_strip_mode")
load(":defs.bzl", "cxx_hacks", "omnibus_environment")

prelude = native

prelude.python_bootstrap_binary(
    name = "make_comp_db",
    main = "make_comp_db.py",
    visibility = ["PUBLIC"],
)

prelude.python_bootstrap_binary(
    name = "makefile_to_dep_file",
    main = "makefile_to_dep_file.py",
    visibility = ["PUBLIC"],
)

# Required to support the $(cxx-header-tree) macro
cxx_hacks(
    name = "cxx_hacks",
    visibility = ["PUBLIC"],
)

enable_explicit_roots = read_config("buck2", "enable_omnibus_explicit_roots", "false") in ["true", "True"]

# This node is injected into CXX toolchains to optimize Omnibus builds with shared hints.
omnibus_environment(
    name = "omnibus_environment",
    # Generate using fbcode/buck2/omnibus_tools/exclusions.bxl
    # FIXME: prelude// should be standalone (not refer to fbcode//)
    exclusions = [
        "fbcode//third-party-buck/platform010/build/AFLplusplus:libcompcov",
        "fbcode//third-party-buck/platform010/build/AFLplusplus:libdislocator",
        "fbcode//third-party-buck/platform010/build/AFLplusplus:libqasan",
        "fbcode//third-party-buck/platform010/build/AFLplusplus:unsigaction",
        "fbcode//third-party-buck/platform010/build/AddressDoctor:AddressDoctor5",
        "fbcode//third-party-buck/platform010/build/Imath:Imath",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:force_share_for_link_groups_T126601257__libmkl_avx2.so",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:force_share_for_link_groups_T126601257__libmkl_avx512.so",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:force_share_for_link_groups_T126601257__libmkl_core.so",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:force_share_for_link_groups_T126601257__libmkl_def.so",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:force_share_for_link_groups_T126601257__libmkl_intel_lp64.so",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:force_share_for_link_groups_T126601257__libmkl_intel_thread.so",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:force_share_for_link_groups_T126601257__libmkl_mc3.so",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:iomp5",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcc",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcce9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcck0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippccl9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippccm7",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippccn0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippccn8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippccy8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippch",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippche9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippchk0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippchl9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippchm7",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippchn0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippchn8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippchy8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcore",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcv",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcve9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcvk0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcvl9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcvm7",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcvn0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcvn8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippcvy8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdc",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdce9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdck0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdcl9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdcm7",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdcn0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdcn8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippdcy8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippi",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippie9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippik0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippil9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippim7",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippin0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippin8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippiy8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ipps",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippse9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippsk0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippsl9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippsm7",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippsn0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippsn8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippsy8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvm",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvme9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvmk0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvml9",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvmm7",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvmn0",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvmn8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:ippvmy8",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:mkl_ilp64_iomp",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:mkl_lp64_gomp",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:mkl_lp64_iomp",
        "fbcode//third-party-buck/platform010/build/IntelComposerXE:mkl_lp64_omp",
        "fbcode//third-party-buck/platform010/build/Ipopt:Ipopt",
        "fbcode//third-party-buck/platform010/build/MsAsrEngine:SpeechToText",
        "fbcode//third-party-buck/platform010/build/MsAsrEngine:boost_filesystem",
        "fbcode//third-party-buck/platform010/build/MsAsrEngine:boost_program_options",
        "fbcode//third-party-buck/platform010/build/MsAsrEngine:boost_system",
        "fbcode//third-party-buck/platform010/build/MsTtsEngine:MSTTSEngine",
        "fbcode//third-party-buck/platform010/build/OpenBLAS:OpenBLAS",
        "fbcode//third-party-buck/platform010/build/OpenEXR3:Iex",
        "fbcode//third-party-buck/platform010/build/OpenEXR3:IlmThread",
        "fbcode//third-party-buck/platform010/build/OpenEXR3:OpenEXR3",
        "fbcode//third-party-buck/platform010/build/PVRTexTool:PVRTexLib",
        "fbcode//third-party-buck/platform010/build/TensorRT:nvinfer",
        "fbcode//third-party-buck/platform010/build/TensorRT:nvinfer_plugin",
        "fbcode//third-party-buck/platform010/build/TensorRT:nvonnxparser",
        "fbcode//third-party-buck/platform010/build/TensorRT:nvparsers",
        "fbcode//third-party-buck/platform010/build/alsa-lib:asound",
        "fbcode//third-party-buck/platform010/build/alteracl:alteracl",
        "fbcode//third-party-buck/platform010/build/aom:aom",
        "fbcode//third-party-buck/platform010/build/apache-arrow:arrow",
        "fbcode//third-party-buck/platform010/build/apache-arrow:arrow_python",
        "fbcode//third-party-buck/platform010/build/apr:apr",
        "fbcode//third-party-buck/platform010/build/apr-util:apr-util",
        "fbcode//third-party-buck/platform010/build/arista-toolchain-melbourne:c",
        "fbcode//third-party-buck/platform010/build/arista-toolchain-melbourne:dl",
        "fbcode//third-party-buck/platform010/build/arista-toolchain-melbourne:m",
        "fbcode//third-party-buck/platform010/build/arista-toolchain-melbourne:pthread",
        "fbcode//third-party-buck/platform010/build/arista-toolchain-melbourne:rt",
        "fbcode//third-party-buck/platform010/build/arista-toolchain-melbourne:stdc++",
        "fbcode//third-party-buck/platform010/build/arista-toolchain-melbourne:stdc++fs",
        "fbcode//third-party-buck/platform010/build/attr:attr",
        "fbcode//third-party-buck/platform010/build/augeas:augeas",
        "fbcode//third-party-buck/platform010/build/berkeley-db:berkeley-db",
        "fbcode//third-party-buck/platform010/build/bitstream_mode3_videoparser:avcodec",
        "fbcode//third-party-buck/platform010/build/bitstream_mode3_videoparser:avformat",
        "fbcode//third-party-buck/platform010/build/bitstream_mode3_videoparser:avutil",
        "fbcode//third-party-buck/platform010/build/boost:boost",
        "fbcode//third-party-buck/platform010/build/boost:boost_filesystem",
        "fbcode//third-party-buck/platform010/build/boost:boost_lexical_cast",
        "fbcode//third-party-buck/platform010/build/boost:boost_python",
        "fbcode//third-party-buck/platform010/build/boost:boost_range",
        "fbcode//third-party-buck/platform010/build/boost:boost_regex",
        "fbcode//third-party-buck/platform010/build/boost:boost_system",
        "fbcode//third-party-buck/platform010/build/btrfs-progs:btrfsutil",
        "fbcode//third-party-buck/platform010/build/bzip2:bz2",
        "fbcode//third-party-buck/platform010/build/c-ares:c-ares",
        "fbcode//third-party-buck/platform010/build/coredumper:coredumper",
        "fbcode//third-party-buck/platform010/build/cuda:accinj64",
        "fbcode//third-party-buck/platform010/build/cuda:cuda",
        "fbcode//third-party-buck/platform010/build/cuda:cuda-lazy",
        "fbcode//third-party-buck/platform010/build/cuda:cuda_drive_api",
        "fbcode//third-party-buck/platform010/build/cuda:cuda_drive_api-lazy",
        "fbcode//third-party-buck/platform010/build/cuda:cuda_driver_api",
        "fbcode//third-party-buck/platform010/build/cuda:cudart",
        "fbcode//third-party-buck/platform010/build/cuda:cufft",
        "fbcode//third-party-buck/platform010/build/cuda:cufftw",
        "fbcode//third-party-buck/platform010/build/cuda:cuinj64",
        "fbcode//third-party-buck/platform010/build/cuda:cupti",
        "fbcode//third-party-buck/platform010/build/cuda:curand",
        "fbcode//third-party-buck/platform010/build/cuda:cusolver",
        "fbcode//third-party-buck/platform010/build/cuda:cusparse",
        "fbcode//third-party-buck/platform010/build/cuda:nppc",
        "fbcode//third-party-buck/platform010/build/cuda:nppial",
        "fbcode//third-party-buck/platform010/build/cuda:nppicc",
        "fbcode//third-party-buck/platform010/build/cuda:nppidei",
        "fbcode//third-party-buck/platform010/build/cuda:nppif",
        "fbcode//third-party-buck/platform010/build/cuda:nppig",
        "fbcode//third-party-buck/platform010/build/cuda:nppim",
        "fbcode//third-party-buck/platform010/build/cuda:nppist",
        "fbcode//third-party-buck/platform010/build/cuda:nppisu",
        "fbcode//third-party-buck/platform010/build/cuda:nppitc",
        "fbcode//third-party-buck/platform010/build/cuda:npps",
        "fbcode//third-party-buck/platform010/build/cuda:nvToolsExt",
        "fbcode//third-party-buck/platform010/build/cuda:nvblas",
        "fbcode//third-party-buck/platform010/build/cuda:nvdec",
        "fbcode//third-party-buck/platform010/build/cuda:nvenc",
        "fbcode//third-party-buck/platform010/build/cuda:nvjpeg",
        "fbcode//third-party-buck/platform010/build/cuda:nvml",
        "fbcode//third-party-buck/platform010/build/cuda:nvml-lazy",
        "fbcode//third-party-buck/platform010/build/cuda:nvperf_host",
        "fbcode//third-party-buck/platform010/build/cuda:nvperf_target",
        "fbcode//third-party-buck/platform010/build/cuda:nvrtc",
        "fbcode//third-party-buck/platform010/build/cuda:nvrtc-builtins",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn-lazy",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_adv_infer",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_adv_infer-lazy",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_adv_train",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_adv_train-lazy",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_cnn_infer",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_cnn_infer-lazy",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_cnn_train",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_cnn_train-lazy",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_ops_infer",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_ops_infer-lazy",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_ops_train",
        "fbcode//third-party-buck/platform010/build/cudnn:cudnn_ops_train-lazy",
        "fbcode//third-party-buck/platform010/build/curl:curl",
        "fbcode//third-party-buck/platform010/build/cyrus-sasl:sasl2",
        "fbcode//third-party-buck/platform010/build/db:db",
        "fbcode//third-party-buck/platform010/build/elfutils:elf",
        "fbcode//third-party-buck/platform010/build/eset:esdk",
        "fbcode//third-party-buck/platform010/build/essim:essim",
        "fbcode//third-party-buck/platform010/build/expat:expat",
        "fbcode//third-party-buck/platform010/build/faac:faac",
        "fbcode//third-party-buck/platform010/build/fb-nnpi:fb-nnpi-hwtrace",
        "fbcode//third-party-buck/platform010/build/fb-nnpi:fb-nnpi-icecaps",
        "fbcode//third-party-buck/platform010/build/fb-nnpi:fb-nnpi-inference",
        "fbcode//third-party-buck/platform010/build/fb-nnpi:fb-nnpi-ml",
        "fbcode//third-party-buck/platform010/build/fb-nnpi:fb-nnpi-transformer_dynamic_no_commit",
        "fbcode//third-party-buck/platform010/build/fb-nnpi:fb-nnpi-umd2",
        "fbcode//third-party-buck/platform010/build/fdk-aac:fdk-aac",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:avcodec",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:avdevice",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:avfilter",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:avformat",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:avutil",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:postproc",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:swresample",
        "fbcode//third-party-buck/platform010/build/ffmpeg-ref:swscale",
        "fbcode//third-party-buck/platform010/build/fftw3:fftw3",
        "fbcode//third-party-buck/platform010/build/fftw3f:fftw3f",
        "fbcode//third-party-buck/platform010/build/file:magic",
        "fbcode//third-party-buck/platform010/build/flint2:flint",
        "fbcode//third-party-buck/platform010/build/forecastpro:forecastpro",
        "fbcode//third-party-buck/platform010/build/freetds:sybdb",
        "fbcode//third-party-buck/platform010/build/freetype:freetype",
        "fbcode//third-party-buck/platform010/build/gdal:gdal",
        "fbcode//third-party-buck/platform010/build/gdbm:gdbm",
        "fbcode//third-party-buck/platform010/build/gdbm:gdbm_compat",
        "fbcode//third-party-buck/platform010/build/geos:geos",
        "fbcode//third-party-buck/platform010/build/geos:geos_c",
        "fbcode//third-party-buck/platform010/build/gflags:gflags",
        "fbcode//third-party-buck/platform010/build/glibc:c",
        "fbcode//third-party-buck/platform010/build/glibc:c_opt",
        "fbcode//third-party-buck/platform010/build/glibc:crypt",
        "fbcode//third-party-buck/platform010/build/glibc:dl",
        "fbcode//third-party-buck/platform010/build/glibc:m",
        "fbcode//third-party-buck/platform010/build/glibc:m_opt",
        "fbcode//third-party-buck/platform010/build/glibc:mvec",
        "fbcode//third-party-buck/platform010/build/glibc:pthread",
        "fbcode//third-party-buck/platform010/build/glibc:resolv",
        "fbcode//third-party-buck/platform010/build/glibc:rt",
        "fbcode//third-party-buck/platform010/build/glibc:util",
        "fbcode//third-party-buck/platform010/build/glog:glog",
        "fbcode//third-party-buck/platform010/build/glpk:glpk",
        "fbcode//third-party-buck/platform010/build/gmp:gmp",
        "fbcode//third-party-buck/platform010/build/gmp:gmpxx",
        "fbcode//third-party-buck/platform010/build/gnutls:gnutls",
        "fbcode//third-party-buck/platform010/build/gsm:gsm",
        "fbcode//third-party-buck/platform010/build/habanalabs:Synapse",
        "fbcode//third-party-buck/platform010/build/habanalabs:tpc_kernels",
        "fbcode//third-party-buck/platform010/build/habanalabs:tpcsim_shared",
        "fbcode//third-party-buck/platform010/build/harminv:harminv",
        "fbcode//third-party-buck/platform010/build/hdf5:hdf5",
        "fbcode//third-party-buck/platform010/build/hdf5:hdf5_hl",
        "fbcode//third-party-buck/platform010/build/http_parser:http_parser",
        "fbcode//third-party-buck/platform010/build/icu:icudata",
        "fbcode//third-party-buck/platform010/build/icu:icui18n",
        "fbcode//third-party-buck/platform010/build/icu:icuuc",
        "fbcode//third-party-buck/platform010/build/ilmbase:Half",
        "fbcode//third-party-buck/platform010/build/ilmbase:Iex",
        "fbcode//third-party-buck/platform010/build/ilmbase:IexMath",
        "fbcode//third-party-buck/platform010/build/ilmbase:IlmThread",
        "fbcode//third-party-buck/platform010/build/ilmbase:Imath",
        "fbcode//third-party-buck/platform010/build/intel_mediasdk_stubs:mfx",
        "fbcode//third-party-buck/platform010/build/jack2:jackserver",
        "fbcode//third-party-buck/platform010/build/keyutils:keyutils",
        "fbcode//third-party-buck/platform010/build/krb5:com_err",
        "fbcode//third-party-buck/platform010/build/krb5:gssapi_krb5",
        "fbcode//third-party-buck/platform010/build/krb5:gssrpc",
        "fbcode//third-party-buck/platform010/build/krb5:k5crypto",
        "fbcode//third-party-buck/platform010/build/krb5:krb5",
        "fbcode//third-party-buck/platform010/build/krb5:krb5support",
        "fbcode//third-party-buck/platform010/build/lame:mp3lame",
        "fbcode//third-party-buck/platform010/build/lcms2:lcms2",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-apb",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-cadence",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-cadencepci",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-common",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-cpu2jtag",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-hld",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-hw_tables",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-lld",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-lld_conn",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-nsim_kernel",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-ra",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-sai",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.1:dyn-vendorsrm",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-apb",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-cadence",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-cadencepci",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-common",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-cpu2jtag",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-hld",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-hw_tables",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-lld",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-lld_conn",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-nsim_kernel",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-ra",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-sai",
        "fbcode//third-party-buck/platform010/build/leaba-sdk/1.42.4:dyn-vendorsrm",
        "fbcode//third-party-buck/platform010/build/libX11:X11",
        "fbcode//third-party-buck/platform010/build/libXau:Xau",
        "fbcode//third-party-buck/platform010/build/libaio:aio",
        "fbcode//third-party-buck/platform010/build/libarchive:libarchive",
        "fbcode//third-party-buck/platform010/build/libctl:ctlgeom",
        "fbcode//third-party-buck/platform010/build/libdrm:drm",
        "fbcode//third-party-buck/platform010/build/libdrm:drm_amdgpu",
        "fbcode//third-party-buck/platform010/build/libfabric:libfabric",
        "fbcode//third-party-buck/platform010/build/libffi:ffi",
        "fbcode//third-party-buck/platform010/build/libgcc:atomic",
        "fbcode//third-party-buck/platform010/build/libgcc:gcc_s",
        "fbcode//third-party-buck/platform010/build/libgcc:gfortran",
        "fbcode//third-party-buck/platform010/build/libgcc:stdc++",
        "fbcode//third-party-buck/platform010/build/libgcc:stdc++-legacy",
        "fbcode//third-party-buck/platform010/build/libgcc:stdc++_opt",
        "fbcode//third-party-buck/platform010/build/libgcc:stdc++fs",
        "fbcode//third-party-buck/platform010/build/libgcrypt:libgcrypt",
        "fbcode//third-party-buck/platform010/build/libgeotiff:geotiff",
        "fbcode//third-party-buck/platform010/build/libgit2:git2",
        "fbcode//third-party-buck/platform010/build/libgpg-error:gpg-error",
        "fbcode//third-party-buck/platform010/build/libibverbs:libibverbs",
        "fbcode//third-party-buck/platform010/build/libidn:idn",
        "fbcode//third-party-buck/platform010/build/libjpeg-turbo:jpeg",
        "fbcode//third-party-buck/platform010/build/libjpeg-turbo:turbojpeg",
        "fbcode//third-party-buck/platform010/build/libmlx5:libmlx5",
        "fbcode//third-party-buck/platform010/build/libnfnetlink:nfnetlink",
        "fbcode//third-party-buck/platform010/build/libnl:nl-3",
        "fbcode//third-party-buck/platform010/build/libnl:nl-route-3",
        "fbcode//third-party-buck/platform010/build/libnsl:nsl",
        "fbcode//third-party-buck/platform010/build/libogg:ogg",
        "fbcode//third-party-buck/platform010/build/libpciaccess:pciaccess",
        "fbcode//third-party-buck/platform010/build/libpng:png",
        "fbcode//third-party-buck/platform010/build/libpthread-stubs:libpthread-stubs",
        "fbcode//third-party-buck/platform010/build/librdmacm:librdmacm",
        "fbcode//third-party-buck/platform010/build/libspatialite:libspatialite",
        "fbcode//third-party-buck/platform010/build/libssh2:ssh2",
        "fbcode//third-party-buck/platform010/build/libtasn1:tasn1",
        "fbcode//third-party-buck/platform010/build/libtheora:theoradec",
        "fbcode//third-party-buck/platform010/build/libtheora:theoraenc",
        "fbcode//third-party-buck/platform010/build/libtiff:tiff",
        "fbcode//third-party-buck/platform010/build/libtirpc:tirpc",
        "fbcode//third-party-buck/platform010/build/libusb:libusb",
        "fbcode//third-party-buck/platform010/build/libvidstab:vidstab",
        "fbcode//third-party-buck/platform010/build/libvirt:virt",
        "fbcode//third-party-buck/platform010/build/libvirt:virt-lxc",
        "fbcode//third-party-buck/platform010/build/libvirt:virt-qemu",
        "fbcode//third-party-buck/platform010/build/libvorbis:vorbis",
        "fbcode//third-party-buck/platform010/build/libvorbis:vorbisenc",
        "fbcode//third-party-buck/platform010/build/libvpx-exp:vpx",
        "fbcode//third-party-buck/platform010/build/libvpx-next:vpx",
        "fbcode//third-party-buck/platform010/build/libwebp:webp",
        "fbcode//third-party-buck/platform010/build/libwebp:webpmux",
        "fbcode//third-party-buck/platform010/build/libxcb:xcb",
        "fbcode//third-party-buck/platform010/build/libxml2:xml2",
        "fbcode//third-party-buck/platform010/build/libxslt:exslt",
        "fbcode//third-party-buck/platform010/build/libxslt:xslt",
        "fbcode//third-party-buck/platform010/build/libzip:libzip",
        "fbcode//third-party-buck/platform010/build/lvm2:devmapper",
        "fbcode//third-party-buck/platform010/build/lz4:lz4",
        "fbcode//third-party-buck/platform010/build/lzo:lzo2",
        "fbcode//third-party-buck/platform010/build/meep:meep",
        "fbcode//third-party-buck/platform010/build/mesa-stubs:libEGL",
        "fbcode//third-party-buck/platform010/build/mesa-stubs:libGLESv2",
        "fbcode//third-party-buck/platform010/build/mesa-stubs:libgbm",
        "fbcode//third-party-buck/platform010/build/mpb:mpb",
        "fbcode//third-party-buck/platform010/build/mpc:mpc",
        "fbcode//third-party-buck/platform010/build/mpfr:mpfr",
        "fbcode//third-party-buck/platform010/build/ncurses:ncursesw",
        "fbcode//third-party-buck/platform010/build/ncurses:tinfo",
        "fbcode//third-party-buck/platform010/build/netcf:netcf",
        "fbcode//third-party-buck/platform010/build/nettle:hogweed",
        "fbcode//third-party-buck/platform010/build/nettle:nettle",
        "fbcode//third-party-buck/platform010/build/nghttp2:nghttp2",
        "fbcode//third-party-buck/platform010/build/numa:numa",
        "fbcode//third-party-buck/platform010/build/nvidia_optix_sdk:optix",
        "fbcode//third-party-buck/platform010/build/nvidia_optix_sdk:optix_denoiser",
        "fbcode//third-party-buck/platform010/build/nvidia_optix_sdk:optix_prime",
        "fbcode//third-party-buck/platform010/build/nvidia_optix_sdk:optixu",
        "fbcode//third-party-buck/platform010/build/omnitek-stubs:libMonolithMessaging",
        "fbcode//third-party-buck/platform010/build/omnitek-stubs:libOmniTekInterface",
        "fbcode//third-party-buck/platform010/build/opencore-amr:opencore-amrnb",
        "fbcode//third-party-buck/platform010/build/opencore-amr:opencore-amrwb",
        "fbcode//third-party-buck/platform010/build/opencv3:ippicv",
        "fbcode//third-party-buck/platform010/build/openexr:IlmImf",
        "fbcode//third-party-buck/platform010/build/openldap:lber",
        "fbcode//third-party-buck/platform010/build/openldap:ldap",
        "fbcode//third-party-buck/platform010/build/openmp:headers",
        "fbcode//third-party-buck/platform010/build/openmp:omp",
        "fbcode//third-party-buck/platform010/build/openmpi:mpi_c",
        "fbcode//third-party-buck/platform010/build/openmpi:ompitrace",
        "fbcode//third-party-buck/platform010/build/openmpi:open_pal",
        "fbcode//third-party-buck/platform010/build/openmpi:open_rte",
        "fbcode//third-party-buck/platform010/build/openmpi:openmpi",
        "fbcode//third-party-buck/platform010/build/openssl:crypto",
        "fbcode//third-party-buck/platform010/build/openssl:ssl",
        "fbcode//third-party-buck/platform010/build/openvino:openvino",
        "fbcode//third-party-buck/platform010/build/openvino:openvino_auto_batch_plugin",
        "fbcode//third-party-buck/platform010/build/openvino:openvino_c",
        "fbcode//third-party-buck/platform010/build/openvino:openvino_gapi_preproc",
        "fbcode//third-party-buck/platform010/build/openvino:openvino_intel_cpu_plugin",
        "fbcode//third-party-buck/platform010/build/openvino:openvino_ir_frontend",
        "fbcode//third-party-buck/platform010/build/openvino_inference_engine:MKLDNNPlugin",
        "fbcode//third-party-buck/platform010/build/openvino_inference_engine:cpu_extension",
        "fbcode//third-party-buck/platform010/build/opus:opus",
        "fbcode//third-party-buck/platform010/build/oracle-instantclient:clntsh",
        "fbcode//third-party-buck/platform010/build/oracle-instantclient:clntshcore",
        "fbcode//third-party-buck/platform010/build/oracle-instantclient:nnz21",
        "fbcode//third-party-buck/platform010/build/oracle-instantclient:occi",
        "fbcode//third-party-buck/platform010/build/orc:orc-0.4",
        "fbcode//third-party-buck/platform010/build/pciutils:pci",
        "fbcode//third-party-buck/platform010/build/pcre:pcre",
        "fbcode//third-party-buck/platform010/build/popt:popt",
        "fbcode//third-party-buck/platform010/build/ppl:ppl",
        "fbcode//third-party-buck/platform010/build/proj:proj",
        "fbcode//third-party-buck/platform010/build/protobuf:protobuf",
        "fbcode//third-party-buck/platform010/build/python/3.8:python",
        "fbcode//third-party-buck/platform010/build/python/cinder.3.8:python",
        "fbcode//third-party-buck/platform010/build/rapidjson:rapidjson",
        "fbcode//third-party-buck/platform010/build/rdma-core:ibumad",
        "fbcode//third-party-buck/platform010/build/rdma-core:ibverbs",
        "fbcode//third-party-buck/platform010/build/rdma-core:libibverbs",
        "fbcode//third-party-buck/platform010/build/rdma-core:librdmacm",
        "fbcode//third-party-buck/platform010/build/rdma-core:mlx5",
        "fbcode//third-party-buck/platform010/build/rdma-core:rdmacm",
        "fbcode//third-party-buck/platform010/build/readline:readline",
        "fbcode//third-party-buck/platform010/build/rocm:MIOpen",
        "fbcode//third-party-buck/platform010/build/rocm:amd_comgr",
        "fbcode//third-party-buck/platform010/build/rocm:amd_comgr-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:amdhip64",
        "fbcode//third-party-buck/platform010/build/rocm:amdhip64-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:hipblas",
        "fbcode//third-party-buck/platform010/build/rocm:hipblas-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:hipfft",
        "fbcode//third-party-buck/platform010/build/rocm:hipfft-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:hiprand",
        "fbcode//third-party-buck/platform010/build/rocm:hiprand-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:hipsolver",
        "fbcode//third-party-buck/platform010/build/rocm:hipsolver-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:hipsparse",
        "fbcode//third-party-buck/platform010/build/rocm:hipsparse-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:hsa-runtime64",
        "fbcode//third-party-buck/platform010/build/rocm:hsa-runtime64-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:hsakmt",
        "fbcode//third-party-buck/platform010/build/rocm:rccl",
        "fbcode//third-party-buck/platform010/build/rocm:rocblas",
        "fbcode//third-party-buck/platform010/build/rocm:rocblas-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:rocfft",
        "fbcode//third-party-buck/platform010/build/rocm:rocfft-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:rocm_smi64",
        "fbcode//third-party-buck/platform010/build/rocm:rocm_smi64-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:rocprofiler64",
        "fbcode//third-party-buck/platform010/build/rocm:rocrand",
        "fbcode//third-party-buck/platform010/build/rocm:rocrand-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:rocsolver",
        "fbcode//third-party-buck/platform010/build/rocm:rocsolver-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:rocsparse",
        "fbcode//third-party-buck/platform010/build/rocm:rocsparse-lazy",
        "fbcode//third-party-buck/platform010/build/rocm:roctracer64",
        "fbcode//third-party-buck/platform010/build/rocm:roctx64",
        "fbcode//third-party-buck/platform010/build/rocm:roctx64-lazy",
        "fbcode//third-party-buck/platform010/build/schroedinger:schroedinger-1.0",
        "fbcode//third-party-buck/platform010/build/sentencepiece:sentencepiece",
        "fbcode//third-party-buck/platform010/build/sentencepiece:sentencepiece_train",
        "fbcode//third-party-buck/platform010/build/serf:serf",
        "fbcode//third-party-buck/platform010/build/speex:speex",
        "fbcode//third-party-buck/platform010/build/sqla-client:dbcapi",
        "fbcode//third-party-buck/platform010/build/sqlite:sqlite",
        "fbcode//third-party-buck/platform010/build/ssdeep:fuzzy",
        "fbcode//third-party-buck/platform010/build/sssd:nss_sss",
        "fbcode//third-party-buck/platform010/build/subversion:svn_client",
        "fbcode//third-party-buck/platform010/build/subversion:svn_delta",
        "fbcode//third-party-buck/platform010/build/subversion:svn_diff",
        "fbcode//third-party-buck/platform010/build/subversion:svn_fs",
        "fbcode//third-party-buck/platform010/build/subversion:svn_fs_fs",
        "fbcode//third-party-buck/platform010/build/subversion:svn_fs_util",
        "fbcode//third-party-buck/platform010/build/subversion:svn_fs_x",
        "fbcode//third-party-buck/platform010/build/subversion:svn_ra",
        "fbcode//third-party-buck/platform010/build/subversion:svn_ra_local",
        "fbcode//third-party-buck/platform010/build/subversion:svn_ra_serf",
        "fbcode//third-party-buck/platform010/build/subversion:svn_ra_svn",
        "fbcode//third-party-buck/platform010/build/subversion:svn_repos",
        "fbcode//third-party-buck/platform010/build/subversion:svn_subr",
        "fbcode//third-party-buck/platform010/build/subversion:svn_wc",
        "fbcode//third-party-buck/platform010/build/tbb:tbb",
        "fbcode//third-party-buck/platform010/build/tcl:tcl8.5",
        "fbcode//third-party-buck/platform010/build/torch-threads-ffi:threadsmain",
        "fbcode//third-party-buck/platform010/build/ucc:ucc",
        "fbcode//third-party-buck/platform010/build/ucx:ucm",
        "fbcode//third-party-buck/platform010/build/ucx:ucp",
        "fbcode//third-party-buck/platform010/build/ucx:ucs",
        "fbcode//third-party-buck/platform010/build/ucx:uct",
        "fbcode//third-party-buck/platform010/build/unixODBC:odbc",
        "fbcode//third-party-buck/platform010/build/unixODBC:odbcinst",
        "fbcode//third-party-buck/platform010/build/util-linux:uuid",
        "fbcode//third-party-buck/platform010/build/vmaf:vmaf",
        "fbcode//third-party-buck/platform010/build/x264:x264",
        "fbcode//third-party-buck/platform010/build/x265:x265",
        "fbcode//third-party-buck/platform010/build/xcb-proto:xcb-proto",
        "fbcode//third-party-buck/platform010/build/xgboost:dmlc",
        "fbcode//third-party-buck/platform010/build/xgboost:rabit",
        "fbcode//third-party-buck/platform010/build/xgboost:rabit_base",
        "fbcode//third-party-buck/platform010/build/xpresslibs:xprb",
        "fbcode//third-party-buck/platform010/build/xpresslibs:xprl",
        "fbcode//third-party-buck/platform010/build/xpresslibs:xprs",
        "fbcode//third-party-buck/platform010/build/xproto:xproto",
        "fbcode//third-party-buck/platform010/build/xvidcore:xvidcore",
        "fbcode//third-party-buck/platform010/build/xz:lzma",
        "fbcode//third-party-buck/platform010/build/yajl:yajl",
        "fbcode//third-party-buck/platform010/build/zbar:zbar",
        "fbcode//third-party-buck/platform010/build/zimg:zimg",
        "fbcode//third-party-buck/platform010/build/zlib:z",
        "fbcode//third-party-buck/platform010/build/zlib:zlib-py",
        "fbcode//third-party-buck/platform010/build/zookeeper:zookeeper",
        "fbsource//third-party/rccl:rccl",
        "fbsource//third-party/ucc:libucc",
        "fbsource//third-party/ucc:ucc_ec_cpu",
        "fbsource//third-party/ucc:ucc_ec_rocm",
        "fbsource//third-party/ucc:ucc_mc_rocm",
        "fbsource//third-party/ucc:ucc_perftest_lib",
        "fbsource//third-party/ucc:ucc_tl_cuda",
        "fbsource//third-party/ucc:ucc_tl_rccl",
        "fbsource//third-party/ucx:ucm_ucs",
    ],
    roots = [
        "fbcode//third-party-buck/platform010/build/re2:re2",
    ],
    enable_explicit_roots = enable_explicit_roots,
    prefer_stripped_native_objects = True,
    visibility = ["PUBLIC"],
    # FIXME: prelude// should be standalone (not refer to ovr_config//)
    default_target_platform = "ovr_config//platform/linux:x86_64-fbcode-platform010-clang",
    # We override the binary-level ldflags with library level ldfalgs for
    # shared roots. We include 2 important things: stripping binaries, and not
    # discarding GPU code.
    shared_root_ld_flags = get_ldflags("", "", "omnibus_root", get_strip_mode("", ""), "") + [
        "-Wl,--no-discard-section=.nv_fatbin",
        "-Wl,--no-discard-section=.nvFatBinSegment",
        # Reorder nv_fatbin after the bss section to avoid overflow
        "$(location fbcode//tools/build:move_gpu_sections_implicit_linker_script.txt)",
    ],
    # Avoid creating a uquery cycle if the option is not turned on.
    dynamic_exclusions = [
        "fbcode//common/memory:jemalloc",
        "fbcode//folly/experimental/exception_tracer:exception_tracer_callbacks",
    ] if enable_explicit_roots else [],
    sandcastle_alias = native.read_config("user", "sandcastle_alias"),
)

native.constraint_setting(
    name = "maybe_inject_omnibus_environment",
    visibility = ["prelude//..."],
)

native.constraint_value(
    name = "do_not_inject_omnibus_environment",
    constraint_setting = ":maybe_inject_omnibus_environment",
    visibility = ["prelude//..."],
)
