"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[66061],{28453:(t,e,s)=>{s.d(e,{R:()=>i,x:()=>o});var n=s(96540);const r={},a=n.createContext(r);function i(t){const e=n.useContext(a);return n.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function o(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:i(t.components),n.createElement(a.Provider,{value:e},t.children)}},76904:(t,e,s)=>{s.r(e),s.d(e,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"api/bxl/OutputStream","title":"OutputStream","description":"The output stream for bxl to print values to the console as their result","source":"@site/../docs/api/bxl/OutputStream.md","sourceDirName":"api/bxl","slug":"/api/bxl/OutputStream","permalink":"/docs/api/bxl/OutputStream","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"apiSidebar","previous":{"title":"LazyUqueryContext","permalink":"/docs/api/bxl/LazyUqueryContext"},"next":{"title":"Result","permalink":"/docs/api/bxl/Result"}}');var r=s(74848),a=s(28453),i=s(56289);const o={},l="OutputStream",u={},d=[{value:"OutputStream.ensure",id:"outputstreamensure",level:2},{value:"OutputStream.ensure_multiple",id:"outputstreamensure_multiple",level:2},{value:"OutputStream.print",id:"outputstreamprint",level:2},{value:"OutputStream.print_json",id:"outputstreamprint_json",level:2},{value:"OutputStream.stream",id:"outputstreamstream",level:2},{value:"OutputStream.stream_json",id:"outputstreamstream_json",level:2}];function c(t){const e={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"outputstream",children:"OutputStream"})}),"\n",(0,r.jsx)(e.p,{children:"The output stream for bxl to print values to the console as their result"}),"\n",(0,r.jsx)(e.h2,{id:"outputstreamensure",children:"OutputStream.ensure"}),"\n",(0,r.jsx)("pre",{class:"language-python",children:(0,r.jsxs)("code",{children:["def OutputStream.ensure(\nartifact: ",(0,r.jsx)(i.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),",\n) -> ",(0,r.jsx)(i.default,{to:"/docs/api/bxl/EnsuredArtifact",children:"bxl.EnsuredArtifact"})]})}),"\n",(0,r.jsx)(e.p,{children:"Marks the artifact as an artifact that should be available to the users at the end of the bxl invocation. Any artifacts that do not get registered via this call is not accessible by users at the end of bxl script."}),"\n",(0,r.jsxs)(e.p,{children:["This function returns an ",(0,r.jsx)(e.code,{children:"ensured_artifact"})," type that can be printed via ",(0,r.jsx)(e.code,{children:"ctx.output.print()"}),"\nto print its actual path on disk."]}),"\n",(0,r.jsx)(e.p,{children:"Sample usage:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def _impl_ensure(ctx):\n    actions = ctx.bxl_actions().actions\n    output = actions.write("my_output", "my_content")\n    ensured = ctx.output.ensure(output)\n    ctx.output.print(ensured)\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"outputstreamensure_multiple",children:"OutputStream.ensure_multiple"}),"\n",(0,r.jsx)("pre",{class:"language-python",children:(0,r.jsxs)("code",{children:["def OutputStream.ensure_multiple(\nartifacts: ",(0,r.jsx)(i.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/CellPath",children:"CellPath"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/CellRoot",children:"CellRoot"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/Label",children:"Label"})," | None | ",(0,r.jsx)(i.default,{to:"/docs/api/build/OutputArtifact",children:"OutputArtifact"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/ProjectRoot",children:"ProjectRoot"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/ResolvedStringWithMacros",children:"ResolvedStringWithMacros"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/TaggedCommandLine",children:"TaggedCommandLine"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/TargetLabel",children:"TargetLabel"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/TransitiveSetArgsProjection",children:"TransitiveSetArgsProjection"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/WriteJsonCliArgs",children:"WriteJsonCliArgs"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/bxl/BuildResult",children:"bxl.BuildResult"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/bxl/BuiltArtifactsIterable",children:"bxl.BuiltArtifactsIterable"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/build/cmd_args",children:"cmd_args"})," | ",(0,r.jsx)(i.default,{to:"/docs/api/starlark/str",children:"str"})," | list[",(0,r.jsx)(i.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),"] | dict[typing.Any, ",(0,r.jsx)(i.default,{to:"/docs/api/bxl/BuildResult",children:"bxl.BuildResult"}),"] | RunInfo,\n)"]})}),"\n",(0,r.jsxs)(e.p,{children:["Same as ",(0,r.jsx)(e.code,{children:"ensure"}),", but for multiple artifacts. Will preserve the shape of the inputs (i.e. if the resulting ",(0,r.jsx)(e.code,{children:"Dict"})," of a ",(0,r.jsx)(e.code,{children:"ctx.build()"})," is passed in, the output will be a ",(0,r.jsx)(e.code,{children:"Dict"})," where the key is preserved, and the values are converted to ",(0,r.jsx)(e.code,{children:"ensured_artifact"}),"s)."]}),"\n",(0,r.jsxs)(e.p,{children:["Note that is slower to loop through objects and ensure them one by one than it is to call ",(0,r.jsx)(e.code,{children:"ensure_multiple()"}),"\non all the objects at once (if possible).\nSo, it is suggested to use this method when you are only ensuring a few individual artifacts that are not stored in an iterable."]}),"\n",(0,r.jsx)(e.p,{children:"Sample usage:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"def _impl_ensure_multiple(ctx):\n    outputs = {}\n    for target, value in ctx.build(ctx.cli_args.target).items():\n    outputs.update({target.raw_target(): ctx.output.ensure_multiple(value.artifacts())})\n    ctx.output.print_json(outputs)\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"outputstreamprint",children:"OutputStream.print"}),"\n",(0,r.jsx)("pre",{class:"language-python",children:(0,r.jsxs)("code",{children:["def OutputStream.print(\n*args,\nsep: ",(0,r.jsx)(i.default,{to:"/docs/api/starlark/str",children:"str"}),' = " ",\n) -> None']})}),"\n",(0,r.jsx)(e.p,{children:'Outputs results to the console via stdout. These outputs are considered to be the results of a bxl script, which will be displayed to stdout by buck2 even when the script is cached. Accepts an optional separator that defaults to " ".'}),"\n",(0,r.jsxs)(e.p,{children:["Prints that are not result of the bxl should be printed via stderr via the stdlib ",(0,r.jsx)(e.code,{children:"print"}),"\nand ",(0,r.jsx)(e.code,{children:"pprint"}),"."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Note"})," that ",(0,r.jsx)(e.code,{children:"ctx.output.print()"})," is intended for simple outputs. For more complex\noutputs, the recommendation would be to write them to a file."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Note"})," that the output of ",(0,r.jsx)(e.code,{children:"ctx.output.print()"})," will be displayed to stdout at the end of bxl.\nIf you want to print something to stdout immediately or the when ensured artifacts are ready and also want this even when the script is cached,\nuse ",(0,r.jsx)(e.code,{children:"ctx.output.stream()"})," instead."]}),"\n",(0,r.jsx)(e.p,{children:"Sample usage:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def _impl_print(ctx):\n    ctx.output.print("test")\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"outputstreamprint_json",children:"OutputStream.print_json"}),"\n",(0,r.jsx)("pre",{class:"language-python",children:(0,r.jsxs)("code",{children:["def OutputStream.print_json(\nvalue,\n*,\npretty: ",(0,r.jsx)(i.default,{to:"/docs/api/starlark/bool",children:"bool"})," = True,\n) -> None"]})}),"\n",(0,r.jsxs)(e.p,{children:["Outputs results to the console via stdout as pretty-printed json. Pretty printing can be turned off by the ",(0,r.jsx)(e.code,{children:"pretty"})," keyword-only parameter. These outputs are considered to be the results of a bxl script, which will be displayed to stdout by buck2 even when the script is cached."]}),"\n",(0,r.jsxs)(e.p,{children:["Prints that are not result of the bxl should be printed via stderr via the stdlib ",(0,r.jsx)(e.code,{children:"print"}),"\nand ",(0,r.jsx)(e.code,{children:"pprint"}),"."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Note"})," that the output of ",(0,r.jsx)(e.code,{children:"ctx.output.print_json()"})," will be displayed to stdout at the end of bxl.\nIf you want to print something to stdout immediately or the when ensured artifacts are ready and also want this even when the script is cached,\nuse ",(0,r.jsx)(e.code,{children:"ctx.output.stream_json()"})," instead."]}),"\n",(0,r.jsx)(e.p,{children:"Sample usage:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def _impl_print_json(ctx):\n    outputs = {}\n    outputs.update({"foo": bar})\n    ctx.output.print_json(outputs)\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"outputstreamstream",children:"OutputStream.stream"}),"\n",(0,r.jsx)("pre",{class:"language-python",children:(0,r.jsxs)("code",{children:["def OutputStream.stream(\n*args,\nsep: ",(0,r.jsx)(i.default,{to:"/docs/api/starlark/str",children:"str"}),' = " ",\nwait_on: list[',(0,r.jsx)(i.default,{to:"/docs/api/bxl/EnsuredArtifact",children:"bxl.EnsuredArtifact"})," | bxl.EnsuredArtifactGroup] = [],\n) -> None"]})}),"\n",(0,r.jsxs)(e.p,{children:["Streaming outputs results to the console via stdout ",(0,r.jsx)(e.strong,{children:"immediately"}),' when it is ready. It will be displayed to stdout by buck2 even when the script is cached. Accepts an optional separator that defaults to " ".']}),"\n",(0,r.jsxs)(e.p,{children:["The streaming behavior is controlled by the ",(0,r.jsx)(e.code,{children:"wait_on"})," parameter:"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["If 'wait_on' is not specified or empty, output is displayed ",(0,r.jsx)(e.strong,{children:"immediately"})," during evaluation"]}),"\n",(0,r.jsxs)(e.li,{children:["If 'wait_on' contains artifacts\uff0coutput is displayed ",(0,r.jsx)(e.strong,{children:"as soon as all specified artifacts are materialized"})]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["The ",(0,r.jsx)(e.code,{children:"wait_on"})," parameter explicitly specifies artifacts that must be materialized before showing output."]}),"\n",(0,r.jsx)(e.p,{children:"Sample usage:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def _impl_print(ctx):\n    # Immediate output during evaluation\n    ctx.output.stream("Starting process...")\n\n    # Output as soon as artifact is materialized\n    artifact = ctx.output.ensure(my_artifact)\n    ctx.output.stream("Artifact ready:", artifact, wait_on=[artifact])\n\n    # Output when both artifacts are materialized\n    artifact1 = ctx.output.ensure(my_artifact1)\n    artifact2 = ctx.output.ensure(my_artifact2)\n    ctx.output.stream("First artifact:", artifact1, wait_on=[artifact1, artifact2])\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"outputstreamstream_json",children:"OutputStream.stream_json"}),"\n",(0,r.jsx)("pre",{class:"language-python",children:(0,r.jsxs)("code",{children:["def OutputStream.stream_json(\nvalue,\n*,\npretty: ",(0,r.jsx)(i.default,{to:"/docs/api/starlark/bool",children:"bool"})," = True,\nwait_on: list[",(0,r.jsx)(i.default,{to:"/docs/api/bxl/EnsuredArtifact",children:"bxl.EnsuredArtifact"})," | bxl.EnsuredArtifactGroup] = [],\n) -> None"]})}),"\n",(0,r.jsxs)(e.p,{children:["Streaming outputs results to the console via stdout as pretty-printed json ",(0,r.jsx)(e.strong,{children:"immediately"})," when it is ready. Pretty printing can be turned off by the ",(0,r.jsx)(e.code,{children:"pretty"})," keyword-only parameter. It will be displayed to stdout by buck2 even when the script is cached."]}),"\n",(0,r.jsxs)(e.p,{children:["The streaming behavior is controlled by the ",(0,r.jsx)(e.code,{children:"wait_on"})," parameter:"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["If 'wait_on' is not specified or empty, output is displayed ",(0,r.jsx)(e.strong,{children:"immediately"})," during evaluation"]}),"\n",(0,r.jsxs)(e.li,{children:["If 'wait_on' contains artifacts\uff0coutput is displayed ",(0,r.jsx)(e.strong,{children:"as soon as all specified artifacts are materialized"})]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["The ",(0,r.jsx)(e.code,{children:"wait_on"})," parameter explicitly specifies artifacts that must be materialized before showing output."]}),"\n",(0,r.jsx)(e.p,{children:"Sample usage:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def _impl_print_json(ctx):\n    outputs = {}\n    outputs.update({"foo": bar})\n\n    # Stream JSON output immediately\n    ctx.output.stream_json({"status": "starting"})\n\n    # Stream JSON when artifact is ready\n    artifact = ctx.output.ensure(my_artifact)\n    ctx.output.stream_json({"artifact": artifact}, wait_on=[artifact])\n\n   # Stream JSON waiting on artifact to be ready\n   ctx.output.stream_json({"status": "starting"}, wait_on=[artifact])\n'})})]})}function p(t={}){const{wrapper:e}={...(0,a.R)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(c,{...t})}):c(t)}}}]);