"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[95365],{28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var t=n(96540);const r={},i=t.createContext(r);function l(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:s},e.children)}},57978:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"prelude/rules/erlang/erlang_release","title":"erlang_release","description":"The erlangrelease target builds OTP releases. Please refer to the OTP documentation for more details about releases.","source":"@site/../docs/prelude/rules/erlang/erlang_release.md","sourceDirName":"prelude/rules/erlang","slug":"/prelude/rules/erlang/erlang_release","permalink":"/docs/prelude/rules/erlang/erlang_release","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ruleSidebar","previous":{"title":"erlang_otp_binaries","permalink":"/docs/prelude/rules/erlang/erlang_otp_binaries"},"next":{"title":"erlang_test","permalink":"/docs/prelude/rules/erlang/erlang_test"}}');var r=n(74848),i=n(28453);n(56289);const l={},a="erlang_release",d={},o=[{value:"Details",id:"details",level:3},{value:"Function Signature",id:"function-signature",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Examples",id:"examples",level:3}];function c(e){const s={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"erlang_release",children:"erlang_release"})}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"erlang_release"})," target builds OTP releases. Please refer to the ",(0,r.jsx)(s.a,{href:"https://www.erlang.org/doc/design_principles/release_structure.html",children:"OTP documentation"})," for more details about releases."]}),"\n",(0,r.jsx)(s.h3,{id:"details",children:"Details"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"erlang_release"})," target does by default (without overlays) package:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"applications that are required to start the release"}),"\n",(0,r.jsxs)(s.li,{children:["release resource file ",(0,r.jsx)(s.code,{children:"<relname>.rel"})," (see ",(0,r.jsx)(s.a,{href:"https://www.erlang.org/doc/man/rel.html",children:"rel(4)"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:["boot script ",(0,r.jsx)(s.code,{children:"start.script"})," (see ",(0,r.jsx)(s.a,{href:"https://www.erlang.org/doc/man/script.html",children:"rel(4)"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:["binary boot script ",(0,r.jsx)(s.code,{children:"start.boot"})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"bin/release_variables"})}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"release_variables"})," file contains release name, version, and erts version in shell syntax, e.g."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'ERTS_VSN="12.1.2"\nREL_NAME="rel1"\nREL_VSN="1.0.0"\n'})}),"\n",(0,r.jsxs)(s.p,{children:["The target name doubles as the default release name. If the ",(0,r.jsx)(s.code,{children:"release_name"})," attribute is used, the release name will be\nsources from there instead."]}),"\n",(0,r.jsx)(s.h3,{id:"function-signature",children:"Function Signature"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'def erlang_release(\n    *,\n    name: str,\n    default_target_platform: None | str = None,\n    target_compatible_with: list[str] = [],\n    compatible_with: list[str] = [],\n    exec_compatible_with: list[str] = [],\n    visibility: list[str] = [],\n    within_view: list[str] = ["PUBLIC"],\n    metadata: OpaqueMetadata = {},\n    tests: list[str] = [],\n    modifiers: OpaqueMetadata = [],\n    _apple_platforms: dict[str, str] = {},\n    _toolchain: str = "gh_facebook_buck2_shims_meta//:erlang-default",\n    applications: list[str | (str, str)],\n    contacts: list[str] = [],\n    include_erts: bool = False,\n    labels: list[str] = [],\n    os_env: None | dict[str, str] = None,\n    overlays: dict[str, list[str]] = {},\n    release_name: None | str = None,\n    version: str = "1.0.0",\n) -> None\n'})}),"\n",(0,r.jsx)(s.h3,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"name"}),": (required)"]}),"\n",(0,r.jsx)(s.p,{children:"name of the target"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"default_target_platform"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"specifies the default target platform, used when no platforms are specified on the command line"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"target_compatible_with"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"compatible_with"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"exec_compatible_with"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"visibility"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"a list of visibility patterns restricting what targets can depend on this one"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"within_view"}),": (defaults to: ",(0,r.jsx)(s.code,{children:'["PUBLIC"]'}),")"]}),"\n",(0,r.jsx)(s.p,{children:"a list of visibility patterns restricting what this target can depend on"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"metadata"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"{}"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"a key-value map of metadata associated with this target"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"tests"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"a list of targets that provide tests for this one"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"modifiers"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"an array of modifiers associated with this target"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"applications"}),": (required)"]}),"\n",(0,r.jsxs)(s.p,{children:["This field specifies the list of applications that the release should start in the given order, and optionally the start type. Top-level applications without given start type are started with type ",(0,r.jsx)(s.a,{href:"https://www.erlang.org/doc/man/application.html#type-restart_type",children:(0,r.jsx)(s.code,{children:"permanent"})}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"contacts"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"A list of organizational contacts for this rule. These could be individuals who you would contact in the event of a failure or other issue with the rule."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"contacts = [ 'Joe Sixpack', 'Erika Mustermann' ]\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"include_erts"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"False"}),")"]}),"\n",(0,r.jsxs)(s.p,{children:["This field controls whether OTP applications and the Erlang runtime system should be included as part of the release. Please note, that at the moment the erts folder is just ",(0,r.jsx)(s.code,{children:"erts/"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"labels"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"[]"}),")"]}),"\n",(0,r.jsxs)(s.p,{children:["Set of arbitrary strings which allow you to annotate a ",(0,r.jsx)(s.a,{href:"https://buck2.build/docs/concepts/build_rule/",children:"build rule"})," with tags that can be searched for over an entire dependency tree using ",(0,r.jsx)(s.code,{children:"buck query()"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"os_env"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"This attribute allows to set additional values for the operating system environment for invocations to the Erlang toolchain."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"overlays"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"{}"}),")"]}),"\n",(0,r.jsxs)(s.p,{children:["Overlays can be used to add files to the release. They are specified as mapping from path (from the release root) to list of targets. The targets files are places ",(0,r.jsx)(s.strong,{children:"flat"})," at the target location with their basename."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"release_name"}),": (defaults to: ",(0,r.jsx)(s.code,{children:"None"}),")"]}),"\n",(0,r.jsx)(s.p,{children:"The release name can explicitly be set by this field. This overwrites the default from the target name."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"version"}),": (defaults to: ",(0,r.jsx)(s.code,{children:'"1.0.0"'}),")"]}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"version"})," field specifies the release version. The release version is used in the release resource file, and is part of the path for the folder containing the boot scripts."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-python",children:'\nerlang_release(\n    name = "world",\n    version = "1.0.0",\n    applications = [\n        "//apps//app_a:app_a",\n        "//apps//app_b:app_b",\n    ],\n    overlays = {\n        "releases/1.0.0": [\n            ":sys.config.src",\n        ],\n        "bin": [\n            ":start.sh",\n        ],\n    },\n)\n\nexport_file(\n    name = "sys.config.src",\n    src = "sys.config",\n)\n\nexport_file(\n    name = "start.sh",\n    src = "start.sh",\n)\n\n'})})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);