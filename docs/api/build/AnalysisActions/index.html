<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-api/build/AnalysisActions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">AnalysisActions | Buck2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://buck2.build/docs/api/build/AnalysisActions/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AnalysisActions | Buck2"><meta data-rh="true" name="description" content="AnalysisActions.anon\_target"><meta data-rh="true" property="og:description" content="AnalysisActions.anon\_target"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://buck2.build/docs/api/build/AnalysisActions/"><link data-rh="true" rel="alternate" href="https://buck2.build/docs/api/build/AnalysisActions/" hreflang="en"><link data-rh="true" rel="alternate" href="https://buck2.build/docs/api/build/AnalysisActions/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9RT0EWXQO8-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Buck2" href="/opensearch.xml">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GEGGHE39PE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GEGGHE39PE",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.365ec9d7.css">
<script src="/assets/js/runtime~main.7b2db4e0.js" defer="defer"></script>
<script src="/assets/js/main.116bbb72.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Buck2 Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Buck2 Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Buck2</b></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/api/">API</a><a class="navbar__item navbar__link" href="/docs/prelude/rules/">Rules</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/buck2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/api/">APIs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prelude/rules/">Rules</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/api/starlark/">Starlark APIs</a><button aria-label="Collapse sidebar category &#x27;Starlark APIs&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/bool/">bool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/dict/">dict</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/float/">float</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/int/">int</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/json/">json</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/list/">list</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/namespace/">namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/range/">range</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/set/">set</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/str/">str</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/struct/">struct</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/tuple/">tuple</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/type/">type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/starlark/typing/">typing</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/api/build/">Build APIs</a><button aria-label="Collapse sidebar category &#x27;Build APIs&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ActionErrorCtx/">ActionErrorCtx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ActionSubError/">ActionSubError</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/api/build/AnalysisActions/">AnalysisActions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/AnalysisContext/">AnalysisContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/AnonTarget/">AnonTarget</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/AnonTargets/">AnonTargets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/Artifact/">Artifact</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ArtifactTag/">ArtifactTag</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ArtifactValue/">ArtifactValue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/Attr/">Attr</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/BuckRegex/">BuckRegex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/CellPath/">CellPath</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/CellRoot/">CellRoot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/CommandExecutorConfig/">CommandExecutorConfig</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/CommandLineInputs/">CommandLineInputs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ConfigurationInfo/">ConfigurationInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ConfiguredProvidersLabel/">ConfiguredProvidersLabel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ConfiguredTargetLabel/">ConfiguredTargetLabel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ConstraintSettingInfo/">ConstraintSettingInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ConstraintValueInfo/">ConstraintValueInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/DefaultInfo/">DefaultInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/DepOnlyIncompatibleInfo/">DepOnlyIncompatibleInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/DepOnlyIncompatibleRollout/">DepOnlyIncompatibleRollout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/Dependency/">Dependency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/DigestConfig/">DigestConfig</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/DynamicActions/">DynamicActions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/DynamicActionsCallable/">DynamicActionsCallable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/DynamicValue/">DynamicValue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ExternalRunnerTestInfo/">ExternalRunnerTestInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/Label/">Label</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/LocalResourceInfo/">LocalResourceInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/OutputArtifact/">OutputArtifact</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/PackagePath/">PackagePath</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/PlatformInfo/">PlatformInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ProjectRoot/">ProjectRoot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/Promise/">Promise</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/PromiseArtifact/">PromiseArtifact</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ProviderCollection/">ProviderCollection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ProvidersLabel/">ProvidersLabel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/RequiredTestLocalResource/">RequiredTestLocalResource</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ResolvedDynamicValue/">ResolvedDynamicValue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ResolvedStringWithMacros/">ResolvedStringWithMacros</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/Rule/">Rule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/RunInfo/">RunInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/Select/">Select</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TaggedCommandLine/">TaggedCommandLine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TaggedValue/">TaggedValue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TargetLabel/">TargetLabel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TemplatePlaceholderInfo/">TemplatePlaceholderInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TransitionInfo/">TransitionInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TransitiveSet/">TransitiveSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TransitiveSetArgsProjection/">TransitiveSetArgsProjection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TransitiveSetArgsProjectionIterator/">TransitiveSetArgsProjectionIterator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TransitiveSetDefinition/">TransitiveSetDefinition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TransitiveSetIterator/">TransitiveSetIterator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/TransitiveSetJsonProjection/">TransitiveSetJsonProjection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ValidationInfo/">ValidationInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/ValidationSpec/">ValidationSpec</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/WorkerInfo/">WorkerInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/WorkerRunInfo/">WorkerRunInfo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/WriteJsonCliArgs/">WriteJsonCliArgs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/attrs/">attrs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/cmd_args/">cmd_args</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/api/build/dynattrs/">dynattrs</a><button aria-label="Expand sidebar category &#x27;dynattrs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/api/build/plugins/">plugins</a><button aria-label="Expand sidebar category &#x27;plugins&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/build/regex/">regex</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/api/bxl/">BXL APIs</a><button aria-label="Collapse sidebar category &#x27;BXL APIs&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/ActionAttr/">ActionAttr</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/ActionQueryNode/">ActionQueryNode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/Actions/">Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/AnalysisResult/">AnalysisResult</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/AqueryContext/">AqueryContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/AuditContext/">AuditContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/BuildResult/">BuildResult</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/BuiltArtifactsIterable/">BuiltArtifactsIterable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/CliArgs/">CliArgs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/ConfiguredAttr/">ConfiguredAttr</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/ConfiguredTargetNode/">ConfiguredTargetNode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/ConfiguredTargetSet/">ConfiguredTargetSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/Context/">Context</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/CqueryContext/">CqueryContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/EnsuredArtifact/">EnsuredArtifact</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/Error/">Error</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/FailedArtifactsIterable/">FailedArtifactsIterable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/FileNode/">FileNode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/Filesystem/">Filesystem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/Lazy/">Lazy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/LazyAttrs/">LazyAttrs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/LazyContext/">LazyContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/LazyCqueryContext/">LazyCqueryContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/LazyResolvedAttrs/">LazyResolvedAttrs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/LazyUqueryContext/">LazyUqueryContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/OutputStream/">OutputStream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/Result/">Result</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/SelectConcat/">SelectConcat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/SelectDict/">SelectDict</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/TargetUniverse/">TargetUniverse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/UnconfiguredTargetNode/">UnconfiguredTargetNode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/UnconfiguredTargetSet/">UnconfiguredTargetSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/UqueryContext/">UqueryContext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/cli_args/">cli_args</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/api/bxl_utils/ensure/">BXL utils functions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl_utils/ensure/">ensure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl_utils/lazy/">lazy</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/api/build/"><span itemprop="name">Build APIs</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AnalysisActions</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AnalysisActions</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsanon_target">AnalysisActions.anon_target<a href="#analysisactionsanon_target" class="hash-link" aria-label="Direct link to AnalysisActions.anon_target" title="Direct link to AnalysisActions.anon_target">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.anon_target(
rule: def(**kwargs: typing.Any) -&gt; None,
attrs: dict[<a href="/docs/api/starlark/str/">str</a>, typing.Any],
) -&gt; <a href="/docs/api/build/AnonTarget/">AnonTarget</a></code></pre>
<p>An anonymous target is defined by the hash of its attributes, rather than its name. During analysis, rules can define and access the providers of anonymous targets before producing their own providers. Two distinct rules might ask for the same anonymous target, sharing the work it performs.</p>
<p>For more details see <a href="https://buck2.build/docs/rule_authors/anon_targets/" target="_blank" rel="noopener noreferrer">https://buck2.build/docs/rule_authors/anon_targets/</a></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsanon_targets">AnalysisActions.anon_targets<a href="#analysisactionsanon_targets" class="hash-link" aria-label="Direct link to AnalysisActions.anon_targets" title="Direct link to AnalysisActions.anon_targets">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.anon_targets(
rules: list[(def(**kwargs: typing.Any) -&gt; None, dict[<a href="/docs/api/starlark/str/">str</a>, typing.Any])] | tuple[(def(**kwargs: typing.Any) -&gt; None, dict[<a href="/docs/api/starlark/str/">str</a>, typing.Any]), ...],
) -&gt; <a href="/docs/api/build/AnonTargets/">AnonTargets</a></code></pre>
<p>Generate a series of anonymous targets.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsartifact_tag">AnalysisActions.artifact_tag<a href="#analysisactionsartifact_tag" class="hash-link" aria-label="Direct link to AnalysisActions.artifact_tag" title="Direct link to AnalysisActions.artifact_tag">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.artifact_tag(
) -&gt; <a href="/docs/api/build/ArtifactTag/">ArtifactTag</a></code></pre>
<p>Create a unique artifact tag for tracking input dependencies with dependency files.</p>
<p>An <code>ArtifactTag</code> is used to associate inputs and outputs in a build action with a dependency
file (depfile), enabling more accurate incremental builds by tracking which inputs were
actually used during action execution.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-dependency-files-work">How Dependency Files Work<a href="#how-dependency-files-work" class="hash-link" aria-label="Direct link to How Dependency Files Work" title="Direct link to How Dependency Files Work">​</a></h3>
<p>Traditional build systems face a dilemma: if an action depends on 1000 header files but only
uses 10, should changing any of the 1000 trigger a rebuild? Being conservative (always rebuild)
is slow, while being optimistic (never rebuild) risks correctness.</p>
<p>Dependency files solve this by letting the build tool (e.g., GCC, Clang, Swift compiler) report
which inputs it actually used:</p>
<ol>
<li><strong>First build</strong>: The action runs with all potential inputs available</li>
<li><strong>Tool generates depfile</strong>: The compiler writes a file listing only the inputs it actually read</li>
<li><strong>Subsequent builds</strong>: Buck2 only triggers rebuilds when files listed in the depfile change</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage-pattern">Usage Pattern<a href="#usage-pattern" class="hash-link" aria-label="Direct link to Usage Pattern" title="Direct link to Usage Pattern">​</a></h3>
<p>The typical workflow involves three steps:</p>
<ol>
<li>Create a unique tag with <code>ctx.actions.artifact_tag()</code></li>
<li>Use the tag&#x27;s <code>tag_artifacts()</code> method to mark:<!-- -->
<ul>
<li>All potential input dependencies</li>
<li>The depfile output</li>
</ul>
</li>
<li>Associate the tag with a label in the <code>dep_files</code> parameter of <code>ctx.actions.run()</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-c-compilation">Example: C++ Compilation<a href="#example-c-compilation" class="hash-link" aria-label="Direct link to Example: C++ Compilation" title="Direct link to Example: C++ Compilation">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_compile_impl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Step 1: Create a unique tag for tracking header dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers_tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">artifact_tag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Prepare inputs and outputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">copied_dir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;headers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dep_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;depfile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;output.o&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Step 2: Tag the inputs and depfile output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cmd_args</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;gcc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;main.cpp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;-I&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers_tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag_artifacts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers_dir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Mark potential inputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;-o&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">as_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;-MMD&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                                        </span><span class="token comment" style="color:#999988;font-style:italic"># Tell GCC to generate depfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;-MF&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers_tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag_artifacts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dep_file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">as_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Mark depfile output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Step 3: Associate the tag with the &quot;headers&quot; label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cmd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        category </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cxx_compile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dep_files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;headers&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> headers_tag</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example:</p>
<ul>
<li><code>headers_dir</code> contains 1000 header files</li>
<li>GCC generates <code>depfile</code> listing only the 10 headers actually used</li>
<li>On subsequent builds, only changes to those 10 headers trigger recompilation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="depfile-format">Depfile Format<a href="#depfile-format" class="hash-link" aria-label="Direct link to Depfile Format" title="Direct link to Depfile Format">​</a></h3>
<p>Dependency files use Makefile syntax:</p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output.o: main.cpp foo.h bar.h internal.h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This tells Buck2 that <code>output.o</code> depends on these specific files. Buck2 reads this file
after the action completes and uses it to determine which tagged inputs to track for
future incremental builds.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="return-value">Return Value<a href="#return-value" class="hash-link" aria-label="Direct link to Return Value" title="Direct link to Return Value">​</a></h3>
<p>Returns a new <code>ArtifactTag</code> instance. Each call creates a unique tag that can be compared
for equality, allowing Buck2 to match tagged inputs with their corresponding depfiles.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="see-also">See Also<a href="#see-also" class="hash-link" aria-label="Direct link to See Also" title="Direct link to See Also">​</a></h3>
<ul>
<li><a href="/docs/api/build/ArtifactTag/#artifacttagtag_artifacts"><code>ArtifactTag.tag_artifacts()</code></a>: Tag both inputs and outputs</li>
<li><a href="/docs/api/build/ArtifactTag/#artifacttagtag_inputs"><code>ArtifactTag.tag_inputs()</code></a>: Tag only inputs</li>
<li><a href="/docs/api/build/AnalysisActions/#analysisactionsrun"><code>ctx.actions.run()</code></a>: The <code>dep_files</code> parameter documentation</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsassert_has_content_based_path">AnalysisActions.assert_has_content_based_path<a href="#analysisactionsassert_has_content_based_path" class="hash-link" aria-label="Direct link to AnalysisActions.assert_has_content_based_path" title="Direct link to AnalysisActions.assert_has_content_based_path">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.assert_has_content_based_path(
artifact: <a href="/docs/api/build/PromiseArtifact/">Artifact</a>,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsassert_short_path">AnalysisActions.assert_short_path<a href="#analysisactionsassert_short_path" class="hash-link" aria-label="Direct link to AnalysisActions.assert_short_path" title="Direct link to AnalysisActions.assert_short_path">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.assert_short_path(
artifact: <a href="/docs/api/build/PromiseArtifact/">Artifact</a>,
short_path: <a href="/docs/api/starlark/str/">str</a>,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Generate a promise artifact that has short path accessible on it. The short path&#x27;s correctness will be asserted during analysis time.</p>
<p>TODO - we would prefer the API to be <code>ctx.actions.anon_target(xxx).artifact(&quot;foo&quot;, short_path=yyy)</code>, but
we cannot support this until we can get access to the <code>AnalysisContext</code> without passing it into this method.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionscas_artifact">AnalysisActions.cas_artifact<a href="#analysisactionscas_artifact" class="hash-link" aria-label="Direct link to AnalysisActions.cas_artifact" title="Direct link to AnalysisActions.cas_artifact">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.cas_artifact(
output: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
digest: <a href="/docs/api/starlark/str/">str</a>,
use_case: <a href="/docs/api/starlark/str/">str</a>,
/,
*,
expires_after_timestamp: <a href="/docs/api/starlark/int/">int</a>,
is_executable: <a href="/docs/api/starlark/bool/">bool</a> = False,
is_tree: <a href="/docs/api/starlark/bool/">bool</a> = False,
is_directory: <a href="/docs/api/starlark/bool/">bool</a> = False,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Downloads a CAS artifact to an output</p>
<ul>
<li><code>digest</code>: must look like <code>SHA1:SIZE</code></li>
<li><code>use_case</code>: your RE use case</li>
<li><code>expires_after_timestamp</code>: must be a UNIX timestamp. Your digest&#x27;s TTL must exceed this
timestamp. Your build will break once the digest expires, so make sure the expiry is long
enough (preferably, in years).</li>
<li><code>is_executable</code>: indicates the resulting file should be marked with executable
permissions</li>
<li><code>is_tree</code>: digest must point to a blob of type
<a href="https://fburl.com/code/95rqgju0" target="_blank" rel="noopener noreferrer">RE.Tree</a></li>
<li><code>is_directory</code>: digest must point to a blob of type
<a href="https://fburl.com/code/4eg40nnp" target="_blank" rel="noopener noreferrer">RE.Directory</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionscopied_dir">AnalysisActions.copied_dir<a href="#analysisactionscopied_dir" class="hash-link" aria-label="Direct link to AnalysisActions.copied_dir" title="Direct link to AnalysisActions.copied_dir">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.copied_dir(
output: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
srcs: dict[<a href="/docs/api/starlark/str/">str</a>, <a href="/docs/api/build/PromiseArtifact/">Artifact</a>],
/,
*,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
executable_bit_override: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Returns an <code>artifact</code> which is a directory containing copied files. The srcs must be a dictionary of path (as string, relative to the result directory) to the bound <code>artifact</code>, which will be laid out in the directory.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionscopy_dir">AnalysisActions.copy_dir<a href="#analysisactionscopy_dir" class="hash-link" aria-label="Direct link to AnalysisActions.copy_dir" title="Direct link to AnalysisActions.copy_dir">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.copy_dir(
dest: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
src: <a href="/docs/api/build/PromiseArtifact/">Artifact</a>,
/,
*,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
executable_bit_override: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Make a copy of a directory.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionscopy_file">AnalysisActions.copy_file<a href="#analysisactionscopy_file" class="hash-link" aria-label="Direct link to AnalysisActions.copy_file" title="Direct link to AnalysisActions.copy_file">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.copy_file(
dest: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
src: <a href="/docs/api/build/PromiseArtifact/">Artifact</a>,
/,
*,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
executable_bit_override: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Copies the source <code>artifact</code> to the destination (which can be a string representing a filename or an output <code>artifact</code>) and returns the output <code>artifact</code>. The copy works for files or directories.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsdeclare_output">AnalysisActions.declare_output<a href="#analysisactionsdeclare_output" class="hash-link" aria-label="Direct link to AnalysisActions.declare_output" title="Direct link to AnalysisActions.declare_output">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.declare_output(
prefix: <a href="/docs/api/starlark/str/">str</a>,
filename: <a href="/docs/api/starlark/str/">str</a> = ...,
/,
*,
dir: <a href="/docs/api/starlark/bool/">bool</a> = False,
uses_experimental_content_based_path_hashing: <a href="/docs/api/starlark/bool/">bool</a> = False,
has_content_based_path: <a href="/docs/api/starlark/bool/">bool</a> = False,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Returns an unbound <code>artifact</code>, representing where a file will go, which must be bound before analysis terminates. The usual way of binding an artifact is with <code>ctx.actions.run</code>. As an example:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">my_output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;output.o&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gcc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> my_source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-o&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> my_output</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">as_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> category </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;compile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This snippet declares an output with the filename <code>output.o</code> (it will be located in the output directory
for this target). Note the use of <code>as_output</code> to tag this artifact as being an output in
the action. After binding the artifact you can subsequently use <code>my_output</code> as either an
input for subsequent actions, or as the result in a provider.</p>
<p>Artifacts from a single target may not have the same name, so if you then want a second
artifact also named <code>output.o</code> you need to supply a prefix, e.g.
<code>ctx.actions.declare_output(&quot;directory&quot;, &quot;output.o&quot;)</code>. The artifact will still report having
name <code>output.o</code>, but will be located at <code>directory/output.o</code>.</p>
<p>The <code>dir</code> argument should be set to <code>True</code> if the binding will be a directory.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsdigest_config">AnalysisActions.digest_config<a href="#analysisactionsdigest_config" class="hash-link" aria-label="Direct link to AnalysisActions.digest_config" title="Direct link to AnalysisActions.digest_config">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.digest_config(
) -&gt; <a href="/docs/api/build/DigestConfig/">DigestConfig</a></code></pre>
<p>Obtain this daemon&#x27;s digest configuration. This allows rules to discover what digests the daemon may be able to e.g. defer download because they conform to its RE backend&#x27;s expected digest format.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsdownload_file">AnalysisActions.download_file<a href="#analysisactionsdownload_file" class="hash-link" aria-label="Direct link to AnalysisActions.download_file" title="Direct link to AnalysisActions.download_file">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.download_file(
output: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
url: <a href="/docs/api/starlark/str/">str</a>,
/,
*,
vpnless_url: None | <a href="/docs/api/starlark/str/">str</a> = None,
sha1: None | <a href="/docs/api/starlark/str/">str</a> = None,
sha256: None | <a href="/docs/api/starlark/str/">str</a> = None,
size_bytes: None | <a href="/docs/api/starlark/int/">int</a> = None,
is_executable: <a href="/docs/api/starlark/bool/">bool</a> = False,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Downloads a URL to an output (filename as string or output artifact). The file at the URL must have the given sha1 or the command will fail. The optional parameter is_executable indicates whether the resulting file should be marked with executable permissions. (Meta-internal) The optional parameter vpnless_url indicates a url from which this resource can be downloaded off VPN; this has the same restrictions as <code>url</code> above.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsdynamic_output">AnalysisActions.dynamic_output<a href="#analysisactionsdynamic_output" class="hash-link" aria-label="Direct link to AnalysisActions.dynamic_output" title="Direct link to AnalysisActions.dynamic_output">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.dynamic_output(
*,
dynamic: list[<a href="/docs/api/build/PromiseArtifact/">Artifact</a>] | tuple[<a href="/docs/api/build/PromiseArtifact/">Artifact</a>, ...],
inputs: list[<a href="/docs/api/build/PromiseArtifact/">Artifact</a>] | tuple[<a href="/docs/api/build/PromiseArtifact/">Artifact</a>, ...] = ...,
outputs: list[<a href="/docs/api/build/OutputArtifact/">OutputArtifact</a>] | tuple[<a href="/docs/api/build/OutputArtifact/">OutputArtifact</a>, ...],
f: typing.Callable[[typing.Any, dict[<a href="/docs/api/build/PromiseArtifact/">Artifact</a>, <a href="/docs/api/build/ArtifactValue/">ArtifactValue</a>], dict[<a href="/docs/api/build/PromiseArtifact/">Artifact</a>, <a href="/docs/api/build/PromiseArtifact/">Artifact</a>]], None],
) -&gt; None</code></pre>
<p><code>dynamic_output</code> allows a rule to use information that was not available when the rule was first run at analysis time. Examples include things like Distributed ThinLTO (where the index file is created by another action) or OCaml builds (where the dependencies are created by <code>ocamldeps</code>).</p>
<p>The arguments are:</p>
<ul>
<li><code>dynamic</code> - a list of artifacts whose values will be available in the function. These will
be built before the function is run.</li>
<li><code>inputs</code> - parameter is ignored.</li>
<li><code>outputs</code> - a list of unbound artifacts (created with <code>declare_artifact</code>) which will be
bound by the function.</li>
<li>The function argument is given 3 arguments:<!-- -->
<ul>
<li><code>ctx</code> (context) - which is the same as that passed to the initial rule analysis.</li>
<li><code>artifacts</code> - using one of the artifacts from <code>dynamic</code> (example usage:
<code>artifacts[artifact_from_dynamic])</code> gives an artifact value containing the methods
<code>read_string</code>, <code>read_lines</code>, and <code>read_json</code> to obtain the values from the disk in
various formats.  Anything too complex should be piped through a Python script for
transformation to JSON.</li>
<li><code>outputs</code> - using one of the artifacts from the <code>dynamic_output</code>&#x27;s <code>outputs</code> (example
usage: <code>outputs[artifact_from_dynamic_output_outputs]</code>) gives an unbounded artifact. The
function argument must use its <code>outputs</code> argument to bind output artifacts, rather than
reusing artifacts from the outputs passed into <code>dynamic_output</code> directly.</li>
</ul>
</li>
<li>The function must call <code>ctx.actions</code> (probably <code>ctx.actions.run</code>) to bind all outputs. It
can examine the values of the dynamic variables and depends on the inputs.<!-- -->
<ul>
<li>The function will usually be a <code>def</code>, as <code>lambda</code> in Starlark does not allow statements,
making it quite underpowered. For full details see
<a href="https://buck2.build/docs/rule_authors/dynamic_dependencies/" target="_blank" rel="noopener noreferrer">https://buck2.build/docs/rule_authors/dynamic_dependencies/</a>.</li>
</ul>
</li>
</ul>
<p>Besides dynamic dependencies, there is a second use case for <code>dynamic_output</code>: say that you
have some output artifact, and that the analysis to produce the action that outputs that
artifact is expensive, ie takes a lot of CPU time; you would like to skip that work in
builds that do not actually use that artifact.</p>
<p>This can be accomplished by putting the analysis for that artifact behind a <code>dynamic_output</code>
with an empty <code>dynamic</code> list. The <code>dynamic_output</code>&#x27;s function will not be run unless one of
the actions it outputs is actually requested as part of the build.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsdynamic_output_new">AnalysisActions.dynamic_output_new<a href="#analysisactionsdynamic_output_new" class="hash-link" aria-label="Direct link to AnalysisActions.dynamic_output_new" title="Direct link to AnalysisActions.dynamic_output_new">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.dynamic_output_new(
dynamic_actions: <a href="/docs/api/build/DynamicActions/">DynamicAction</a>,
/,
) -&gt; <a href="/docs/api/build/DynamicValue/">DynamicValue</a></code></pre>
<p>Declares a dynamic action that reads artifact contents to produce outputs.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="parameters">Parameters<a href="#parameters" class="hash-link" aria-label="Direct link to Parameters" title="Direct link to Parameters">​</a></h4>
<ul>
<li>
<p><code>dynamic_actions</code>: (required)</p>
<ul>
<li>A <code>DynamicActions</code> instance created by calling a <code>DynamicActionsCallable</code></li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="returns">Returns<a href="#returns" class="hash-link" aria-label="Direct link to Returns" title="Direct link to Returns">​</a></h4>
<p>A <code>DynamicValue</code> that can be consumed by other dynamic actions via <code>dynattrs.dynamic_value()</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="details">Details<a href="#details" class="hash-link" aria-label="Direct link to Details" title="Direct link to Details">​</a></h4>
<p>This is the new version of <code>dynamic_output</code> and will eventually replace it.
Dynamic actions enable build decisions based on the actual content of intermediate
artifacts.</p>
<h1>Workflow</h1>
<ol>
<li>Define an implementation function with signature matching your dynamic attributes</li>
<li>Create a factory (<code>DynamicActionsCallable</code>) using <code>dynamic_actions(impl=..., attrs=...)</code></li>
<li>Call that factory with concrete artifact values to create a <code>DynamicActions</code> instance</li>
<li>Pass the <code>DynamicActions</code> to <code>ctx.actions.dynamic_output_new()</code></li>
</ol>
<h1>Example</h1>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Step 1: Define the implementation function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_my_impl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AnalysisActions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ArtifactValue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> out</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputArtifact</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;feature_enabled&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;feature output&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;default output&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DefaultInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 2: Create a factory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_my_dynamic_action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dynamic_actions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    impl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _my_impl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attrs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;config&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dynattrs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">artifact_value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;out&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dynattrs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Step 3 &amp; 4: Use it in a rule or bxl script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_rule_impl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AnalysisContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;config.txt&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;feature_enabled&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">declare_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Call the factory to create a DynamicActions instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamic_action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _my_dynamic_action</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config_file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">as_output</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Execute it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dynamic_output_new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dynamic_action</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DefaultInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">default_output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See <a href="/docs/rule_authors/dynamic_dependencies/">Dynamic Dependencies</a> for an overall
overview of dynamic dependencies in buck2.</p>
<p>For a guide on using this with BXL, see <a href="/docs/bxl/how_tos/how_to_run_actions_based_on_the_content_of_artifact/">How to run actions based on the content of artifacts</a>.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionsrun">AnalysisActions.run<a href="#analysisactionsrun" class="hash-link" aria-label="Direct link to AnalysisActions.run" title="Direct link to AnalysisActions.run">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.run(
arguments: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/CellPath/">CellPath</a> | <a href="/docs/api/build/CellRoot/">CellRoot</a> | <a href="/docs/api/build/Label/">Label</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/build/ProjectRoot/">ProjectRoot</a> | <a href="/docs/api/build/ResolvedStringWithMacros/">ResolvedStringWithMacros</a> | <a href="/docs/api/build/TaggedCommandLine/">TaggedCommandLine</a> | <a href="/docs/api/build/TargetLabel/">TargetLabel</a> | <a href="/docs/api/build/TransitiveSetArgsProjection/">TransitiveSetArgsProjection</a> | <a href="/docs/api/build/WriteJsonCliArgs/">WriteJsonCliArgs</a> | <a href="/docs/api/build/cmd_args/">cmd_args</a> | <a href="/docs/api/starlark/str/">str</a> | list | RunInfo,
/,
*,
category: <a href="/docs/api/starlark/str/">str</a>,
identifier: None | <a href="/docs/api/starlark/str/">str</a> = None,
env: dict[<a href="/docs/api/starlark/str/">str</a>, <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/CellPath/">CellPath</a> | <a href="/docs/api/build/CellRoot/">CellRoot</a> | <a href="/docs/api/build/Label/">Label</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/build/ProjectRoot/">ProjectRoot</a> | <a href="/docs/api/build/ResolvedStringWithMacros/">ResolvedStringWithMacros</a> | <a href="/docs/api/build/TaggedCommandLine/">TaggedCommandLine</a> | <a href="/docs/api/build/TargetLabel/">TargetLabel</a> | <a href="/docs/api/build/TransitiveSetArgsProjection/">TransitiveSetArgsProjection</a> | <a href="/docs/api/build/WriteJsonCliArgs/">WriteJsonCliArgs</a> | <a href="/docs/api/build/cmd_args/">cmd_args</a> | <a href="/docs/api/starlark/str/">str</a> | RunInfo] = ...,
local_only: <a href="/docs/api/starlark/bool/">bool</a> = False,
prefer_local: <a href="/docs/api/starlark/bool/">bool</a> = False,
prefer_remote: <a href="/docs/api/starlark/bool/">bool</a> = False,
low_pass_filter: <a href="/docs/api/starlark/bool/">bool</a> = True,
always_print_stderr: <a href="/docs/api/starlark/bool/">bool</a> = False,
weight: <a href="/docs/api/starlark/int/">int</a> = ...,
weight_percentage: <a href="/docs/api/starlark/int/">int</a> = ...,
dep_files: dict[<a href="/docs/api/starlark/str/">str</a>, <a href="/docs/api/build/ArtifactTag/">ArtifactTag</a>] = ...,
metadata_env_var: <a href="/docs/api/starlark/str/">str</a> = ...,
metadata_path: <a href="/docs/api/starlark/str/">str</a> = ...,
incremental_metadata_ignore_tags: list[<a href="/docs/api/build/ArtifactTag/">ArtifactTag</a>] | tuple[<a href="/docs/api/build/ArtifactTag/">ArtifactTag</a>, ...] = [],
no_outputs_cleanup: <a href="/docs/api/starlark/bool/">bool</a> = False,
incremental_remote_outputs: <a href="/docs/api/starlark/bool/">bool</a> = False,
allow_cache_upload: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
allow_dep_file_cache_upload: <a href="/docs/api/starlark/bool/">bool</a> = False,
allow_offline_output_cache: <a href="/docs/api/starlark/bool/">bool</a> = False,
force_full_hybrid_if_capable: <a href="/docs/api/starlark/bool/">bool</a> = False,
exe: RunInfo | WorkerRunInfo = ...,
unique_input_inodes: <a href="/docs/api/starlark/bool/">bool</a> = False,
error_handler: None | typing.Callable = None,
remote_execution_dependencies: list[dict[<a href="/docs/api/starlark/str/">str</a>, <a href="/docs/api/starlark/str/">str</a>]] = [],
re_gang_workers: list[dict[<a href="/docs/api/starlark/str/">str</a>, <a href="/docs/api/starlark/str/">str</a>]] = [],
remote_execution_dynamic_image = None,
meta_internal_extra_params: None | dict = None,
outputs_for_error_handler: list[<a href="/docs/api/build/OutputArtifact/">OutputArtifact</a>] | tuple[<a href="/docs/api/build/OutputArtifact/">OutputArtifact</a>, ...] = [],
expect_eligible_for_dedupe: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; None</code></pre>
<p>Run a command to produce one or more artifacts.</p>
<ul>
<li><code>arguments</code>: must be of type <code>cmd_args</code>, or a type convertible to such (such as a list of
strings and artifacts). See below for detailed description of artifact arguments.</li>
<li><code>env</code>: environment variables to set when the command is executed.</li>
<li><code>category</code>: category and identifier - when used together, identify the action in Buck2&#x27;s
event stream, and must be unique for a given target</li>
<li><code>weight</code>: used to note how heavy the command is and will typically be set to a higher
value to indicate that less such commands should be run in parallel (if running locally)</li>
<li><code>no_outputs_cleanup</code>: if this flag is set then Buck2 won&#x27;t clean the outputs of a previous
build that might be present on a disk; in which case, command from arguments should be
responsible for the cleanup (that is useful, for example, when an action is supporting
incremental mode and its outputs are based on result from a previous build)</li>
<li><code>metadata_env_var</code> and <code>meadata_path</code> should be used together: both set or both unset<!-- -->
<ul>
<li><code>metadata_path</code>: defines a path relative to the result directory for a file with
action metadata, which will be created right before the command will be run.</li>
<li>Metadata contains the path relative to the Buck2 project root and hash digest for
every action input (this excludes symlinks as they could be resolved by a user script
if needed). The resolved path relative to the Buck2 project for the metadata file will
be passed to command from arguments, via the environment variable, with its name set
by <code>metadata_env_var</code></li>
<li>Both <code>metadata_env_var</code> and <code>metadata_path</code> are useful when making actions behave in
an incremental manner (for details, see <a href="https://buck2.build/docs/rule_authors/incremental_actions/" target="_blank" rel="noopener noreferrer">Incremental
Actions</a>)</li>
</ul>
</li>
<li><code>dep_files</code>: a dictionary mapping labels to <code>ArtifactTag</code> instances for tracking actual
dependencies via dependency files (depfiles). This enables precise incremental builds by
allowing the build tool to report which inputs it actually used.<!-- -->
<ul>
<li>Each entry maps a string label (e.g., <code>&quot;headers&quot;</code>) to an <code>ArtifactTag</code> created via
<code>ctx.actions.artifact_tag()</code></li>
<li>The tag should be used to mark both the potential inputs (via <code>tag.tag_artifacts()</code>)
and the depfile output that will list the actual inputs used</li>
<li>After execution, Buck2 reads the depfile and only tracks changes to inputs listed in it,
rather than all tagged inputs</li>
<li>Depfiles must use Makefile syntax: <code>output: input1 input2 input3</code></li>
<li>For complete documentation and examples, see <a href="/docs/api/build/AnalysisActions/#analysisactionsartifact_tag"><code>ctx.actions.artifact_tag()</code></a></li>
</ul>
</li>
<li><code>allow_offline_output_cache</code>: enables caching of this action&#x27;s outputs for offline builds (default: <code>false</code>)<!-- -->
<ul>
<li>When <code>true</code>, action outputs are cached during trace builds (via <code>buck2 debug trace-io</code>)
and restored during offline builds without re-executing the action</li>
<li>Intended for actions that read from the network (e.g., downloads, remote artifact fetches)
which cannot execute in offline build environments where network access is restricted</li>
<li>During trace builds: outputs are copied to <code>buck-out/offline-cache/</code> after successful execution</li>
<li>During offline builds: if all outputs exist in offline cache, they are restored without
running the action; otherwise the action executes normally (graceful fallback)</li>
<li>Requires <code>buck2.use_network_action_output_cache=true</code> config to take effect</li>
<li>Example use case: caching network downloads in containerized offline build environments</li>
</ul>
</li>
<li>The <code>prefer_local</code>, <code>prefer_remote</code> and <code>local_only</code> options allow selecting where the
action should run if the executor selected for this target is a hybrid executor.<!-- -->
<ul>
<li>All those options disable concurrent execution: the action will run on the preferred
platform first (concurrent execution only happens with a &quot;full&quot; hybrid executor).</li>
<li>Execution may be retried on the &quot;non-preferred&quot; platform if it fails due to a
transient error, except for <code>local_only</code>, which does not allow this.</li>
<li>If the executor selected is a remote-only executor and you use <code>local_only</code>, that&#x27;s an
error. The other options will not raise errors.</li>
<li>Setting more than one of those options is an error.</li>
<li>Those flags behave the same way as the equivalent <code>--prefer-remote</code>, <code>--prefer-local</code>
and <code>--local-only</code> CLI flags. The CLI flags take precedence.</li>
<li>The <code>force_full_hybrid_if_capable</code> option overrides the <code>use_limited_hybrid</code> hybrid.
The options listed above take precedence if set.</li>
</ul>
</li>
<li><code>remote_execution_dependencies</code>: list of dependencies which is passed to Remote Execution.
Each dependency is dictionary with the following keys:<!-- -->
<ul>
<li><code>smc_tier</code>: name of the SMC tier to call by RE Scheduler.</li>
<li><code>id</code>: name of the dependency.</li>
</ul>
</li>
<li><code>remote_execution_dynamic_image</code>: a custom Tupperware image which is passed to Remote Execution.
It takes a dictionary with the following keys:<!-- -->
<ul>
<li><code>identifier</code>: name of the SMC tier to call by RE Scheduler.<!-- -->
<ul>
<li><code>name</code>: name of the image.</li>
<li><code>uuid</code>: uuid of the image.</li>
</ul>
</li>
<li><code>drop_host_mount_globs</code>: list of strings containing file
globs. Any mounts globs specified will not be bind mounted
from the host.</li>
</ul>
</li>
<li><code>meta_internal_extra_params</code>: a dictionary to pass extra parameters to RE, can add more keys in the future:<!-- -->
<ul>
<li><code>remote_execution_policy</code>: refer to TExecutionPolicy.</li>
</ul>
</li>
<li><code>error_handler</code>: an optional function that analyzes action failures and produces structured error information.<!-- -->
<ul>
<li>Type signature: <code>def error_handler(ctx: ActionErrorCtx) -&gt; list[ActionSubError]</code></li>
<li>The function receives an <a href="/docs/api/build/ActionErrorCtx/"><code>ActionErrorCtx</code></a> parameter and should return a list of <a href="/docs/api/build/ActionSubError/"><code>ActionSubError</code></a> objects</li>
<li>Error handlers enable better error diagnostics and language-specific error categorization</li>
</ul>
</li>
<li><code>outputs_for_error_handler</code>: Output files to be provided to the action error handler and read by
<a href="https://buck2.build/docs/api/build/ActionErrorCtx/#actionerrorctxoutput_artifacts" target="_blank" rel="noopener noreferrer">error handler</a> in the event of a failure..<!-- -->
<ul>
<li>The output must also be declared as an output of the action</li>
<li>The output artifact must be created if the action fails</li>
<li>Nothing will be provided if left empty (Which is the default)</li>
</ul>
</li>
</ul>
<p>When actions execute, they&#x27;ll do so from the root of the repository. As they execute,
actions have exclusive access to their output directory.</p>
<p>Actions also get exclusive access to a &quot;scratch&quot; path that is exposed via the environment
variable <code>BUCK_SCRATCH_PATH</code>. This path is expressed as a path relative to the working
directory (i.e. relative to the project). This path is guaranteed to exist when the action
executes.</p>
<p>When actions run locally, the scratch path is also used as the <code>TMPDIR</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="input-and-output-artifacts">Input and output artifacts<a href="#input-and-output-artifacts" class="hash-link" aria-label="Direct link to Input and output artifacts" title="Direct link to Input and output artifacts">​</a></h3>
<p>Run action consumes arbitrary number of input artifacts
and produces at least one output artifact.</p>
<p>Both input and output artifacts can be passed in:</p>
<ul>
<li>positional <code>arguments</code> parameters</li>
<li><code>env</code> dict</li>
</ul>
<p>Input artifacts must be already bound prior to this call,
meaning these artifacts must be either:</p>
<ul>
<li>source artifacts</li>
<li>coming from dependencies</li>
<li>declared locally and bound to another action (passed to <code>.as_output()</code>)
<em>before</em> this <code>run()</code> call</li>
<li>or created already bound with some simple action like <code>write()</code></li>
</ul>
<p>Output artifacts must be declared locally (within the same analysis),
and must not be already bound. Output artifacts become &quot;bound&quot; after this call.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionssymlink_file">AnalysisActions.symlink_file<a href="#analysisactionssymlink_file" class="hash-link" aria-label="Direct link to AnalysisActions.symlink_file" title="Direct link to AnalysisActions.symlink_file">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.symlink_file(
dest: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
src: <a href="/docs/api/build/PromiseArtifact/">Artifact</a>,
/,
*,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Creates a symlink to the source <code>artifact</code> at the destination (which can be a string representing a filename or an output <code>artifact</code>) and returns the output <code>artifact</code>. The symlink works for files or directories.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionssymlinked_dir">AnalysisActions.symlinked_dir<a href="#analysisactionssymlinked_dir" class="hash-link" aria-label="Direct link to AnalysisActions.symlinked_dir" title="Direct link to AnalysisActions.symlinked_dir">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.symlinked_dir(
output: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
srcs: dict[<a href="/docs/api/starlark/str/">str</a>, <a href="/docs/api/build/PromiseArtifact/">Artifact</a>],
/,
*,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a></code></pre>
<p>Returns an <code>artifact</code> that is a directory containing symlinks. The srcs must be a dictionary of path (as string, relative to the result directory) to bound <code>artifact</code>, which will be laid out in the directory.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionstset">AnalysisActions.tset<a href="#analysisactionstset" class="hash-link" aria-label="Direct link to AnalysisActions.tset" title="Direct link to AnalysisActions.tset">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.tset(
definition: <a href="/docs/api/build/TransitiveSetDefinition/">TransitiveSetDefinition</a>,
/,
*,
value = ...,
children: typing.Iterable = ...,
) -&gt; <a href="/docs/api/build/TransitiveSet/">TransitiveSet</a></code></pre>
<p>Creates a new transitive set. For details, see <a href="https://buck2.build/docs/rule_authors/transitive_sets/" target="_blank" rel="noopener noreferrer">https://buck2.build/docs/rule_authors/transitive_sets/</a>.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionswrite">AnalysisActions.write<a href="#analysisactionswrite" class="hash-link" aria-label="Direct link to AnalysisActions.write" title="Direct link to AnalysisActions.write">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.write(
output: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
content: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/CellPath/">CellPath</a> | <a href="/docs/api/build/CellRoot/">CellRoot</a> | <a href="/docs/api/build/Label/">Label</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/build/ProjectRoot/">ProjectRoot</a> | <a href="/docs/api/build/ResolvedStringWithMacros/">ResolvedStringWithMacros</a> | <a href="/docs/api/build/TaggedCommandLine/">TaggedCommandLine</a> | <a href="/docs/api/build/TargetLabel/">TargetLabel</a> | <a href="/docs/api/build/TransitiveSetArgsProjection/">TransitiveSetArgsProjection</a> | <a href="/docs/api/build/WriteJsonCliArgs/">WriteJsonCliArgs</a> | <a href="/docs/api/build/cmd_args/">cmd_args</a> | <a href="/docs/api/starlark/str/">str</a> | list | RunInfo,
/,
*,
is_executable: <a href="/docs/api/starlark/bool/">bool</a> = False,
allow_args: <a href="/docs/api/starlark/bool/">bool</a> = False,
with_inputs: <a href="/docs/api/starlark/bool/">bool</a> = False,
absolute: <a href="/docs/api/starlark/bool/">bool</a> = False,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
use_dep_files_placeholder_for_content_based_paths: <a href="/docs/api/starlark/bool/">bool</a> = False,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | (<a href="/docs/api/build/PromiseArtifact/">Artifact</a>, list[<a href="/docs/api/build/PromiseArtifact/">Artifact</a>])</code></pre>
<p>Returns an <code>artifact</code> whose contents are <code>content</code></p>
<ul>
<li><code>is_executable</code> (optional): indicates whether the resulting file should be marked with
executable permissions</li>
<li><code>allow_args</code> (optional): must be set to <code>True</code> if you want to write parameter arguments to
the file (in particular, macros that write to file)<!-- -->
<ul>
<li>If it is true, the result will be a pair of the <code>artifact</code> containing content and a
list of artifact values that were written by macros, which should be used in hidden
fields or similar</li>
</ul>
</li>
<li><code>with_inputs</code> (optional): if set, add artifacts in <code>content</code> as associated artifacts of the return <code>artifact</code>.</li>
<li><code>absolute</code> (optional): if set, this action will produce absolute paths in its output when
rendering artifact paths. You generally shouldn&#x27;t use this if you plan to use this action
as the input for anything else, as this would effectively result in losing all shared
caching.</li>
</ul>
<p>The content is often a string, but can be any <code>ArgLike</code> value. This is occasionally useful
for generating scripts to run as a part of another action. <code>cmd_args</code> in the content are
newline separated unless another delimiter is explicitly specified.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysisactionswrite_json">AnalysisActions.write_json<a href="#analysisactionswrite_json" class="hash-link" aria-label="Direct link to AnalysisActions.write_json" title="Direct link to AnalysisActions.write_json">​</a></h2>
<pre class="language-python"><code>def AnalysisActions.write_json(
output: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/starlark/str/">str</a>,
content: <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/CellPath/">CellPath</a> | <a href="/docs/api/build/CellRoot/">CellRoot</a> | <a href="/docs/api/build/Label/">Label</a> | None | <a href="/docs/api/build/OutputArtifact/">OutputArtifact</a> | <a href="/docs/api/build/ProjectRoot/">ProjectRoot</a> | <a href="/docs/api/build/ResolvedStringWithMacros/">ResolvedStringWithMacros</a> | <a href="/docs/api/build/TaggedCommandLine/">TaggedCommandLine</a> | <a href="/docs/api/build/TaggedValue/">TaggedValue</a> | <a href="/docs/api/build/TargetLabel/">TargetLabel</a> | <a href="/docs/api/build/TransitiveSetArgsProjection/">TransitiveSetArgsProjection</a> | <a href="/docs/api/build/TransitiveSetJsonProjection/">TransitiveSetJsonProjection</a> | <a href="/docs/api/build/WriteJsonCliArgs/">WriteJsonCliArgs</a> | <a href="/docs/api/starlark/bool/">bool</a> | <a href="/docs/api/bxl/SelectConcat/">bxl.SelectConcat</a> | <a href="/docs/api/bxl/SelectDict/">bxl.SelectDict</a> | <a href="/docs/api/build/cmd_args/">cmd_args</a> | enum | <a href="/docs/api/starlark/int/">int</a> | record | <a href="/docs/api/starlark/str/">str</a> | list | tuple | dict | struct(..) | Provider | RunInfo,
/,
*,
with_inputs: <a href="/docs/api/starlark/bool/">bool</a> = False,
pretty: <a href="/docs/api/starlark/bool/">bool</a> = False,
absolute: <a href="/docs/api/starlark/bool/">bool</a> = False,
uses_experimental_content_based_path_hashing: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
has_content_based_path: None | <a href="/docs/api/starlark/bool/">bool</a> = None,
use_dep_files_placeholder_for_content_based_paths: <a href="/docs/api/starlark/bool/">bool</a> = False,
) -&gt; <a href="/docs/api/build/PromiseArtifact/">Artifact</a> | <a href="/docs/api/build/WriteJsonCliArgs/">WriteJsonCliArgs</a></code></pre>
<p>Returns an <code>artifact</code> whose contents are <code>content</code> written as a JSON value.</p>
<ul>
<li><code>output</code>: can be a string, or an existing artifact created with <code>declare_output</code></li>
<li><code>content</code>:  must be composed of the basic json types (boolean, number, string, list/tuple,
dictionary) plus artifacts and command lines<!-- -->
<ul>
<li>An artifact will be written as a string containing the path</li>
<li>A command line will be written as a list of strings, unless <code>joined=True</code> is set, in
which case it will be a string</li>
</ul>
</li>
<li>If you pass <code>with_inputs = True</code>, you&#x27;ll get back a <code>cmd_args</code> that expands to the JSON
file but carries all the underlying inputs as dependencies (so you don&#x27;t have to use, for
example, <code>hidden</code> for them to be added to an action that already receives the JSON file)</li>
<li><code>pretty</code> (optional): write formatted JSON (defaults to <code>False</code>)</li>
<li><code>absolute</code> (optional): if set, this action will produce absolute paths in its output when
rendering artifact paths. You generally shouldn&#x27;t use this if you plan to use this action
as the input for anything else, as this would effectively result in losing all shared
caching. (defaults to <code>False</code>)</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/api/build/ActionSubError/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ActionSubError</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/api/build/AnalysisContext/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AnalysisContext</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#analysisactionsanon_target" class="table-of-contents__link toc-highlight">AnalysisActions.anon_target</a></li><li><a href="#analysisactionsanon_targets" class="table-of-contents__link toc-highlight">AnalysisActions.anon_targets</a></li><li><a href="#analysisactionsartifact_tag" class="table-of-contents__link toc-highlight">AnalysisActions.artifact_tag</a><ul><li><a href="#how-dependency-files-work" class="table-of-contents__link toc-highlight">How Dependency Files Work</a></li><li><a href="#usage-pattern" class="table-of-contents__link toc-highlight">Usage Pattern</a></li><li><a href="#example-c-compilation" class="table-of-contents__link toc-highlight">Example: C++ Compilation</a></li><li><a href="#depfile-format" class="table-of-contents__link toc-highlight">Depfile Format</a></li><li><a href="#return-value" class="table-of-contents__link toc-highlight">Return Value</a></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See Also</a></li></ul></li><li><a href="#analysisactionsassert_has_content_based_path" class="table-of-contents__link toc-highlight">AnalysisActions.assert_has_content_based_path</a></li><li><a href="#analysisactionsassert_short_path" class="table-of-contents__link toc-highlight">AnalysisActions.assert_short_path</a></li><li><a href="#analysisactionscas_artifact" class="table-of-contents__link toc-highlight">AnalysisActions.cas_artifact</a></li><li><a href="#analysisactionscopied_dir" class="table-of-contents__link toc-highlight">AnalysisActions.copied_dir</a></li><li><a href="#analysisactionscopy_dir" class="table-of-contents__link toc-highlight">AnalysisActions.copy_dir</a></li><li><a href="#analysisactionscopy_file" class="table-of-contents__link toc-highlight">AnalysisActions.copy_file</a></li><li><a href="#analysisactionsdeclare_output" class="table-of-contents__link toc-highlight">AnalysisActions.declare_output</a></li><li><a href="#analysisactionsdigest_config" class="table-of-contents__link toc-highlight">AnalysisActions.digest_config</a></li><li><a href="#analysisactionsdownload_file" class="table-of-contents__link toc-highlight">AnalysisActions.download_file</a></li><li><a href="#analysisactionsdynamic_output" class="table-of-contents__link toc-highlight">AnalysisActions.dynamic_output</a></li><li><a href="#analysisactionsdynamic_output_new" class="table-of-contents__link toc-highlight">AnalysisActions.dynamic_output_new</a></li><li><a href="#analysisactionsrun" class="table-of-contents__link toc-highlight">AnalysisActions.run</a><ul><li><a href="#input-and-output-artifacts" class="table-of-contents__link toc-highlight">Input and output artifacts</a></li></ul></li><li><a href="#analysisactionssymlink_file" class="table-of-contents__link toc-highlight">AnalysisActions.symlink_file</a></li><li><a href="#analysisactionssymlinked_dir" class="table-of-contents__link toc-highlight">AnalysisActions.symlinked_dir</a></li><li><a href="#analysisactionstset" class="table-of-contents__link toc-highlight">AnalysisActions.tset</a></li><li><a href="#analysisactionswrite" class="table-of-contents__link toc-highlight">AnalysisActions.write</a></li><li><a href="#analysisactionswrite_json" class="table-of-contents__link toc-highlight">AnalysisActions.write_json</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">User guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/buck2/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/buck2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>