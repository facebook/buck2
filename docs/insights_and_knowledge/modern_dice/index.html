<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-insights_and_knowledge/modern_dice" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Introduction to Modern DICE | Buck2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://buck2.build/docs/insights_and_knowledge/modern_dice/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Introduction to Modern DICE | Buck2"><meta data-rh="true" name="description" content="Here is the transcript of our knowledge sharing session on modern dice: &lt;a"><meta data-rh="true" property="og:description" content="Here is the transcript of our knowledge sharing session on modern dice: &lt;a"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://buck2.build/docs/insights_and_knowledge/modern_dice/"><link data-rh="true" rel="alternate" href="https://buck2.build/docs/insights_and_knowledge/modern_dice/" hreflang="en"><link data-rh="true" rel="alternate" href="https://buck2.build/docs/insights_and_knowledge/modern_dice/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9RT0EWXQO8-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Buck2" href="/opensearch.xml">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GEGGHE39PE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GEGGHE39PE",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.365ec9d7.css">
<script src="/assets/js/runtime~main.7b2db4e0.js" defer="defer"></script>
<script src="/assets/js/main.116bbb72.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Buck2 Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Buck2 Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Buck2</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/docs/api/">API</a><a class="navbar__item navbar__link" href="/docs/prelude/rules/">Rules</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/buck2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/about/why/">About Buck2</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/about/why/">Why Buck2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/about/language_support/">Language / Ecosystem Support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/about/benefits/compared_to_buck1/">Benefits</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/about/benefits/compared_to_buck1/">Benefits When Compared to Buck1</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/about/bootstrapping/">Bootstrapping Buck2</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/getting_started/">Getting Started</a><button aria-label="Collapse sidebar category &#x27;Getting Started&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting_started/what_is_buck2/">What is Buck2?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting_started/install/">Installing Buck2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting_started/tutorial_first_build/">Tutorial: Your First Buck2 Application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting_started/tutorial_adding_dependencies/">Tutorial: Adding Dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting_started/tutorial_adding_tests/">Tutorial: Adding tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting_started/tutorial_to_concepts/">From Tutorial to Concepts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/concepts/key_concepts/">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/key_concepts/">Key Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/concept_map/">Concept Map</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/build_rule/">Build Rule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/build_file/">Build File</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/build_target/">Build Target</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/target_pattern/">Target Pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/buck_query_language/">Buck Query Language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/buck_out/">buck-out</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/visibility/">Visibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/toolchain/">Toolchain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/daemon/">Daemon (buckd)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/labels/">Labels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/isolation_dir/">Isolation Directory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/buckconfig/">.buckconfig</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/configurations/">Configurations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/modifiers/">Configuration modifiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/glossary/">Glossary of Terms</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/users/commands/">Buck2 Users</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/users/commands/">Commands</a><button aria-label="Collapse sidebar category &#x27;Commands&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/aquery/">aquery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/audit/">audit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/build/">build</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/bxl/">bxl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/clean/">clean</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/common-options/">common-options</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/completion/">completion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/cquery/">cquery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/ctargets/">ctargets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/docs/">docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/expand-external-cell/">expand-external-cell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/explain/">explain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/help-env/">help-env</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/init/">init</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/install/">install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/kill/">kill</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/killall/">killall</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/log/">log</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/lsp/">lsp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/profile/">profile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/query/">query</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/root/">root</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/run/">run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/server/">server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/starlark/">starlark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/status/">status</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/subscribe/">subscribe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/targets/">targets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/test/">test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/uquery/">uquery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands/utargets/">utargets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/commands_extra/exit_codes/">Exit Codes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/how_tos/modifiers_setup/">How-tos</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/how_tos/modifiers_setup/">Setup configuration modifiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/how_tos/modifiers_package/">Add configuration modifiers to entire directories</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/how_tos/modifiers_target/">Add configuration modifiers to a specific target</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/how_tos/modifiers_cli/">Specify configuration modifiers from the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/how_tos/question_mark_modifier/">?modifier CLI Syntax</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/how_tos/compilation_database/">Compilation databases</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/languages/go/overview/">Languages</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/languages/go/overview/">Go</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/languages/go/overview/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/languages/go/toolchains/">Toolchains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/languages/go/third_party_packages/">Third-Party Packages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/languages/go/gopackagesdriver/">IDE/Tools Integration (gopackagesdriver)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/languages/java/jvm_abis/">Java</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/languages/java/jvm_abis/">Java/Kotlin ABIs</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/cheat_sheet/">Cheat Sheet</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/faq/common_issues/">Troubleshooting</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/faq/common_issues/">Common Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/faq/starlark_peak_mem/">Debugging Excess Starlark Peak Memory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/faq/buck_hanging/">Why is Buck2 hanging?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/build_observability/interactive_console/">Build Observability</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/build_observability/interactive_console/">Buck2 Consoles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/build_observability/logging/">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/build_observability/build_report/">Build Report</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/remote_execution/">Remote Execution</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/query/aquery/">Queries</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/query/aquery/">Aquery Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/query/cquery/">Cquery Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/query/uquery/">Uquery Environment</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/users/advanced/deferred_materialization/">Advanced Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/advanced/deferred_materialization/">Deferred Materialization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/advanced/restarter/">Restarter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/advanced/in_memory_cache/">In Memory Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/users/advanced/external_cells/">External Cells</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/rule_authors/writing_rules/">Rule Authors</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/writing_rules/">Writing Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/writing_toolchains/">Writing Toolchains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/transitive_sets/">Transitive Sets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/configurations/">Configurations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/configurations_by_example/">Configurations By Example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/configuration_transitions/">Configuration Transitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/custom_macros/">Macros</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/dynamic_dependencies/">Dynamic Dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/anon_targets/">Anonymous Targets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/test_execution/">Test Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/optimization/">Observability and Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/incremental_actions/">Incremental Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/load/">load()</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/alias/">Alias</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/subdir_glob/">subdir_glob()</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/local_resources/">Local Resources For Tests Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/package_files/">PACKAGE Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/dep_files/">Dep Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/rule_authors/string_parameter_macros/">String parameter macros</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/bxl/">BXL Developers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/bxl/">About BXL</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/">Why BXL</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/tutorial/">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/bxl/how_tos/basic_how_tos/">How-to guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/how_tos/basic_how_tos/">Basic How-Tos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/how_tos/how_to_cache_and_share_operations/">How to Cache and Share Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/how_tos/how_to_handle_errors/">How to Handle Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/how_tos/how_to_catch_building_artifacts_errors/">How to Catch Building Artifacts Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/how_tos/how_to_run_actions_based_on_the_content_of_artifact/">How to run actions based on the content of artifact</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/how_tos/how_to_use_target_universe/">How to Use Target Universe in BXL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/how_tos/how_to_collect_telemetry_events/">How to Collect Telemetry Events</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/bxl/explanation/basics/">Explanation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/explanation/basics/">BXL Basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/explanation/labels_and_nodes/">Understanding Labels and Nodes in Buck2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/explanation/bxl_cquery_vs_cli_cquery/">BXL cquery vs. Buck2 CLI cquery - Divergence in Configuration Handling</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bxl/faq/">FAQs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/api/bxl/">BXL APIs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/developers/architecture/buck2/">Buck2 Developers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/developers/architecture/buck2/">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/architecture/buck2/">Architectural Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/architecture/buck1_vs_buck2/">Buck1 vs Buck2</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/what-ran/">Finding Commands That Buck2 Ran</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/developers/starlark/environment/">Starlark Language</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/starlark/environment/">Environments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/starlark/gc/">A Moving Garbage Collector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/starlark/heaps/">Heaps and Heap References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/starlark/spec/">Starlark Language Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/starlark/types/">Starlark Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/starlark/values/">Value Representation</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/request_for_comments/">Request for Comments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers/windows_cheat_sheet/">Windows Cheat Sheet</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/insights_and_knowledge/modern_dice/">Insights and Knowledge</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/insights_and_knowledge/modern_dice/">Introduction to Modern DICE</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Insights and Knowledge</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Introduction to Modern DICE</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Introduction to Modern Dice</h1></header>
<p>Here is the transcript of our knowledge sharing session on modern dice: <a href="/assets/Modern_DICE.pdf" target="\_blank">Download
Slides</a></p>
<p>I will be talking about modern Dice today. I’ll have to get through. I’ll try to
be good with time. So I’ll talk a little bit about what Dice is, show how to use
it, talk a little bit about the internals and what the modern Dice part of that
is.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-dice">What is Dice?<a href="#what-is-dice" class="hash-link" aria-label="Direct link to What is Dice?" title="Direct link to What is Dice?">​</a></h2>
<p>So first, what is Dice? Dice is, you know… We first named this before we started
the buck2 word; we call it Distributed Incremental Computation Engine. So what
does that mean? Computation Engine part. This is, with Dice, you configure this
with Dice by sort of providing us with leaf data and then define a set of
functions that the engine is going to manage for you, right? And then you make a
request. You know, compute function two of A, say, and it will, you know,
that’ll depend on other calls and down to leaf data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dice-vs-standard-programming-functions">Dice vs. Standard Programming Functions<a href="#dice-vs-standard-programming-functions" class="hash-link" aria-label="Direct link to Dice vs. Standard Programming Functions" title="Direct link to Dice vs. Standard Programming Functions">​</a></h2>
<p>You know, at this point, like, is this really any different than just like
Python, right? Python, you define a bunch of functions, you call them, and it
deals with, you know, calling the other functions. At this point, not really,
right? Like, yeah, it does a little bit. So it’ll spawn this work in parallel,
right? It’ll share work if multiple nodes are requesting it. But really, the
interesting parts, I think, when you get to the incremental, the incremental
computation engine.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="incremental-computation-in-dice">Incremental Computation in Dice<a href="#incremental-computation-in-dice" class="hash-link" aria-label="Direct link to Incremental Computation in Dice" title="Direct link to Incremental Computation in Dice">  ​</a></h2>
<p>So with this, we can invalidate these leaf nodes, right? So invalidate<!-- --> <a href="https://internalfb.com/L2" target="_blank" rel="noopener noreferrer">L2</a> <!-- -->down
there at the bottom. Dice tracks dependencies, and it manages this invalidation
for us, right? So it’s going to invalidate all those reverse dependencies of<!-- --> <a href="https://internalfb.com/L2" target="_blank" rel="noopener noreferrer">L2</a>.<!-- -->
Then, say, you compute a new function up here, right? It’s going to, you know,
update the node’s values for everything between, right? So it does, you know, it
does efficient recomputation, right? It only recomputes the nodes that have been
invalidated and need to be recomputed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimization-with-versioning">Optimization with Versioning<a href="#optimization-with-versioning" class="hash-link" aria-label="Direct link to Optimization with Versioning" title="Direct link to Optimization with Versioning">​</a></h2>
<p>Has this important optimization that if, as we sort of recompute up one of these
nodes, recomputes the nodes that are invalidated, it only recomputes the nodes
that are invalidated. It only recomputes the nodes that are invalidated. It only
recomputes the nodes that are invalidated. It only recomputes the same value it
had previously, right? We record that. We, you know, the values are recorded
with version numbers. We store the sort of last version that you were valid at.
And then when recomputing a node, even if it was, if it was invalidated, if all
of its dependencies are basically recomputed to the same values, that node will
skip recomputation and just say, oh, it still has the same value as it had at
B2. And so that can, that can, you know, maybe here<!-- --> <a href="https://internalfb.com/L2" target="_blank" rel="noopener noreferrer">L2</a> <!-- -->changed, but X2 and X3
didn’t. And then all the rest would not actually have to do recomputation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-distributed-part">The “Distributed” Part<a href="#the-distributed-part" class="hash-link" aria-label="Direct link to The “Distributed” Part" title="Direct link to The “Distributed” Part">​</a></h2>
<p>The distributed part, there are people who are trying, who have tried to
convince us to change the D. It’s not distributed at this point. You know, it’s
kind of like FSD, right? It’s an aspirational naming. So we’ll get to that.
We’ll get to that maybe next year, next year’s talk.</p>
<h1>Example Walkthrough: Word Count in Recursive Directory</h1>
<p>So, yeah, let’s, let’s work through an example. This is, you know, I’m just, you
know, this is sort of a toy example. Let’s, let’s do like word counts of a
recursive directory, right? Say we’ve got, you know, a couple, a couple of
functions for us already, reading files, listing directories, getting word
counts for a string. Pretend they take this long and we’ll, we’ll talk about
sort of the time it takes to, with, with different approaches.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="naive-approach-initial-directory-traversal-in-rust">Naive Approach: Initial Directory Traversal in Rust<a href="#naive-approach-initial-directory-traversal-in-rust" class="hash-link" aria-label="Direct link to Naive Approach: Initial Directory Traversal in Rust" title="Direct link to Naive Approach: Initial Directory Traversal in Rust">​</a></h2>
<p>Yeah. So this is, this is a pseudo Rust. There’s the, you know, Rust has some
required things that make it a little more proposed. I cut those out. But this
is, this is just sort of a naive approach to this, right? It’s not totally
naive, right? So we’re walking, we’re walking the directory and we’re spawning
off the sort of expensive get word count, right? So this is all done in
parallel. Join the counts at the end and then merge that, right?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dice-caching-for-improved-efficiency">Dice Caching for Improved Efficiency<a href="#dice-caching-for-improved-efficiency" class="hash-link" aria-label="Direct link to Dice Caching for Improved Efficiency" title="Direct link to Dice Caching for Improved Efficiency">​</a></h2>
<p>So, you know, through, through a couple of scenarios together here, right? The
cold one, and then a couple of incremental scenarios in this case, right?
There’s no incrementality. It’s just normal Rust code. So anytime you have to
compute it, it’s going to pay the full cost. I was, you know, I tried to try to
get the numbers here, correct, but I wasn’t super careful. So if, if I’m off a
little bit. So that’s, you know, don’t worry about it, but yeah, so, so the time
here, right? You have, you have something like a, you know, in parallel, you
have like a thousand seconds of, of directory traversal and 10,000 or something
of getting word counts, something like that.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-dice-node-for-caching-word-count">Implementing Dice Node for Caching Word Count<a href="#implementing-dice-node-for-caching-word-count" class="hash-link" aria-label="Direct link to Implementing Dice Node for Caching Word Count" title="Direct link to Implementing Dice Node for Caching Word Count">​</a></h2>
<p>Okay. So the, the first, the obvious one, if, you know, we have, we have dice,
it does, you know, it’s supposed to do caching for us, let’s cache that
expensive get word count. And so this is, this is what it was. Look like, uh,
with a lot of, with a lot of boilerplate removed of sort of introducing a dice
node to, to cache that word count, right? So we introduced a word count key, and
then we have this key implementation. This key implementation is like the
functions I was referring to in the dice configuration, right? Which tells you
how to take, uh, a key is like the, you know, the input to the function. And
then this compute call is, is the function, this is going to be what dice is
caching and right. All it does is the get word count, uh, which are.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="updating-the-recursive-function-for-cached-word-count">Updating the Recursive Function for Cached Word Count<a href="#updating-the-recursive-function-for-cached-word-count" class="hash-link" aria-label="Direct link to Updating the Recursive Function for Cached Word Count" title="Direct link to Updating the Recursive Function for Cached Word Count">​</a></h2>
<p>Dice read file in here. So, uh, imagine that, uh, read file is one of those
leafs in the, in the image report, right? Uh, and so then using that, we can
update our word count recursive, uh, right. I circled the differences here,
right? We are pushing, we’re collecting a list of files instead of list of, uh,
get word count futures. And then at the end, we do this instead of futures join
all we’re doing this CTX that join all on the dice computations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-in-parallelization-and-directory-walk">Limitations in Parallelization and Directory Walk<a href="#limitations-in-parallelization-and-directory-walk" class="hash-link" aria-label="Direct link to Limitations in Parallelization and Directory Walk" title="Direct link to Limitations in Parallelization and Directory Walk">​</a></h2>
<p>Right. Um, you know, one of the things here, unlike the previous one, the
previous one could start spawning the work early, right? In this case, you see,
actually, we have to do the full directory walk before we spawn the work. Uh,
and that’s due to the dice computations here. If you look at the function
signature, it takes a new reference. Um, if you are working rust, you know, you
can only have sort of one of those at a time. So we wouldn’t be able to spawn
those off early, uh, we don’t want to be able to spawn off one.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="incremental-caching-benefits-and-drawbacks">Incremental Caching Benefits and Drawbacks<a href="#incremental-caching-benefits-and-drawbacks" class="hash-link" aria-label="Direct link to Incremental Caching Benefits and Drawbacks" title="Direct link to Incremental Caching Benefits and Drawbacks">​</a></h2>
<p>So, so, okay, great. So we, we, in this case, right. So because of that, uh,
needing to walk first before spawning any work, right. The cold case is actually
slower. Uh, but all, all the add file add or fixed type will rename file. I’ll
get much faster. Right. So if you think, if you think through, okay, so the, the
get word count is going to be cashed. If you add a file, um, the work that’s
going to need to be redone is like, yeah, we have to. First that directory, we
sort of request out all the, all the word counts and we only actually have to
recompute the one new one.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimizing-recursive-spawning-and-merging">Optimizing Recursive Spawning and Merging<a href="#optimizing-recursive-spawning-and-merging" class="hash-link" aria-label="Direct link to Optimizing Recursive Spawning and Merging" title="Direct link to Optimizing Recursive Spawning and Merging">​</a></h2>
<p>Uh, and then actually the merge at the end is another, is another thousand
seconds, uh, because it’s emerging, you know, because of these costs that I,
that I threw out there. Uh, so okay. Uh, let’s, let’s see, let’s fix the, let’s
fix the, just the first, like getting it all to spawn in parallel, right? So we
can do that. This is just changing the word count to, um, sort of spawn out
these red spawned out, recursive, right? So, so we spawn out for it, for a
directory, we list it and sub directories, we spawn out the, the recurse for
that and then, and then merge it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enhanced-caching-at-directory-level">Enhanced Caching at Directory Level<a href="#enhanced-caching-at-directory-level" class="hash-link" aria-label="Direct link to Enhanced Caching at Directory Level" title="Direct link to Enhanced Caching at Directory Level">​</a></h2>
<p>Right. So this both, uh, does it all in parallel, but also the merge at the end
is not all million items. It’s, you know, just the items for one directory kind
of merge them as we, as we recurse up. Right. Uh, so. I think this is, wait, did
I say that wrong? Uh, we don’t merge them as we recurse up in this case. Do we?
All right. Uh, these, these numbers are a little wrong. I think they should do
mostly a hundred seconds. Um, but again, so this is, this is getting a bit
better.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-optimizations-using-early-cutoff">Final Optimizations Using Early Cutoff<a href="#final-optimizations-using-early-cutoff" class="hash-link" aria-label="Direct link to Final Optimizations Using Early Cutoff" title="Direct link to Final Optimizations Using Early Cutoff">​</a></h2>
<p>Uh, but we can, we can do even better than that, right? We can, we can put on
dice, the word counts for each of the directories, right. Um, or recursive for
each directory. And so this looks very much like the, the. Caching it for a
file, right. So it looks the same, uh, I kind of call it a word comp recursive
before here, which is going to be right here, right? And so again, we don’t
change much. We switched to a dice list directory. So we’re caching the, just
the directory listing and then a dice, uh, work count. The recursively cache
dice word count.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-efficient-caching-with-early-cutoff">Summary: Efficient Caching with Early Cutoff<a href="#summary-efficient-caching-with-early-cutoff" class="hash-link" aria-label="Direct link to Summary: Efficient Caching with Early Cutoff" title="Direct link to Summary: Efficient Caching with Early Cutoff">​</a></h2>
<p>Uh, and now our timings get much better right now. Right now, we just, in each
of these cases, I think it ends up being, we are recomputing one, one, uh, sort
of file word count and then just merging them up a set of directories. We can do
a little bit better here, right? So in the fixed typo and rename file case,
right? The actual like word counts of that file or that directory don’t change.
Um, and so that’s, that’s where we should be able to get this early cutoff and
the way. We do that is if you go back to the key implementations, they have this
equality function and you’re right. So we implement the equality function and
then dice while it’s doing the recomputation, we’ll, we’ll apply this early
cutoff optimization for us. Quality here is simple. And so then we get sort of
our best case scenarios for, for each, for each case. Okay. So that, that gets
us through the example.</p>
<h1>Core State Thread and Key Operations</h1>
<p>Okay. Uh, great. Looking into the core state thread, really, there are just
three main messages it receives. There’s actually a list of like a dozen or so,
but three main ones are important. The first is an update state message, which
is used for injecting values at the leaves or invalidating them. For each of
these, the core state will invalidate the node, traverse the dependencies, and
increment its version if anything changed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-lookup-and-version-management">Key Lookup and Version Management<a href="#key-lookup-and-version-management" class="hash-link" aria-label="Direct link to Key Lookup and Version Management" title="Direct link to Key Lookup and Version Management">​</a></h2>
<p>The next key operation is look_up_key, which finds a node in the map. If it’s
there and valid, it returns a match; if it’s missing, it returns a compute, or
if it’s invalidated, it triggers dependency checks. Versions increment with each
change, and every computation starts at the newest version, maintaining a
history of node states to track when they were last computed or invalidated.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="managing-computed-state-and-the-role-of-modern-dice">Managing Computed State and the Role of Modern Dice<a href="#managing-computed-state-and-the-role-of-modern-dice" class="hash-link" aria-label="Direct link to Managing Computed State and the Role of Modern Dice" title="Direct link to Managing Computed State and the Role of Modern Dice">​</a></h2>
<p>After a compute task finishes, the updated computed column records new values
and dependencies. This structure, where a single-threaded core state manages the
main state, is one of the major changes with Modern Dice. Previously, the main
state was managed within the async evaluator with fine-grained locks, which
became complex to manage, motivating the shift to single-threaded state
management.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dependency-checking-with-check-depths">Dependency Checking with Check Depths<a href="#dependency-checking-with-check-depths" class="hash-link" aria-label="Direct link to Dependency Checking with Check Depths" title="Direct link to Dependency Checking with Check Depths">​</a></h2>
<p>Let’s talk about check_depths and how it works. Imagine this as our recursive
word count example. If a file or directory changes, the core state returns
check_depths. In the old Buck approach, all dependencies were checked in
parallel, exiting early if a change was detected, but this could spawn
unnecessary tasks. For instance, if hacking.md was deleted, an invalid key
request could trigger a panic, as seen in Buck’s previous behavior.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimizing-dependency-checks-for-performance">Optimizing Dependency Checks for Performance<a href="#optimizing-dependency-checks-for-performance" class="hash-link" aria-label="Direct link to Optimizing Dependency Checks for Performance" title="Direct link to Optimizing Dependency Checks for Performance">​</a></h2>
<p>The first fix was to check dependencies in order, but this was too slow, as it
led to single-threaded recomputation until changes were found. In Modern Dice,
we use a different approach. With CTX.joinAll, each dependency computation runs
in its own dice computation. Each future created gets its own dependency
tracking, and when joinAll finishes, all dependencies merge into the outer dice
computation as a series-parallel graph, allowing for both ordered and parallel
computations efficiently.</p>
<h1>Series-Parallel Graph Structure for Dependency Tracking</h1>
<p>All right. This is kind of a picture of what a series parallel graph looks like.
This isn&#x27;t related to the recursive word count key stuff. I think maybe it would
be nice if it were, if I had an example of the code here to show it. But, right.
So the idea here would be, you know, this looks like, you know, a computeK1,
computeK2, and then a joinAll splits into three, you know, three inner things.
This could be a join3, right? And so then looking through the top ones, a
computeK3, and then another, say, a join2, et cetera. And then the red dots are
sort of just indicating when the join finishes. Right. So, like, that&#x27;s the
structure. That&#x27;s the structure of depths that we are, that we&#x27;re recording when
we talk about recording depths.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="benefits-of-non-speculative-dependency-checks">Benefits of Non-Speculative Dependency Checks<a href="#benefits-of-non-speculative-dependency-checks" class="hash-link" aria-label="Direct link to Benefits of Non-Speculative Dependency Checks" title="Direct link to Benefits of Non-Speculative Dependency Checks">​</a></h2>
<p>We record them in, like, it&#x27;s like two flat lists, right? It&#x27;s recorded as a
flat list of keys and then a flat list of descriptors that describe how to
understand those keys as this graph. And so the checkDepthSpeed3 looks a little
bit more like this. You know, this kind, you know. We iterate through the, we
iterate through sort of the series nodes in the graphs, right? Checking them in
order, exiting out as soon as we get one that&#x27;s changed. Parallel node, parallel
nodes, we still do the spawn. Maybe I missed a spawn here, but I have the
joinAll. And it turns out, like, with this, right, we won&#x27;t ever request a key
that the normal compute wouldn&#x27;t also request. Right. We&#x27;ve sort of tracked the
intra-node data flow or data dependencies, rather. And so one of the great
things that means is that, like, previously, we would have to cancel, right? We
do these checkDepths. It spawns off, you know, it spawns off 10 nodes. Those
spawn off a bunch more. And then we find one change, and we, like, cancel all
that work because, you know, it&#x27;s all speculative. At this point, it&#x27;s, like,
not really speculative, right? We know. Even if this. The depth changes, like,
great. That&#x27;s fine. We do have to redo the compute, and we&#x27;re going to start
redoing the compute. But doing that compute is going to request all the same
things that we&#x27;re doing here because the things up to what we&#x27;re doing here have
been, you know, it will get the same results that it previously had gotten. And
so then we&#x27;ll do the next things the same. Assuming that your compute is not
non-deterministic, which we&#x27;ve been pretty good about. That&#x27;s not. We&#x27;ve been
bad about other things, but pretty good about having deterministic piece.</p>
<h1>Internal Workflow of Dice Computations</h1>
<p>Let me talk a bit about how this works. So this is, you know, here’s, here’s the
part of the get word count. I cut out the rest, but this is, you do CTX.compute
on this key. Uh, what’s it doing? Uh, it behaves sort of just like you had
called compute, you know, the word count key’s compute code. But internally
there’s a lot going on.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-parallel-processing-and-task-management">Overview of Parallel Processing and Task Management<a href="#overview-of-parallel-processing-and-task-management" class="hash-link" aria-label="Direct link to Overview of Parallel Processing and Task Management" title="Direct link to Overview of Parallel Processing and Task Management">​</a></h2>
<p>So this is like the rough sketch of this, right? We have a Tokio runtime doing a
whole bunch of things in parallel. We have a whole bunch of different sorts of
computes going on, and each one of them is holding onto one of these dice
computations, which has a depth recording when you call compute. This goes to an
async evaluator, which we have one per transaction—essentially one per larger
computation, like one per buck command.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="caching-mechanism-and-state-management">Caching Mechanism and State Management<a href="#caching-mechanism-and-state-management" class="hash-link" aria-label="Direct link to Caching Mechanism and State Management" title="Direct link to Caching Mechanism and State Management">​</a></h2>
<p>The async evaluator maintains a shared cache of keys to tasks. A task is
essentially about getting the result. The first time we get a compute request,
it spawns the computation and communicates with the core state thread, where the
main cache and state management occur over time. The shared cache is more
temporary, quickly sharing work when multiple requests hit the same key, but the
core state thread manages the main state.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="processing-a-compute-request">Processing a Compute Request<a href="#processing-a-compute-request" class="hash-link" aria-label="Direct link to Processing a Compute Request" title="Direct link to Processing a Compute Request">​</a></h2>
<p>Let’s work through how this goes: Dice computations hold the reference to the
compute call, which goes to the async evaluator. The evaluator returns a shared
future; then, we await on it, record the dependency, and return the result to
the user code. For Dice computations, that’s it. It’s straightforward.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="function-of-the-async-evaluator">Function of the Async Evaluator<a href="#function-of-the-async-evaluator" class="hash-link" aria-label="Direct link to Function of the Async Evaluator" title="Direct link to Function of the Async Evaluator">​</a></h2>
<p>The async evaluator does a get_or_insert on its map, spawning a task for each
requested key once per transaction. The compute task sends a message to the
state thread to look up the key in the state cache. If the state has it cached,
it returns a match to the compute task, which satisfies the future, and anyone
awaiting it receives the result.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-cache-misses">Handling Cache Misses<a href="#handling-cache-misses" class="hash-link" aria-label="Direct link to Handling Cache Misses" title="Direct link to Handling Cache Misses">​</a></h2>
<p>If the key isn’t in the cache, the core state first returns a compute, then the
compute task calls the key’s compute implementation, retrieves the result, and
sends it back to the core state. The core state may return a different result
than what was sent by the compute task due to reference equality requirements.
It’s essential to return the result instance from the core state, even if
logically equal.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-invalidated-values">Handling Invalidated Values<a href="#handling-invalidated-values" class="hash-link" aria-label="Direct link to Handling Invalidated Values" title="Direct link to Handling Invalidated Values">​</a></h2>
<p>The final case is when the core state had a cached value that became
invalidated. Here, the core state returns check_deps with information about
dependencies that need re-checking. If dependencies have changed, the compute
task recomputes following the same path. If dependencies are unchanged, a
message indicating no changes is sent, providing the same result back.</p>
<h1>Data Flow in Dice Computation</h1>
<p>So, yeah. A little bit about how data flows overall into the Dice computation,
right? Like, there’s three ways that it’s intended to flow in, right? We have
injected keys sort of down the leaves at the bottom of the graph as I drew it,
right? This is going to be used for like global data for things that are in like
one state for a particular computation. A really good example of this previously
was buck config, right? The whole buck config would be computed and then put in
a leaf. We’ve actually now, the computation is actually now split and done
partially on Dice, but still the main inputs to buck config are leaves on the
graph.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="injected-keys-and-their-impact">Injected Keys and Their Impact<a href="#injected-keys-and-their-impact" class="hash-link" aria-label="Direct link to Injected Keys and Their Impact" title="Direct link to Injected Keys and Their Impact">​</a></h2>
<p>The buck out path, I think, is in an injected key. I think the path to the
prelude, things like this, where it’s like, yeah, we only have one of those.
It’s not really going to, you know, we don’t expect the work. I shouldn’t say
that if the workflow involves like changing one of these a lot, using an
injected key may not be the best thing, right? Because if say something like
buck config, right? If you change buck config, it invalidates basically
everything. And like the workflows for users require changing buck config today.
And so that’s like an unfortunate aspect of the buck config design that sort of
requires that, and like, it’s not, you know, injected key for that. Like, yes,
it’s how you have to do it because that’s the design of buck config, but it’s
not great for the workflow.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="user-data-in-dice">User Data in Dice<a href="#user-data-in-dice" class="hash-link" aria-label="Direct link to User Data in Dice" title="Direct link to User Data in Dice">​</a></h2>
<p>The buck out path, right? We don’t, you know, that’s not changing during normal
work. And so like, if the cost of changing that is high, that’s like, you know,
files and directories that act like this, they’re not injected. We don’t inject
the values, but we do like invalidate them. Kind of similar. And like, that is
kind of where data comes in from outside the graph, user data. User data is just
data that we stick on Dice to give us access to things that are useful to have
access to, but aren’t meaningful to the computation. The best example of this is
the event dispatcher, right? Every buck command creates an event dispatcher to
sort of get events back out to the client or to the log. And we, you know, we
put this on the per transaction user data, and keys just access this as much as
they want.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keys-and-specific-computation-targets">Keys and Specific Computation Targets<a href="#keys-and-specific-computation-targets" class="hash-link" aria-label="Direct link to Keys and Specific Computation Targets" title="Direct link to Keys and Specific Computation Targets">​</a></h2>
<p>Dice doesn’t really track accesses to user data. And so it’s really only
intended for things that aren’t going to affect the computation. And then the
other way that you might not think about data getting into the computation, but
it really is, is in the data in the keys themselves. For a build, you know, this
might be as little as just what the target is, right. In some sense, Dice could
compute anything, right? It’s like this large infinite graph of possibilities,
and you’re telling it which specific ones you want. I think what people might
think of more as data are BXL files. So BXL files end up in a key for like a BXL
computation. Great. And from those, we form these huge computations of work,
right?</p>
<h1>Best Practices and Key Pitfalls</h1>
<p>Great, a little bit about, I don’t know, best practices, things to keep in mind.
I’m not gonna actually, I’m not gonna go through all of these; maybe I’ll leave
this slide up when we get to questions. But the biggest things are like key in
value, key equality especially is where we’ve sort of had the most issues of
getting it incorrect. This is from, you know, one sort of mistake we make is we
will have a tendency, I think, to think about things in terms of like what
states they can be within a command, right? And so within a command, a
configured target node, right? The configured target label is like a unique
identifier for one specific configured target node, right? That’s true within a
command, but when you start comparing keys or values across commands, that’s no
longer true.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenges-in-key-equality-and-state-tracking">Challenges in Key Equality and State Tracking<a href="#challenges-in-key-equality-and-state-tracking" class="hash-link" aria-label="Direct link to Challenges in Key Equality and State Tracking" title="Direct link to Challenges in Key Equality and State Tracking">​</a></h2>
<p>If you know, you might make a change, right? You might make a change to
something that’s producing a new configured target node for the same configured
target label. And Dice is gonna want to be able to compare both keys and values
across those states. And so that’s sort of a pitfall we’ve fallen into. Another
is allowing data flow that is not tracked by Dice, right? So if in your key or
in your value, you have a mutex, and you have some mutable state in there, that
can allow data to flow in ways that Dice isn’t tracking, which can cause bad
behavior.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="avoiding-untracked-data-flows-in-keys-and-values">Avoiding Untracked Data Flows in Keys and Values<a href="#avoiding-untracked-data-flows-in-keys-and-values" class="hash-link" aria-label="Direct link to Avoiding Untracked Data Flows in Keys and Values" title="Direct link to Avoiding Untracked Data Flows in Keys and Values">​</a></h2>
<p>An interesting one we had was like a lazily initialized lock, either a once lock
or a lazy if people know the Rust concepts. In one of these, it was in a key,
and we thought that we were doing it correctly, but we basically allowed data
flow that Dice wasn’t tracking correctly. Those are the big things—getting
equality right is critical.</p>
<p>User Data Considerations and Proper Data Flow</p>
<p>And then, like, don’t put things in user data that are essential to the
computation, right? They have to get into the computation in another way, often
just on a leaf in the graph. Often, the things that people want to put in user
data end up being more appropriate just on a leaf in the graph.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenges-in-introducing-new-data">Challenges in Introducing New Data<a href="#challenges-in-introducing-new-data" class="hash-link" aria-label="Direct link to Challenges in Introducing New Data" title="Direct link to Challenges in Introducing New Data">​</a></h2>
<p>Introducing new data that flows through keys can be really hard. You can imagine
host info today, available in Starlark, right? You have this host info. You can
imagine wanting to switch that from being an injected key to being in the key
itself and flowing down. And what you find is that you have to flow that
anywhere that a target label goes. Anywhere a target label’s in a key also ends
up needing that info, but it can be hard to introduce new things there.</p>
<h1>Conclusion of Modern Dice Overview</h1>
<p>Okay, that’s it. Modern Dice, quick half-hour overview.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developers/windows_cheat_sheet/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Windows Cheat Sheet</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-dice" class="table-of-contents__link toc-highlight">What is Dice?</a></li><li><a href="#dice-vs-standard-programming-functions" class="table-of-contents__link toc-highlight">Dice vs. Standard Programming Functions</a></li><li><a href="#incremental-computation-in-dice" class="table-of-contents__link toc-highlight">Incremental Computation in Dice</a></li><li><a href="#optimization-with-versioning" class="table-of-contents__link toc-highlight">Optimization with Versioning</a></li><li><a href="#the-distributed-part" class="table-of-contents__link toc-highlight">The “Distributed” Part</a></li><li><a href="#naive-approach-initial-directory-traversal-in-rust" class="table-of-contents__link toc-highlight">Naive Approach: Initial Directory Traversal in Rust</a></li><li><a href="#dice-caching-for-improved-efficiency" class="table-of-contents__link toc-highlight">Dice Caching for Improved Efficiency</a></li><li><a href="#implementing-dice-node-for-caching-word-count" class="table-of-contents__link toc-highlight">Implementing Dice Node for Caching Word Count</a></li><li><a href="#updating-the-recursive-function-for-cached-word-count" class="table-of-contents__link toc-highlight">Updating the Recursive Function for Cached Word Count</a></li><li><a href="#limitations-in-parallelization-and-directory-walk" class="table-of-contents__link toc-highlight">Limitations in Parallelization and Directory Walk</a></li><li><a href="#incremental-caching-benefits-and-drawbacks" class="table-of-contents__link toc-highlight">Incremental Caching Benefits and Drawbacks</a></li><li><a href="#optimizing-recursive-spawning-and-merging" class="table-of-contents__link toc-highlight">Optimizing Recursive Spawning and Merging</a></li><li><a href="#enhanced-caching-at-directory-level" class="table-of-contents__link toc-highlight">Enhanced Caching at Directory Level</a></li><li><a href="#final-optimizations-using-early-cutoff" class="table-of-contents__link toc-highlight">Final Optimizations Using Early Cutoff</a></li><li><a href="#summary-efficient-caching-with-early-cutoff" class="table-of-contents__link toc-highlight">Summary: Efficient Caching with Early Cutoff</a></li><li><a href="#key-lookup-and-version-management" class="table-of-contents__link toc-highlight">Key Lookup and Version Management</a></li><li><a href="#managing-computed-state-and-the-role-of-modern-dice" class="table-of-contents__link toc-highlight">Managing Computed State and the Role of Modern Dice</a></li><li><a href="#dependency-checking-with-check-depths" class="table-of-contents__link toc-highlight">Dependency Checking with Check Depths</a></li><li><a href="#optimizing-dependency-checks-for-performance" class="table-of-contents__link toc-highlight">Optimizing Dependency Checks for Performance</a></li><li><a href="#benefits-of-non-speculative-dependency-checks" class="table-of-contents__link toc-highlight">Benefits of Non-Speculative Dependency Checks</a></li><li><a href="#overview-of-parallel-processing-and-task-management" class="table-of-contents__link toc-highlight">Overview of Parallel Processing and Task Management</a></li><li><a href="#caching-mechanism-and-state-management" class="table-of-contents__link toc-highlight">Caching Mechanism and State Management</a></li><li><a href="#processing-a-compute-request" class="table-of-contents__link toc-highlight">Processing a Compute Request</a></li><li><a href="#function-of-the-async-evaluator" class="table-of-contents__link toc-highlight">Function of the Async Evaluator</a></li><li><a href="#handling-cache-misses" class="table-of-contents__link toc-highlight">Handling Cache Misses</a></li><li><a href="#handling-invalidated-values" class="table-of-contents__link toc-highlight">Handling Invalidated Values</a></li><li><a href="#injected-keys-and-their-impact" class="table-of-contents__link toc-highlight">Injected Keys and Their Impact</a></li><li><a href="#user-data-in-dice" class="table-of-contents__link toc-highlight">User Data in Dice</a></li><li><a href="#keys-and-specific-computation-targets" class="table-of-contents__link toc-highlight">Keys and Specific Computation Targets</a></li><li><a href="#challenges-in-key-equality-and-state-tracking" class="table-of-contents__link toc-highlight">Challenges in Key Equality and State Tracking</a></li><li><a href="#avoiding-untracked-data-flows-in-keys-and-values" class="table-of-contents__link toc-highlight">Avoiding Untracked Data Flows in Keys and Values</a></li><li><a href="#challenges-in-introducing-new-data" class="table-of-contents__link toc-highlight">Challenges in Introducing New Data</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">User guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/buck2/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/buck2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>