<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-rfcs/drafts/oss-observability" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Observability for Buck2 OSS | Buck2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://buck2.build/docs/rfcs/drafts/oss-observability/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Observability for Buck2 OSS | Buck2"><meta data-rh="true" name="description" content="Context"><meta data-rh="true" property="og:description" content="Context"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://buck2.build/docs/rfcs/drafts/oss-observability/"><link data-rh="true" rel="alternate" href="https://buck2.build/docs/rfcs/drafts/oss-observability/" hreflang="en"><link data-rh="true" rel="alternate" href="https://buck2.build/docs/rfcs/drafts/oss-observability/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9RT0EWXQO8-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Buck2" href="/opensearch.xml">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GEGGHE39PE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GEGGHE39PE",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.365ec9d7.css">
<script src="/assets/js/runtime~main.7b2db4e0.js" defer="defer"></script>
<script src="/assets/js/main.116bbb72.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Buck2 Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Buck2 Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Buck2</b></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/docs/api/">API</a><a class="navbar__item navbar__link" href="/docs/prelude/rules/">Rules</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/buck2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Observability for Buck2 OSS</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2>
<p>In large organizations building software is a fundamental part of a developer&#x27;s
journey and can significantly impact productivity. As such, being able to
monitor and debug builds is a fundamental ability every user and power-user must
have. This ability is further limited by the remote nature of CI builds where
instances are usually remote and most of the times inaccessible due to security
requirements (see
<a href="https://slsa.dev/spec/v1.0/levels#build-l2" target="_blank" rel="noopener noreferrer">SLSA L2 and above</a>).</p>
<p>Meta already seems to support an internal version of this based on thrift.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prior-art">Prior Art<a href="#prior-art" class="hash-link" aria-label="Direct link to Prior Art" title="Direct link to Prior Art">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bazel---bep">Bazel - BEP<a href="#bazel---bep" class="hash-link" aria-label="Direct link to Bazel - BEP" title="Direct link to Bazel - BEP">​</a></h3>
<p>Bazel provides multiple tools to monitor and debug various aspects of a build,
but most importantly it supports a protocol called BEP (Build Event Protocol) to
send events to a remote server. The API is tool agnostic and only provides a
method to send events of some kind. The type of the events though can be defined
on a per tool basis. Bazel comes with its own set of events that should be
almost completely applicable to Buck2 as well, given the similarities between
the two.</p>
<p>File uploads are performed using the same ByteStream API the RBE protocol uses.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="open-telemetry--prometheus">Open Telemetry / Prometheus<a href="#open-telemetry--prometheus" class="hash-link" aria-label="Direct link to Open Telemetry / Prometheus" title="Direct link to Open Telemetry / Prometheus">​</a></h3>
<ul>
<li><a href="https://github.com/mvisonneau/gitlab-ci-pipelines-exporter" target="_blank" rel="noopener noreferrer">gitlab-ci-pipelines-exporter</a></li>
<li><a href="https://github.com/craigatk/opentelemetry-gradle-plugin" target="_blank" rel="noopener noreferrer">opentelemetry-gradle-plugin</a></li>
<li><a href="https://github.com/inception-health/otel-export-trace-action" target="_blank" rel="noopener noreferrer">otel-export-trace-action</a></li>
<li><a href="https://github.com/zoidyzoidzoid/gitlab-honeycomb-buildevents-webhooks-sink" target="_blank" rel="noopener noreferrer">gitlab-honeycomb-buildevents-webhooks-sink</a></li>
<li><a href="https://github.com/craigatk/opentelemetry-gradle-plugin" target="_blank" rel="noopener noreferrer">opentelemetry-gradle-plugin</a></li>
</ul>
<p>There are a variety of other build systems and CIs that instead of implementing
their own telemetry, rely on a more standardised approach using OTEL or
Prometheus. Though this is potentially a good idea in terms of maintainability,
it does not come with build debugging tooling out of the box, unlike BES.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="buck2s-existing-buckevent">Buck2&#x27;s existing BuckEvent<a href="#buck2s-existing-buckevent" class="hash-link" aria-label="Direct link to Buck2&#x27;s existing BuckEvent" title="Direct link to Buck2&#x27;s existing BuckEvent">​</a></h2>
<p>Buck2 already has a <code>BuckEvent</code> it defines. This could be transformed into a
format supported by other APIs or a new API and combined with other options
described in this document.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="others">Others<a href="#others" class="hash-link" aria-label="Direct link to Others" title="Direct link to Others">​</a></h2>
<ul>
<li><a href="https://github.com/googleapis/googleapis/blob/master/google/devtools/resultstore/v2/resultstore_upload.proto" target="_blank" rel="noopener noreferrer">Chromium Siso&#x27;s ResultStore</a></li>
<li><a href="https://github.com/bazelbuild/reclient/blob/ed0afeddb1b5f0d001a6c8578f000217f06534dc/internal/pkg/event/event.go#L19" target="_blank" rel="noopener noreferrer">Reclient&#x27;s Event</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tools-using-bep">Tools using BEP<a href="#tools-using-bep" class="hash-link" aria-label="Direct link to Tools using BEP" title="Direct link to Tools using BEP">​</a></h4>
<p>The biggest advantage in adopting this protocol is the number of already
existing tools already able to process it. Anecdotally there are various
internal users, especially large corporations, using BEP to create integrations
and tools of all kinds (eg:
<a href="https://youtu.be/qboJOW1vZLA?si=w7uC-ZxhGtHHM_m6" target="_blank" rel="noopener noreferrer">Salesforce&#x27;s talk during &#x27;Build Meetup 2021&#x27;</a>).
This, combined with the already existing similarities with Bazel, could be a
driver for adoption. Furtheremore, there are some commercial and free-OSS
options available:</p>
<ul>
<li><a href="https://www.engflow.com/" target="_blank" rel="noopener noreferrer">EngFlow (commercial)</a></li>
<li>BuildBuddy:
<a href="https://github.com/buildbuddy-io/buildbuddy" target="_blank" rel="noopener noreferrer">limited free OSS offering</a> and
<a href="https://www.buildbuddy.io/" target="_blank" rel="noopener noreferrer">fully featured commercial</a></li>
<li><a href="https://bzl.io/" target="_blank" rel="noopener noreferrer">Bzl and stackb&#x27;s build UI (commercial)</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="open-problems">Open problems<a href="#open-problems" class="hash-link" aria-label="Direct link to Open problems" title="Direct link to Open problems">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sync-vs-async-event-stream">Sync Vs Async event stream<a href="#sync-vs-async-event-stream" class="hash-link" aria-label="Direct link to Sync Vs Async event stream" title="Direct link to Sync Vs Async event stream">​</a></h3>
<p>Sending events to a remote end may cause a build to incur delays. The most clear
of which is when a user wants to ensure that by the end of a command&#x27;s
invocation all events have been successfully uploaded or the command exits
unsuccessfully. Doing this within the command itself will always add additional
time to the build. At a minimum that delay will be the time it takes to send the
last event, but in the worst case scenario this could cause the build to wait
for multiple large blobs to be uploaded. This could take several minute and have
a profound impact on performances.</p>
<p>Alternatively, the events could be send asynchronously. This works really well
when the instance the command is run from can be guaranteed to stay alive for as
long as it takes to upload all the events. This is typically not the case with
ephemeral CI instances which are becoming more and more common. Furthermore,
consecutive invocations that do not wait for the previous events to be sent may
incur higher network latency. Finally, mutating the file system during an
asynchronous stream of events may cause inconsistent uploads and thus incorrect
results.</p>
<p>Bazel implements both options. A third option could be to use async but provide
a <code>buck2 flush events</code> subcommand that waits until all the existing events have
been sent, retried if necessary and returns success or failure depending on the
outcome of the upload of events.</p>
<p>All these options are <strong>NOT</strong> mutually exclusive and do in fact combine quite
well.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-bazels-events-or-creating-custom-new-ones">Using bazel&#x27;s events or creating custom new ones?<a href="#using-bazels-events-or-creating-custom-new-ones" class="hash-link" aria-label="Direct link to Using bazel&#x27;s events or creating custom new ones?" title="Direct link to Using bazel&#x27;s events or creating custom new ones?">​</a></h3>
<p>As previously mentioned, were we to adopt BES, then there&#x27;d still be an open
question: should buck2 reuse Bazel&#x27;s events or should we create new ones? There
are
<a href="https://github.com/bazelbuild/remote-apis/issues/318" target="_blank" rel="noopener noreferrer">some generalization efforts</a>
happening at the moment, however Bazel and Buck2 share lots of similarities.
Enough that all events are almost perfectly applicable to Buck2, though less
useful at times, like with command line options. On the other hand, a new set of
events would perfectly describe a buck2 build, but would be prone to more issues
initially and would require a bigger investment upfront in terms of design and
development. Alternatively, we could start with a smaller subset of Bazel events
that are equivalent in Buck2 and then proceed to add the additional events
needed to properly express the unique behaviours of a Buck2 build.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proposal">Proposal<a href="#proposal" class="hash-link" aria-label="Direct link to Proposal" title="Direct link to Proposal">​</a></h2>
<p>Since this observability stack will be needed exclusively by the community, I
reckon adopting an already existing generic protocol would be the best option.
This way contributions on each end would benefit the other and the support and
development burden can be implicitly shared by the contributors of the protocol.
In this case, as it&#x27;s probably already obvious in the document, said protocol I
am referring to is BES.</p>
<p>The protocol is by nature very generic and the first iteration could be
completely based on a subset of events Bazel uses that apply to Buck2:</p>
<ul>
<li>Phase 1: create an invocation and send logs to a remote server</li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L291C9-L291C17" target="_blank" rel="noopener noreferrer">Progress</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L309" target="_blank" rel="noopener noreferrer">Aborted</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L361" target="_blank" rel="noopener noreferrer">BuildStarted</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L852C9-L852C22" target="_blank" rel="noopener noreferrer">BuildFinished</a></li>
<li>Phase 2: Add information about the command line and what targets it expands to</li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L406" target="_blank" rel="noopener noreferrer">UnstructuredCommandLine</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L462" target="_blank" rel="noopener noreferrer">PatternExpanded</a></li>
<li>Phase 3: Add target level status and information</li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L539C9-L539C24" target="_blank" rel="noopener noreferrer">NamedSetOfFiles</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L623C9-L623C23" target="_blank" rel="noopener noreferrer">TargetComplete</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L494C9-L494C25" target="_blank" rel="noopener noreferrer">TargetConfigured</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L843C9-L843C22" target="_blank" rel="noopener noreferrer">TargetSummary</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L682" target="_blank" rel="noopener noreferrer">TestResult</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/38ad73402b213b2a623d0953500b1cfc47c0e851/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto#L781C9-L781C20" target="_blank" rel="noopener noreferrer">TestSummary</a></li>
</ul>
<p>Additionally, as part of <code>Phase 1</code> we would need to implement the client itself,
a basic streaming strategy (which to begin with could be the simple sync
approach discussed in <code>Sync VS Async</code>) and provide an invocation-id to correlate
events that may be sent to different servers into a single invocation (this is
very similar to Buck2&#x27;s trace id and could in fact be the same, but we should
make it possible for the user to provide it when invoking the CLI and/or print
it visibly in the logs).</p>
<p>Once this is done, I suggest we look into async uploads and add a
<code>buck2 flush events</code> command to wait for all events (or those of a specific
invocation) to be flushed out.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="approaches">Approaches<a href="#approaches" class="hash-link" aria-label="Direct link to Approaches" title="Direct link to Approaches">​</a></h3>
<p>There are multiple ways in which this proposal can be implemented:</p>
<ol>
<li>Buck2 directly sends Bazel&#x27;s BEP events and implements the BES protocol</li>
<li>Buck2 implements the BES protocol but sends BuckEvent events but a shim can
be built inside Buck2 to turn these events into Bazel&#x27;s BEP events</li>
<li>Same as above but the shim lives outside of Buck2, so as far as Buck2 is
concerned it sends Buck2 BuckEvent via BES</li>
<li>Same as 2 but we implement a new API that is BES-like, but not BES</li>
<li>Same as 3 but we implement a new API that is BES-like, but not BES</li>
</ol>
<p>My current preference is for approach 1 as it is the simplest, but alternatively
my second favourite option is 3.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="links">Links<a href="#links" class="hash-link" aria-label="Direct link to Links" title="Direct link to Links">​</a></h2>
<ul>
<li><a href="https://bazel.build/remote/bep" target="_blank" rel="noopener noreferrer">BEP explanation</a></li>
<li><a href="https://bazel.build/remote/bep-glossary" target="_blank" rel="noopener noreferrer">Bazel&#x27;s BEP events and glossary</a></li>
<li><a href="https://github.com/googleapis/googleapis/blob/master/google/devtools/build/v1/publish_build_event.proto" target="_blank" rel="noopener noreferrer">BES proto definition</a></li>
<li><a href="https://github.com/bazelbuild/bazel/blob/master/src/main/java/com/google/devtools/build/lib/buildeventstream/proto/build_event_stream.proto" target="_blank" rel="noopener noreferrer">Bazel&#x27;s events proto definition</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="glossary">Glossary<a href="#glossary" class="hash-link" aria-label="Direct link to Glossary" title="Direct link to Glossary">​</a></h2>
<ul>
<li>BES (Build Event Service): refers to the generic service used to send/receive
build events by Bazel</li>
<li>BEP (Build Event Protocol): refers to the combination of BES and Bazel
specific events</li>
<li>Invocation: a single execution of a Buck2/Bazel command. An invocation usually
contains a single build or execution of a command, but may contain many in
case of multiple retries. Initially, build and invocations overlap</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#prior-art" class="table-of-contents__link toc-highlight">Prior Art</a><ul><li><a href="#bazel---bep" class="table-of-contents__link toc-highlight">Bazel - BEP</a></li><li><a href="#open-telemetry--prometheus" class="table-of-contents__link toc-highlight">Open Telemetry / Prometheus</a></li></ul></li><li><a href="#buck2s-existing-buckevent" class="table-of-contents__link toc-highlight">Buck2&#39;s existing BuckEvent</a></li><li><a href="#others" class="table-of-contents__link toc-highlight">Others</a></li><li><a href="#open-problems" class="table-of-contents__link toc-highlight">Open problems</a><ul><li><a href="#sync-vs-async-event-stream" class="table-of-contents__link toc-highlight">Sync Vs Async event stream</a></li><li><a href="#using-bazels-events-or-creating-custom-new-ones" class="table-of-contents__link toc-highlight">Using bazel&#39;s events or creating custom new ones?</a></li></ul></li><li><a href="#proposal" class="table-of-contents__link toc-highlight">Proposal</a><ul><li><a href="#approaches" class="table-of-contents__link toc-highlight">Approaches</a></li></ul></li><li><a href="#links" class="table-of-contents__link toc-highlight">Links</a></li><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">User guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/buck2/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/buck2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>