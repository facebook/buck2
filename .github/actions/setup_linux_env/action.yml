name: Setup Linux environment
description: |
  Setup Linux environment for building and testing buck2.
runs:
  using: composite
  steps:
  - uses: SebRollen/toml-action@v1.0.2
    id: read_rust_toolchain
    with:
      file: rust-toolchain
      field: toolchain.channel
  - uses: dtolnay/rust-toolchain@v1
    with:
      toolchain: ${{ steps.read_rust_toolchain.outputs.value }}
      targets: ${{ matrix.target.triple }}
      components: clippy
  - uses: Swatinem/rust-cache@v2
    with:
      prefix-key: buck2-upload
      key: ${{ matrix.target.triple }}