"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[76640],{28453:(r,e,t)=>{t.d(e,{R:()=>s,x:()=>a});var o=t(96540);const n={},i=o.createContext(n);function s(r){const e=o.useContext(i);return o.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function a(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(n):r.components||n:s(r.components),o.createElement(i.Provider,{value:e},r.children)}},34260:(r,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"api/build/ActionErrorCtx","title":"ActionErrorCtx","description":"Context object passed to action error handlers containing information about the failed action.","source":"@site/../docs/api/build/ActionErrorCtx.md","sourceDirName":"api/build","slug":"/api/build/ActionErrorCtx","permalink":"/docs/api/build/ActionErrorCtx","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"apiSidebar","previous":{"title":"Build APIs","permalink":"/docs/api/build/"},"next":{"title":"ActionSubError","permalink":"/docs/api/build/ActionSubError"}}');var n=t(74848),i=t(28453),s=t(56289);const a={},c="ActionErrorCtx",l={},d=[{value:"ActionErrorCtx.new_sub_error",id:"actionerrorctxnew_sub_error",level:2},{value:"ActionErrorCtx.output_artifacts",id:"actionerrorctxoutput_artifacts",level:2},{value:"ActionErrorCtx.parse_with_errorformat",id:"actionerrorctxparse_with_errorformat",level:2},{value:"ActionErrorCtx.stderr",id:"actionerrorctxstderr",level:2},{value:"ActionErrorCtx.stdout",id:"actionerrorctxstdout",level:2}];function u(r){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...r.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.header,{children:(0,n.jsx)(e.h1,{id:"actionerrorctx",children:"ActionErrorCtx"})}),"\n",(0,n.jsx)(e.p,{children:"Context object passed to action error handlers containing information about the failed action."}),"\n",(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:"ActionErrorCtx"})," provides access to the stdout, stderr, and optionally output artifacts\nfrom a failed action. Error handler functions receive this context and use it to analyze\nthe failure and produce structured ",(0,n.jsx)(e.a,{href:"../ActionSubError",children:(0,n.jsx)(e.code,{children:"ActionSubError"})})," objects for better\nerror diagnostics and categorization."]}),"\n",(0,n.jsx)(e.p,{children:"The context object has three main attributes:"}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:"stderr"}),": The stderr output from the failed action (as a string)"]}),"\n",(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:"stdout"}),": The stdout output from the failed action (as a string)"]}),"\n",(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:"output_artifacts"}),": A dictionary of output artifacts (if ",(0,n.jsx)(e.code,{children:"outputs_for_error_handler"})," was specified in ",(0,n.jsx)(e.a,{href:"../AnalysisActions/#analysisactionsrun",children:(0,n.jsx)(e.code,{children:"AnalysisActions.run"})}),")"]}),"\n"]}),"\n",(0,n.jsxs)(e.p,{children:["Error handlers use this information to create categorized errors via ",(0,n.jsx)(e.code,{children:"new_sub_error()"})," or\nparse compiler output using ",(0,n.jsx)(e.code,{children:"parse_with_errorformat()"}),"."]}),"\n",(0,n.jsx)(e.p,{children:"Example:"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-python",children:'def my_error_handler(ctx: ActionErrorCtx) -> list[ActionSubError]:\n    errors = []\n\n    # Check stderr for specific error patterns\n    if "compilation failed" in ctx.stderr.lower():\n        errors.append(ctx.new_sub_error(\n            category = "compilation_error",\n            message = "Compilation failed - check syntax and imports",\n            show_in_stderr = True,\n        ))\n\n    # Parse structured error output using errorformat\n    if "error:" in ctx.stderr:\n        # Parse errors like "file.rs:42:10: error: expected semicolon"\n        parsed_errors = ctx.parse_with_errorformat(\n            category = "syntax_error",\n            error = ctx.stderr,\n            errorformats = ["%f:%l:%c: %m"],\n        )\n        errors.extend(parsed_errors)\n\n    # Access output artifacts for structured error data\n    if ctx.output_artifacts:\n        for artifact, value in ctx.output_artifacts.items():\n            error_json = value.read_json()\n            if "errors" in error_json:\n                for err in error_json["errors"]:\n                    errors.append(ctx.new_sub_error(\n                        category = err.get("code", "unknown"),\n                        message = err.get("message"),\n                        file = err.get("file"),\n                        lnum = err.get("line"),\n                    ))\n\n    return errors\n\n# Use the error handler in an action\ndef _impl(ctx):\n    ctx.actions.run(\n        cmd_args(["compiler", "main.rs"]),\n        category = "compile",\n        error_handler = my_error_handler,\n    )\n'})}),"\n",(0,n.jsx)(e.h2,{id:"actionerrorctxnew_sub_error",children:"ActionErrorCtx.new_sub_error"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def ActionErrorCtx.new_sub_error(\n*,\ncategory: ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"}),",\nmessage: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nfile: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nlnum: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/int",children:"int"})," = None,\nend_lnum: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/int",children:"int"})," = None,\ncol: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/int",children:"int"})," = None,\nend_col: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/int",children:"int"})," = None,\nerror_type: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nerror_number: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/int",children:"int"})," = None,\nshow_in_stderr: ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/bool",children:"bool"})," = False,\nsubcategory: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\nremediation: None | ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})," = None,\n) -> ",(0,n.jsx)(s.default,{to:"/docs/api/build/ActionSubError",children:"ActionSubError"})]})}),"\n",(0,n.jsx)(e.p,{children:"Create a new sub error, specifying an error category name, optional message, and optional location information."}),"\n",(0,n.jsx)(e.p,{children:"The category should be finer grain error categorizations provided by the rule authors,\nand tend to be language specific. These should not be any kind of shared concepts\namong all errors for all languages/rules. For example, timeouts and infra errors\nshould not go here - buck2 tries to categorize these types of errors automatically.\nAn example of a finer grain error category may be the error code for rustc outputs."}),"\n",(0,n.jsx)(e.p,{children:"'category': Required, useful for providing a more granular error category for action errors.\n'message': Optional, provide users with additional context about the error to help with debugging/understandability/resolution, etc.\n'file': Optional, file path where the error occurred.\n'lnum': Optional, line number where the error occurred.\n'end_lnum': Optional, end line number for multi-line error spans.\n'col': Optional, column number where the error occurred.\n'end_col': Optional, end column number for error ranges.\n'error_type': Optional, type of error (e.g., error, warning, info).\n'error_number': Optional, numeric error code.\n'show_in_stderr': Optional, whether to show this error in stderr (default: false)."}),"\n",(0,n.jsx)(e.p,{children:"The message will be emitted to the build report, and to the stderr in the error diagnostics\nsection."}),"\n",(0,n.jsx)(e.hr,{}),"\n",(0,n.jsx)(e.h2,{id:"actionerrorctxoutput_artifacts",children:"ActionErrorCtx.output_artifacts"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["ActionErrorCtx.output_artifacts: dict[",(0,n.jsx)(s.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"}),", ",(0,n.jsx)(s.default,{to:"/docs/api/build/ArtifactValue",children:"ArtifactValue"}),"]"]})}),"\n",(0,n.jsxs)(e.p,{children:["Allows the output artifacts to be retrieve if ",(0,n.jsx)(e.a,{href:"../AnalysisActions/#analysisactionsrun",children:(0,n.jsx)(e.code,{children:"outputs_for_error_handler"})})," is set and the output artifact exists. This is useful for languages with structured error output, making the error retrieval process simpler."]}),"\n",(0,n.jsx)(e.p,{children:"This is also the recommended way to retrieve file path and line number, as reliably extracting that information\nfrom stdout/stderr can be challenging"}),"\n",(0,n.jsx)(e.hr,{}),"\n",(0,n.jsx)(e.h2,{id:"actionerrorctxparse_with_errorformat",children:"ActionErrorCtx.parse_with_errorformat"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["def ActionErrorCtx.parse_with_errorformat(\n*,\ncategory: ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"}),",\nerror: ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"}),",\nerrorformats: list[",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"}),"] | tuple[",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"}),", ...],\n) -> list[",(0,n.jsx)(s.default,{to:"/docs/api/build/ActionSubError",children:"ActionSubError"}),"]"]})}),"\n",(0,n.jsx)(e.p,{children:"Parse error text using vim errorformat patterns to create structured error information. This method leverages vim's proven errorformat system to extract file paths, line numbers, and error messages from compiler/tool output, automatically creating ActionSubError objects."}),"\n",(0,n.jsxs)(e.p,{children:["For errorformat pattern syntax, see: ",(0,n.jsx)(e.a,{href:"https://neovim.io/doc/user/quickfix.html#errorformat",children:"https://neovim.io/doc/user/quickfix.html#errorformat"})]}),"\n",(0,n.jsx)(e.p,{children:"Multiple patterns can be provided and will be tried in order until one matches.\nThis is useful for tools that may output errors in different formats."}),"\n",(0,n.jsx)(e.p,{children:"Args:"}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:"category"}),': Base category name for the generated sub-errors (e.g., "rust", "gcc")']}),"\n",(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:"error"}),": The error text to parse (typically stderr or stdout from the failed action)"]}),"\n",(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:"errorformats"}),": List of vim errorformat pattern strings to try matching against"]}),"\n"]}),"\n",(0,n.jsx)(e.p,{children:"Returns a list of ActionSubError objects with structured error information including\nfile locations when successfully parsed from the error text."}),"\n",(0,n.jsx)(e.hr,{}),"\n",(0,n.jsx)(e.h2,{id:"actionerrorctxstderr",children:"ActionErrorCtx.stderr"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["ActionErrorCtx.stderr: ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})]})}),"\n",(0,n.jsx)(e.p,{children:"Retrieve the stderr of the failed action. Can use string/regex matching to identify the error in order to categorize it."}),"\n",(0,n.jsx)(e.hr,{}),"\n",(0,n.jsx)(e.h2,{id:"actionerrorctxstdout",children:"ActionErrorCtx.stdout"}),"\n",(0,n.jsx)("pre",{class:"language-python",children:(0,n.jsxs)("code",{children:["ActionErrorCtx.stdout: ",(0,n.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})]})}),"\n",(0,n.jsx)(e.p,{children:"Retrieve the stdout of the failed action. Can use string/regex matching to identify the patterns in order to categorize it."})]})}function h(r={}){const{wrapper:e}={...(0,i.R)(),...r.components};return e?(0,n.jsx)(e,{...r,children:(0,n.jsx)(u,{...r})}):u(r)}}}]);