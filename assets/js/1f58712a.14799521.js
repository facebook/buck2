"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[26950],{28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var l=s(96540);const i={},r=l.createContext(i);function a(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),l.createElement(r.Provider,{value:n},e.children)}},91672:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"rule_authors/load","title":"load()","description":"The load() function is used to include definitions (functions, macros, rules,","source":"@site/../docs/rule_authors/load.md","sourceDirName":"rule_authors","slug":"/rule_authors/load","permalink":"/docs/rule_authors/load","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"load","title":"load()"},"sidebar":"main","previous":{"title":"Incremental Actions","permalink":"/docs/rule_authors/incremental_actions"},"next":{"title":"Alias","permalink":"/docs/rule_authors/alias"}}');var i=s(74848),r=s(28453);const a={id:"load",title:"load()"},o=void 0,c={},d=[{value:"Overview",id:"overview",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Arguments",id:"arguments",level:2},{value:"Examples",id:"examples",level:2},{value:"Loading Constants",id:"loading-constants",level:3},{value:"Loading with Aliases",id:"loading-with-aliases",level:3},{value:"Loading Macros",id:"loading-macros",level:3},{value:"Loading Custom Rules",id:"loading-custom-rules",level:3},{value:"Multiple Symbols",id:"multiple-symbols",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Naming",id:"naming",level:3},{value:"Organization",id:"organization",level:3},{value:"Visibility",id:"visibility",level:3},{value:"Performance",id:"performance",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Conditional Loading",id:"conditional-loading",level:3},{value:"Re-exporting",id:"re-exporting",level:3},{value:"See Also",id:"see-also",level:2}];function t(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"load()"})," function is used to include definitions (functions, macros, rules,\nand constants) from another ",(0,i.jsx)(n.code,{children:".bzl"})," file."]}),"\n",(0,i.jsxs)(n.p,{children:["In Buck2, ",(0,i.jsx)(n.code,{children:"load()"})," executes a ",(0,i.jsx)(n.code,{children:".bzl"})," file and imports the specified symbols into\nthe current file's namespace. This allows you to share code across multiple\nbuild files and create reusable build components."]}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The primary use cases for ",(0,i.jsx)(n.code,{children:"load()"})," include:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sharing constants"})," - Common configuration values used across multiple\ntargets"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Defining macros"})," - Functions that generate one or more build rules"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Importing rules"})," - Custom rule definitions for specific build scenarios"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Utility functions"})," - Helper functions for build logic"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"load()"})," function can be used in:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"BUCK"})," files (build files)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PACKAGE"})," files (package configuration)"]}),"\n",(0,i.jsxs)(n.li,{children:["Other ",(0,i.jsx)(n.code,{children:".bzl"})," files (creating libraries of build code)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load("//path/to/file:name.bzl", "symbol1", "symbol2", ...)\n'})}),"\n",(0,i.jsx)(n.p,{children:"Or with aliases:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load("//path/to/file:name.bzl", alias1="symbol1", alias2="symbol2")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"arguments",children:"Arguments"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Path"})," (required): The first argument is a string specifying the label of\nthe ",(0,i.jsx)(n.code,{children:".bzl"})," file to load. This is similar to Buck2's target label syntax but diverges in the ",(0,i.jsx)(n.code,{children:"cell"})," syntax with a prefixed ",(0,i.jsx)(n.code,{children:"@"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Absolute to cell: ",(0,i.jsx)(n.code,{children:"//package/path:file.bzl"})]}),"\n",(0,i.jsxs)(n.li,{children:["Relative to package: ",(0,i.jsx)(n.code,{children:":file.bzl"})]}),"\n",(0,i.jsxs)(n.li,{children:["From external cell: ",(0,i.jsx)(n.code,{children:"@cell//package/path:file.bzl"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Symbols"})," (required): One or more symbols to import from the specified file.\nThese can be:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Positional arguments"})," - Import symbols with their original names:\n",(0,i.jsx)(n.code,{children:'"symbol1", "symbol2"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keyword arguments"})," - Import symbols with aliased names:\n",(0,i.jsx)(n.code,{children:'local_name="remote_name"'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"loading-constants",children:"Loading Constants"}),"\n",(0,i.jsxs)(n.p,{children:["Suppose the file ",(0,i.jsx)(n.code,{children:"//core:defs.bzl"})," contains:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'COMPILER_FLAGS = [\n    "-Wall",\n    "-Werror",\n    "-O2",\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can load these constants in a ",(0,i.jsx)(n.code,{children:"BUCK"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load("//core:defs.bzl", "COMPILER_FLAGS")\n\ncxx_binary(\n    name = "example",\n    srcs = ["main.cpp"],\n    compiler_flags = COMPILER_FLAGS,\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"loading-with-aliases",children:"Loading with Aliases"}),"\n",(0,i.jsx)(n.p,{children:"To avoid name collisions, you can rename symbols during import:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load("//core:defs.bzl", my_flags="COMPILER_FLAGS")\n\ncxx_binary(\n    name = "example",\n    srcs = ["main.cpp"],\n    compiler_flags = my_flags,\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"loading-macros",children:"Loading Macros"}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"//build_defs:macros.bzl"})," contains:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def custom_library(name, srcs, **kwargs):\n    cxx_library(\n        name = name,\n        srcs = srcs,\n        compiler_flags = ["-std=c++17"],\n        **kwargs\n    )\n'})}),"\n",(0,i.jsx)(n.p,{children:"You can load and use the macro:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load("//build_defs:macros.bzl", "custom_library")\n\ncustom_library(\n    name = "mylib",\n    srcs = ["lib.cpp"],\n    deps = ["//other:dep"],\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"loading-custom-rules",children:"Loading Custom Rules"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load("//rules:custom.bzl", "my_custom_rule")\n\nmy_custom_rule(\n    name = "custom_target",\n    src = "input.txt",\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"multiple-symbols",children:"Multiple Symbols"}),"\n",(0,i.jsx)(n.p,{children:"You can load multiple symbols in a single statement:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load(\n    "//common:defs.bzl",\n    "COMMON_FLAGS",\n    "helper_function",\n    local_rule="exported_rule",\n)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"naming",children:"Naming"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"UPPER_CASE"})," for constants"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"snake_case"})," for functions and macros"]}),"\n",(0,i.jsx)(n.li,{children:"Use descriptive names that indicate purpose"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"organization",children:"Organization"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"load()"})," statements must be top level statements and cannot be conditionally executed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"load()"})," statements should be kept at the top of files for clarity"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"visibility",children:"Visibility"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".bzl"})," files are automatically visible to any target that can see the package\nthey're in"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.a,{href:"/docs/rule_authors/package_files",children:"package visibility"})," to control access to ",(0,i.jsx)(n.code,{children:".bzl"})," files"]}),"\n",(0,i.jsxs)(n.li,{children:["Keep ",(0,i.jsx)(n.code,{children:"load()"})," statements at the top of files for clarity"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"performance",children:"Performance"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Avoid expensive computation in ",(0,i.jsx)(n.code,{children:".bzl"})," files during load time"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".bzl"})," files are evaluated once and cached, so minimize side effects"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"conditional-loading",children:"Conditional Loading"}),"\n",(0,i.jsxs)(n.p,{children:["While you cannot conditionally execute ",(0,i.jsx)(n.code,{children:"load()"})," statements (they must be at the\ntop level), you can conditionally use the loaded symbols:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'load("//config:settings.bzl", "ENABLE_FEATURE")\n\ndef maybe_add_feature(name, srcs):\n    if ENABLE_FEATURE:\n        feature_library(name=name, srcs=srcs)\n    else:\n        regular_library(name=name, srcs=srcs)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"re-exporting",children:"Re-exporting"}),"\n",(0,i.jsxs)(n.p,{children:["You can create a ",(0,i.jsx)(n.code,{children:".bzl"})," file that re-exports symbols from other files:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# //defs:all.bzl\nload("//defs:cpp.bzl", "cpp_macro")\nload("//defs:python.bzl", "py_macro")\n\n# Re-export for convenience\nexport_cpp = cpp_macro\nexport_py = py_macro\n'})}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/rule_authors/writing_rules",children:"Writing Rules"})," - How to create custom build rules"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/rule_authors/package_files",children:"PACKAGE Files"})," - Package-level configuration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/api/build/",children:"Build APIs"})," - Available Starlark functions and types"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}}}]);