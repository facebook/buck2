"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[88248],{28453:(t,e,a)=>{a.d(e,{R:()=>s,x:()=>c});var n=a(96540);const i={},r=n.createContext(i);function s(t){const e=n.useContext(r);return n.useMemo(function(){return"function"==typeof t?t(e):{...e,...t}},[e,t])}function c(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:s(t.components),n.createElement(r.Provider,{value:e},t.children)}},78718:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>u,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"api/build/OutputArtifact","title":"OutputArtifact","description":"An artifact marked as an output of an action.","source":"@site/../docs/api/build/OutputArtifact.md","sourceDirName":"api/build","slug":"/api/build/OutputArtifact","permalink":"/docs/api/build/OutputArtifact","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"apiSidebar","previous":{"title":"LocalResourceInfo","permalink":"/docs/api/build/LocalResourceInfo"},"next":{"title":"PackagePath","permalink":"/docs/api/build/PackagePath"}}');var i=a(74848),r=a(28453),s=a(56289);const c={},o="OutputArtifact",u={},l=[{value:"Common Usage",id:"common-usage",level:3},{value:"When is <code>.as_output()</code> needed?",id:"when-is-as_output-needed",level:3},{value:"Key Rules",id:"key-rules",level:3},{value:"OutputArtifact.as_input",id:"outputartifactas_input",level:2},{value:"OutputArtifact.basename",id:"outputartifactbasename",level:2},{value:"OutputArtifact.extension",id:"outputartifactextension",level:2},{value:"OutputArtifact.is_source",id:"outputartifactis_source",level:2},{value:"OutputArtifact.owner",id:"outputartifactowner",level:2},{value:"OutputArtifact.short_path",id:"outputartifactshort_path",level:2}];function d(t){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...t.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"outputartifact",children:"OutputArtifact"})}),"\n",(0,i.jsx)(e.p,{children:"An artifact marked as an output of an action."}),"\n",(0,i.jsxs)(e.p,{children:["When you create custom actions with ",(0,i.jsx)(e.code,{children:"ctx.actions.run()"}),", you need to tell Buck2 which artifacts\nthe action will produce. ",(0,i.jsx)(e.code,{children:"OutputArtifact"})," is how you mark a declared artifact as an output."]}),"\n",(0,i.jsx)(e.h3,{id:"common-usage",children:"Common Usage"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'def _impl(ctx):\n    # Declare what file will be produced\n    out = ctx.actions.declare_output("output.txt")\n\n    # Run an action that produces it\n    # The artifact must be marked as output using .as_output()\n    ctx.actions.run(\n        cmd_args(["my_tool", "--output", out.as_output()]),\n        category = "process",\n    )\n\n    return [DefaultInfo(default_output = out)]\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"when-is-as_output-needed",children:["When is ",(0,i.jsx)(e.code,{children:".as_output()"})," needed?"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Required"}),": When passing declared artifacts to ",(0,i.jsx)(e.code,{children:"ctx.actions.run()"})," - the action needs to know\nwhich artifacts it's responsible for producing"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Not needed"}),": When using ",(0,i.jsx)(e.code,{children:"ctx.actions.write()"}),", ",(0,i.jsx)(e.code,{children:"ctx.actions.copy_file()"}),", etc. - these\nmethods handle the output declaration automatically"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"key-rules",children:"Key Rules"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Every action must have at least one output"}),"\n",(0,i.jsx)(e.li,{children:"Each declared artifact can only be bound to one action"}),"\n",(0,i.jsx)(e.li,{children:"All declared artifacts must be bound before the rule finishes"}),"\n",(0,i.jsx)(e.li,{children:"If you forget to bind a declared artifact, Buck2 will raise an error"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"outputartifactas_input",children:"OutputArtifact.as_input"}),"\n",(0,i.jsx)("pre",{class:"language-python",children:(0,i.jsxs)("code",{children:["def OutputArtifact.as_input(\n) -> ",(0,i.jsx)(s.default,{to:"/docs/api/build/PromiseArtifact",children:"Artifact"})]})}),"\n",(0,i.jsx)(e.p,{children:"Returns the input artifact from which this output artifact was constructed"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"outputartifactbasename",children:"OutputArtifact.basename"}),"\n",(0,i.jsx)("pre",{class:"language-python",children:(0,i.jsxs)("code",{children:["OutputArtifact.basename: ",(0,i.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})]})}),"\n",(0,i.jsxs)(e.p,{children:["The base name of this artifact. e.g. for an artifact at ",(0,i.jsx)(e.code,{children:"foo/bar"}),", this is ",(0,i.jsx)(e.code,{children:"bar"})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"outputartifactextension",children:"OutputArtifact.extension"}),"\n",(0,i.jsx)("pre",{class:"language-python",children:(0,i.jsxs)("code",{children:["OutputArtifact.extension: ",(0,i.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})]})}),"\n",(0,i.jsxs)(e.p,{children:["The file extension of this artifact. e.g. for an artifact at foo/bar.sh, this is ",(0,i.jsx)(e.code,{children:".sh"}),". If no extension is present, ",(0,i.jsx)(e.code,{children:'""'})," is returned."]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"outputartifactis_source",children:"OutputArtifact.is_source"}),"\n",(0,i.jsx)("pre",{class:"language-python",children:(0,i.jsxs)("code",{children:["OutputArtifact.is_source: ",(0,i.jsx)(s.default,{to:"/docs/api/starlark/bool",children:"bool"})]})}),"\n",(0,i.jsx)(e.p,{children:"Whether the artifact represents a source file"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"outputartifactowner",children:"OutputArtifact.owner"}),"\n",(0,i.jsx)("pre",{class:"language-python",children:(0,i.jsxs)("code",{children:["OutputArtifact.owner: ",(0,i.jsx)(s.default,{to:"/docs/api/build/Label",children:"Label"})," | None"]})}),"\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"Label"})," of the rule that originally created this artifact. May also be None in the case of source files, or if the artifact has not be used in an action, or if the action was not created by a rule."]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"outputartifactshort_path",children:"OutputArtifact.short_path"}),"\n",(0,i.jsx)("pre",{class:"language-python",children:(0,i.jsxs)("code",{children:["OutputArtifact.short_path: ",(0,i.jsx)(s.default,{to:"/docs/api/starlark/str",children:"str"})]})}),"\n",(0,i.jsxs)(e.p,{children:["The interesting part of the path, relative to somewhere in the output directory. For an artifact declared as ",(0,i.jsx)(e.code,{children:"foo/bar"}),", this is ",(0,i.jsx)(e.code,{children:"foo/bar"}),"."]})]})}function h(t={}){const{wrapper:e}={...(0,r.R)(),...t.components};return e?(0,i.jsx)(e,{...t,children:(0,i.jsx)(d,{...t})}):d(t)}}}]);