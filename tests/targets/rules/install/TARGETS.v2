load("@fbcode//buck2/install_proto:install.bzl", "installer")
native.export_file(
    name = "artifact_a",
    src = "artifact_a.txt",
)

native.export_file(
    name = "artifact_b",
    src = "artifact_b.txt",
)

python_binary(
    # @autodeps-skip
    name = "installer_sends_err",
    srcs = ["bad_server.py"],
    base_module = "",
    main_module = "bad_server",
    deps = [
        "fbcode//buck2/install_proto:install-py",
    ],
)

installer(
    name = "installer_test",
    files = {
        "artifact_a":"artifact_a.txt",
        "artifact_b":"artifact_b.txt",
    },
    installer = "fbcode//buck2/install_proto:installer",)

installer(
    name = "bad_installer_target",
    files = {
        "artifact_a":"artifact_a.txt",
        "artifact_b":"artifact_b.txt",
    },
    installer = "fbcode//buck2/tests/targets/rules/genrule/bad:my_genrule_bad_3",
)

installer(
    name = "bad_artifacts",
    files = {
        "artifact_a":"artifact_a.txt",
        "bad_genrule":"fbcode//buck2/tests/targets/rules/genrule/bad:my_genrule_bad_2",
    },
    installer = "fbcode//buck2/install_proto:installer"
)

installer(
    name= "installer_server_sends_error",
    files = { "artifact_a":"artifact_a.txt"},
    installer = ":installer_sends_err",
)
