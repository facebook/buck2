# @noautodeps

load("@fbcode_macros//build_defs:native_rules.bzl", "buck_genrule")

# Should fail because it doesn't generate out.txt
buck_genrule(
    name = "my_genrule_bad",
    srcs = [],
    out = "out.txt",
    cmd = "echo HELLO_STDOUT && echo HELLO_STDERR >&2",
)

buck_genrule(
    name = "my_genrule_bad_local",
    srcs = [],
    out = "out.txt",
    cacheable = False,
    cmd = "echo HELLO_STDOUT && echo HELLO_STDERR >&2",
    labels = ["buck2_test_local_exec"],
)

# Should fail because false returns non-zero exit code
buck_genrule(
    name = "my_genrule_bad_2",
    srcs = [],
    out = "out.txt",
    bash = "false",
    cmd_exe = "cmd /c exit 1",
)

buck_genrule(
    name = "my_genrule_bad_3",
    srcs = [],
    out = "out.sh",
    cmd = "exit 1",
    executable = True,
)

# Should fail because it runs an invalid command (and we run with -e)
buck_genrule(
    name = "my_genrule_bad_4",
    srcs = [],
    out = "out.txt",
    bash = "script_that_doesnt_exist; echo HELLO > $OUT",
    cmd_exe = "script_that_doesnt_exist && echo HELLO>%OUT%",
)
