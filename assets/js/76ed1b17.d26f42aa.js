"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[12562],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var t=s(96540);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}},43331:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"about/why","title":"Why Buck2","description":"Buck2 is a build system from Meta. This page answers the questions:","source":"@site/../docs/about/why.md","sourceDirName":"about","slug":"/about/why","permalink":"/docs/about/why","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"why","title":"Why Buck2"},"sidebar":"main","previous":{"title":"Introduction","permalink":"/docs/"},"next":{"title":"Language / Ecosystem Support","permalink":"/docs/about/language_support"}}');var i=s(74848),a=s(28453);const r={id:"why",title:"Why Buck2"},o=void 0,l={},c=[{value:"Why does Buck2 exist?",id:"why-does-buck2-exist",level:2},{value:"What&#39;s different about Buck2?",id:"whats-different-about-buck2",level:2},{value:"Why use Buck2?",id:"why-use-buck2",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Buck2 is a build system from Meta. This page answers the questions:\n",(0,i.jsx)(n.a,{href:"#why-does-buck2-exist",children:"why does Buck2 exist"}),",\n",(0,i.jsx)(n.a,{href:"#whats-different-about-buck2",children:"what's different about Buck2"}),", and\n",(0,i.jsx)(n.a,{href:"#why-use-buck2",children:"why use Buck2"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"why-does-buck2-exist",children:"Why does Buck2 exist?"}),"\n",(0,i.jsx)(n.p,{children:"Meta employs a very large monorepo, consisting of a variety of programming\nlanguages, including C++, Python, Rust, Kotlin, Swift, Objective-C, Haskell,\nOCaml, and more. Google employs a different but functionally similar monorepo."}),"\n",(0,i.jsxs)(n.p,{children:["These large scale and multi-language repositories are generally beyond the\ncapabilities of traditional build systems like ",(0,i.jsx)(n.code,{children:"make"}),". To optimize the build and\nperformance of these large systems, Facebook and Google developed their own\nbuild systems, respectively Buck and Bazel. While the internal version of Bazel\nwas started first (also known as Blaze), Buck was open sourced first (back in\nMarch 2013), followed by Bazel a few years later (March 2015)."]}),"\n",(0,i.jsxs)(n.p,{children:["The retroactively named Buck1 was a capable build system, but had significant\nlimitations and has been entirely phased out at Meta today. Buck2 is a rewrite\nthat aims to keep the best bits of Buck1 (with a high degree of target\ncompatibility) but also borrows ideas from\n",(0,i.jsx)(n.a,{href:"https://ndmitchell.com/#shake_10_sep_2012",children:"academic"}),"\n",(0,i.jsx)(n.a,{href:"https://ndmitchell.com/#shake_21_apr_2020",children:"research"})," and build systems,\nincluding ",(0,i.jsx)(n.a,{href:"https://bazel.build/",children:"Bazel"}),", ",(0,i.jsx)(n.a,{href:"https://www.pantsbuild.org/",children:"Pants"}),",\n",(0,i.jsx)(n.a,{href:"https://shakebuild.com/",children:"Shake"}),", ",(0,i.jsx)(n.a,{href:"https://gittup.org/tup/",children:"Tup"}),", and more."]}),"\n",(0,i.jsx)(n.p,{children:"Following are aspects common to Buck1 and Buck2 (and in most cases, Bazel):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Targets that can be queried"})," - the build is defined as a series of targets,\nspecified in ",(0,i.jsx)(n.code,{children:"BUCK"})," files, that depend on other targets. This graph of targets\ncan be queried to understand how they relate to each other and what the\npotential impact of a change might be."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Remote execution"})," - the build can send actions to a set of remote servers\nto be executed, increasing the parallelism significantly."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multi-language composability"})," - there can be lots of different languages in\na single build, and they can be put together. For example, you could have a\nPython library that depends on a Rust library, which, in turn depends on a C\nlibrary."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"File watching"})," - at large enough scale, simply looking for changed files is\nprohibitively expensive. Buck can integrate with\n",(0,i.jsx)(n.a,{href:"https://facebook.github.io/watchman/",children:"Watchman"})," to discover which files have\nchanged efficiently. However, for simplicity of setup, the open-source version\ndefaults to using ",(0,i.jsx)(n.code,{children:"inotify"})," or similar functionality."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Uses Starlark"})," - Starlark is a deterministic Python-like language used to\nspecify the targets, enabling the definition of targets as literals and more\nadvanced manipulation/sharing."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"whats-different-about-buck2",children:"What's different about Buck2?"}),"\n",(0,i.jsx)(n.p,{children:"Buck2 has several major differences (as well as many minor differences) from\nBuck1. Of particular note, there are a number that give new efficiency or\nexpressiveness (most of these are also different from Bazel)."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Buck2 is written in Rust"})," - Buck1 was written in Java. One of the\nadvantages of using Rust is the absence of GC pauses, However, Java also has\nadvantages, such as better memory profiling tools."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Buck2 is remote execution first"})," - local execution is considered a special\ncase of remote execution, in contrast to Buck1 where it was added after. That\nmeans that things such as directory hashes can be pre-computed ready to send\nto remote execution, giving efficiency benefits."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"All Buck2 rules are written in Starlark"})," - whereas, in Buck1, they were\nwritten in Java as part of the binary, which makes iteration on rules much\nfaster."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"The Buck2 binary is entirely language agnostic"})," - as a consequence of\nhaving all the rules external to the binary, the most important and complex\nrule (such as in C++), don't have access to magic internal features. As a\nresult, features have been made available to all rules, including:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/rule_authors/dep_files",children:"Dep files"})," - the ability to declare that a\nsubset of the files weren't actually used, and thus not be sensitive to\nchanges within them."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/rule_authors/incremental_actions",children:"Incremental actions"})," - the ability\nto have the action short-circuit some subset of the work if run again."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Buck2 uses a dynamic (aka monadic) graph as its underlying computation\nengine"})," - while most dependencies are specified statically, there are two\nparticular features that expose dynamic power to rule authors:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/rule_authors/dynamic_dependencies",children:"Dynamic dependencies"})," - enable\nrules to build a file then look at its contents before specifying the\ndependencies and steps in future actions. Common uses are languages where\nthe dependency structure within a project must follow imports (e.g. Haskell,\nOCaml) and distributed ThinLTO (where the best optimization plan is\ngenerated from summaries)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/rule_authors/anon_targets",children:"Anonymous targets"})," - enable rules to\ncreate a graph that has more sharing than the original user graph. As a\nresult, two unrelated binaries can compile shared code only once, despite\nthe shared code not knowing about this commonality. This feature is useful\nfor rules like Swift feature resolution."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"/docs/rule_authors/transitive_sets",children:"Transitive-sets"})})," - similar in purpose\nto Bazel's ",(0,i.jsx)(n.a,{href:"https://bazel.build/rules/lib/depset",children:"depset"}),". But, instead of\nbeing just a memory optimization, are also wired into the dependency graph,\nproviding a reduction in the size of the dependency graph."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Buck2 is not phased"})," - there are no target graph/action graph phases, just\na series of dependencies in a\n",(0,i.jsx)(n.a,{href:"https://github.com/facebook/buck2/blob/main/dice/dice/docs/index.md",children:"single graph on DICE"}),"\nthat result in whatever the user requested. That means that Buck2 can\nsometimes parallelise different phases and track changes very precisely."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Buck2 can integrate with the virtual filesystem\n",(0,i.jsx)(n.a,{href:"https://github.com/facebook/sapling",children:"Eden"})]})," - this provides good\nperformance, even when the file system is backed by source control fetches.\nHowever, Eden is not required, and a normal file system will also work well."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["The Buck2 Starlark implementation is available\n",(0,i.jsx)(n.a,{href:"https://developers.facebook.com/blog/post/2021/04/08/rust-starlark-library/",children:"as a standalone library"})]})," -\nthis provides features such as IDE integration (both LSP and DAP bindings),\nlinters, typecheckers, and more. These features are integrated into Buck2 to\ngive a better developer experience (which is still evolving)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Buck2 supports configurations"})," - (such as ",(0,i.jsx)(n.code,{children:"select"}),") to provide\nmulti-platform/architecture builds, which are heavily inspired by Bazel.\nWithin that space, there is a number of small differences, such as\n",(0,i.jsx)(n.code,{children:"toolchain_deps"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Buck2 is fast"})," - in our internal tests, we observed that Buck2 completed\nbuilds 2x as fast as Buck1."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For a comprehensive list of benefits, see\n",(0,i.jsx)(n.a,{href:"/docs/about/benefits/compared_to_buck1",children:"Benefits Compared to Buck1"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"why-use-buck2",children:"Why use Buck2?"}),"\n",(0,i.jsxs)(n.p,{children:["It would be delightful if you tried out Buck2! But it is early-stage software,\nso users may run into unexpected issues. If you encounter an issue, please\nreport it via ",(0,i.jsx)(n.a,{href:"https://github.com/facebook/buck2/issues",children:"Github issues"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Buck2 is being used internally within Meta and is available as open-source\nfrom 2023."}),"\n",(0,i.jsx)(n.p,{children:"There are several differences between the internal and open-source versions:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Meta uses an internal version of remote execution with builds always hooked up\nto remote execution. The open-source binding, which uses Buck2 without remote\nexecution, may be less polished."}),"\n",(0,i.jsxs)(n.li,{children:["There are some configuration differences between the open source and internal\nversions. For example, file changes default to ",(0,i.jsx)(n.code,{children:"inotify"})," in open-source, and\nto Watchman internally."]}),"\n",(0,i.jsx)(n.li,{children:"The prelude (containing all the rules) is the same for open-source as\ninternal, but toolchains are not open-sourced. The required custom toolchains\nmay not work as well."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"There are also some things that aren't quite yet finished:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"There are not yet mechanisms to build in release mode (that should be achieved\nby modifying the toolchain)."}),"\n",(0,i.jsx)(n.li,{children:"Windows/Mac builds are still in progress; open-source code is mostly tested on\nLinux."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If none of that puts you off, ",(0,i.jsx)(n.a,{href:"/docs/getting_started/",children:"give Buck2 a go"}),"!"]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);