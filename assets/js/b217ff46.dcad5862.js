"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[52345],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var s=t(96540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},59880:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"prelude/rules/android/android_instrumentation_apk","title":"android_instrumentation_apk","description":"An androidinstrumentationapk() rule is used to generate an Android Instrumentation APK.","source":"@site/../docs/prelude/rules/android/android_instrumentation_apk.md","sourceDirName":"prelude/rules/android","slug":"/prelude/rules/android/android_instrumentation_apk","permalink":"/docs/prelude/rules/android/android_instrumentation_apk","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ruleSidebar","previous":{"title":"android_bundle","permalink":"/docs/prelude/rules/android/android_bundle"},"next":{"title":"android_instrumentation_test","permalink":"/docs/prelude/rules/android/android_instrumentation_test"}}');var i=t(74848),r=t(28453);t(56289);const a={},o="android_instrumentation_apk",d={},l=[{value:"Details",id:"details",level:3},{value:"Function Signature",id:"function-signature",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Examples",id:"examples",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"android_instrumentation_apk",children:"android_instrumentation_apk"})}),"\n",(0,i.jsxs)(n.p,{children:["An ",(0,i.jsx)(n.code,{children:"android_instrumentation_apk()"})," rule is used to generate an Android Instrumentation APK."]}),"\n",(0,i.jsx)(n.h3,{id:"details",children:"Details"}),"\n",(0,i.jsxs)(n.p,{children:["Android's ",(0,i.jsx)(n.a,{href:"http://developer.android.com/tools/testing/testing_android.html",children:"Testing Fundamentals"}),' documentation includes a diagram that shows\nthe relationship between an "application package" and a "test package"\nwhen running a test. This rule corresponds to a test package. Note\nthat a test package has an interesting quirk where it is ',(0,i.jsx)(n.em,{children:"compiled\nagainst"})," an application package, but ",(0,i.jsx)(n.em,{children:"must not include"})," the\nresources or Java classes of the application package. Therefore, this\nclass takes responsibility for making sure the appropriate bits are\nexcluded. Failing to do so will generate mysterious runtime errors\nwhen running the test."]}),"\n",(0,i.jsx)(n.h3,{id:"function-signature",children:"Function Signature"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def android_instrumentation_apk(\n    *,\n    name: str,\n    default_target_platform: None | str = None,\n    target_compatible_with: list[str] = [],\n    compatible_with: list[str] = [],\n    exec_compatible_with: list[str] = [],\n    visibility: list[str] = [],\n    within_view: list[str] = ["PUBLIC"],\n    metadata: OpaqueMetadata = {},\n    tests: list[str] = [],\n    modifiers: OpaqueMetadata = [],\n    _android_toolchain: str = "gh_facebook_buck2_shims_meta//:android",\n    _apple_platforms: dict[str, str] = {},\n    _cxx_toolchain: str = gh_facebook_buck2_shims_meta//:android-hack,\n    _dex_toolchain: str = "gh_facebook_buck2_shims_meta//:dex",\n    _exec_os_type: str = "prelude//os_lookup/targets:os_lookup",\n    _is_building_android_binary: bool = True,\n    _is_force_single_cpu: bool = False,\n    _is_force_single_default_cpu: bool = False,\n    _java_toolchain: str = "gh_facebook_buck2_shims_meta//:java_for_android",\n    apk: str,\n    contacts: list[str] = [],\n    cpu_filters: list[str] = [],\n    default_host_platform: None | str = None,\n    deps: list[str] = [],\n    disable_pre_dex: bool = False,\n    enable_bootstrap_dexes: bool = False,\n    includes_vector_drawables: bool = False,\n    is_self_instrumenting: bool = False,\n    labels: list[str] = [],\n    licenses: list[str] = [],\n    manifest: None | str | (str, str) = None,\n    manifest_skeleton: None | str | (str, str) = None,\n    min_sdk_version: None | int = None,\n    multidex_min_api: None | str = None,\n    preprocess_java_classes_bash: None | str = None,\n    preprocess_java_classes_cmd: None | str = None,\n    preprocess_java_classes_deps: list[str] = [],\n    primary_dex_patterns: list[str] = [],\n    use_split_dex: None | bool = None,\n) -> None\n'})}),"\n",(0,i.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"name"}),": (required)"]}),"\n",(0,i.jsx)(n.p,{children:"name of the target"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"default_target_platform"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"None"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"specifies the default target platform, used when no platforms are specified on the command line"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"target_compatible_with"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"compatible_with"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with a configuration"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exec_compatible_with"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"visibility"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of visibility patterns restricting what targets can depend on this one"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"within_view"}),": (defaults to: ",(0,i.jsx)(n.code,{children:'["PUBLIC"]'}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of visibility patterns restricting what this target can depend on"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"metadata"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"{}"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a key-value map of metadata associated with this target"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tests"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"a list of targets that provide tests for this one"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"modifiers"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"an array of modifiers associated with this target"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"contacts"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"A list of organizational contacts for this rule. These could be individuals who you would contact in the event of a failure or other issue with the rule."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"contacts = [ 'Joe Sixpack', 'Erika Mustermann' ]\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"labels"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Set of arbitrary strings which allow you to annotate a ",(0,i.jsx)(n.a,{href:"https://buck2.build/docs/concepts/build_rule/",children:"build rule"})," with tags that can be searched for over an entire dependency tree using ",(0,i.jsx)(n.code,{children:"buck query()"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"licenses"}),": (defaults to: ",(0,i.jsx)(n.code,{children:"[]"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Set of license files for this library. To get the list of license files for a given build rule and all of its dependencies, you can use ",(0,i.jsx)(n.a,{href:"https://buck2.build/docs/users/commands/query/",children:"buck query"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsxs)(n.p,{children:["Here is an example of an ",(0,i.jsx)(n.code,{children:"android_instrumentation_apk()"})," rule that tests an ",(0,i.jsx)(n.code,{children:"android_binary()"}),", and depends on a test\npackage."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"\nandroid_library(\n  name = 'test',\n  srcs = glob(['test/**/*.java']),\n)\n\nandroid_binary(\n  name = 'messenger',\n  manifest = 'AndroidManifest.xml',\n  keystore = '//keystores:prod',\n  package_type = 'release',\n  proguard_config = 'proguard.cfg',\n  deps = [\n    ...\n  ],\n)\n\n# Building this rule will produce a file named messenger_test.apk\nandroid_instrumentation_apk(\n  name = 'messenger_test',\n  manifest = 'AndroidInstrumentationManifest.xml',\n  apk = ':messenger',\n  deps = [\n    ':test',\n  ],\n)\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);