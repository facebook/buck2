_targets = targets("//lib:")
print("_targets = `%s`" % _targets)

expr = attrfilter("description", "this is lib2", _targets)
expected = targets("//lib:lib2")
if expr != expected:
    fail("expected `attrfilter(\"description\", \"this is lib2\", _targets) == %s`, got `%s`" % (expected, expr))

expr = attrfilter("cmd", "this is lib2", _targets)
if expr != expected:
    fail("expected `attrfilter(\"cmd\", \"this is lib2\", _targets) == %s`, got `%s`" % (expected, expr))

# test an attr with select
expr = attrfilter("cmd", "this is lib3", _targets)
expected = targets("//lib:lib3")
if expr != expected:
    fail("expected `attrfilter(\"cmd\", \"this is lib3\", _targets) == %s`, got `%s`" % (expected, expr))


# and test the two select cases. both should match
expr = attrfilter("cmd", "this is lib3 too, case 1", _targets)
if expr != expected:
    fail("expected `attrfilter(\"cmd\", \"this is lib3 too, case 1\", _targets) == %s`, got `%s`" % (expected, expr))


expr = attrfilter("cmd", "this is lib3 too, case 2", _targets)
if expr != expected:
    fail("expected `attrfilter(\"cmd\", \"this is lib3 too, case 2\", _targets) == %s`, got `%s`" % (expected, expr))
