# @noautodeps

load("//buck2/tests/targets/rules:bzl_native.bzl", "bzl_native")

oncall("buck2")

bzl_native.genrule(
    name = "copy_data",
    srcs = ["DATA"],
    out = "data.copy",
    bash = "cp $SRCS $OUT",
    cmd_exe = "copy %SRCS% %OUT%",
)

bzl_native.sh_binary(
    name = "diff",
    default_host_platform = "ovr_config//platform/linux:x86_64",
    main = select({
        "DEFAULT": "diff.sh",
        "ovr_config//os:windows": "diff.bat",
    }),
    resources = [
        "DATA",
        ":copy_data",
    ],
)

bzl_native.genrule(
    name = "gen",
    out = "out.txt",
    bash = "$(exe :diff) > $OUT",
    cmd_exe = "$(exe :diff) > %OUT%",
)
