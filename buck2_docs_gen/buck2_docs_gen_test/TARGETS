load("@fbcode_macros//build_defs:native_rules.bzl", "buck_sh_test")
load("@fbcode_macros//build_defs:python_binary.bzl", "python_binary")
load("@fbcode_macros//build_defs:rust_binary.bzl", "rust_binary")
load("@fbsource//tools/build_defs:glob_defs.bzl", "glob")

rust_binary(
    name = "buck2_docs_gen_test",
    srcs = glob(
        ["src/**/*.rs"],
    ),
    deps = [
        "fbsource//third-party/rust:anyhow",
        "//buck2/buck2_docs_gen/buck2_docs_gen:buck2_docs_gen",
        "//buck2/starlark-rust/starlark:starlark",
    ],
)

python_binary(
    name = "verify",
    srcs = ["verify.py"],
    base_module = "",
    main_module = "verify",
)

buck_sh_test(
    name = "verify-docs",
    args = [
        "$(location :verify)",
        "$(location :buck2_docs_gen_test)",
    ],
    test = select({
        "DEFAULT": "verify.sh",
        "ovr_config//os:windows": "verify.bat",
    }),
)
